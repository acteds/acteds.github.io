<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>日期和时间 &mdash; 个人博客</title><link rel="stylesheet" href="/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="/assets/css/components/collection.css"><link rel="stylesheet" href="/assets/css/components/repo-card.css"><link rel="stylesheet" href="/assets/css/sections/repo-list.css"><link rel="stylesheet" href="/assets/css/components/boxed-group.css"><link rel="stylesheet" href="/assets/css/globals/common.css"><link rel="stylesheet" href="/assets/css/globals/responsive.css"><link rel="stylesheet" href="/assets/css/posts/index.css"><link rel="stylesheet" href="/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="/assets/css/highlight/monokai.sublime.css"><link rel="canonical" href="/2021/04/12/%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4/"><link rel="alternate" type="application/atom+xml" title="个人博客" href="/feed.xml"><link rel="shortcut icon" href="/favicon.ico"><meta property="og:title" content="日期和时间"><meta name="keywords" content="Java"><meta name="og:keywords" content="Java"><meta name="description" content="引言java的日期与时间，新旧时间日期API。"><meta name="og:description" content="引言java的日期与时间，新旧时间日期API。"><meta property="og:url" content="/2021/04/12/%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4/"><meta property="og:site_name" content="个人博客"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2021-04-12"> <script src="/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="/assets/js/jquery-ui.js"></script> <script src="/assets/js/main.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-80669434-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-80669434-1'); </script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1><a href="/" title="个人博客"><span class="octicon octicon-mark-github"></span> 个人博客</a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="/" class=" site-header-nav-item" target="" title="首页">首页</a> <a href="/categories/" class=" site-header-nav-item" target="" title="分类">分类</a> <a href="/wiki/" class=" site-header-nav-item" target="" title="维基">维基</a> <a href="/about/" class=" site-header-nav-item" target="" title="关于">关于</a></nav></div></header><section class="collection-head small geopattern" data-pattern-id="日期和时间"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">日期和时间</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2021/04/12 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="/categories/#Java" title="Java">Java</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 21947 字，约 63 分钟 </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths" ><article class="article-content markdown-body"><h1 id="引言">引言</h1><p>java的日期与时间，新旧时间日期API。</p><h1 id="日期与时间">日期与时间</h1><h2 id="概念">概念</h2><p>在计算机中，我们经常需要处理日期和时间。</p><p>这是日期：</p><ul><li>2019-11-20</li><li>2020-1-1</li></ul><p>这是时间：</p><ul><li>12:30:59</li><li>2020-1-1 20:21:59</li></ul><p>日期是指某一天，它不是连续变化的，而是应该被看成离散的。</p><p>而时间有两种概念，一种是不带日期的时间，例如，12:30:59。另一种是带日期的时间，例如，2020-1-1 20:21:59，只有这种带日期的时间能唯一确定某个时刻，不带日期的时间是无法确定一个唯一时刻的。</p><h3 id="本地时间">本地时间</h3><p>当我们说当前时刻是2019年11月20日早上8:15的时候，我们说的实际上是本地时间。在国内就是北京时间。</p><p>不同的时区，在同一时刻，本地时间是不同的。全球一共分为24个时区，伦敦所在的时区称为标准时区，其他时区按东／西偏移的小时区分，北京所在的时区是东八区。</p><h3 id="时区">时区</h3><p>因为光靠本地时间还无法唯一确定一个准确的时刻，所以还需要给本地时间加上一个时区。时区有好几种表示方式。</p><p>一种是以<code class="language-plaintext highlighter-rouge">GMT</code>或者<code class="language-plaintext highlighter-rouge">UTC</code>加时区偏移表示，例如：<code class="language-plaintext highlighter-rouge">GMT+08:00</code>或者<code class="language-plaintext highlighter-rouge">UTC+08:00</code>表示东八区。</p><p><code class="language-plaintext highlighter-rouge">GMT</code>和<code class="language-plaintext highlighter-rouge">UTC</code>可以认为基本是等价的，只是<code class="language-plaintext highlighter-rouge">UTC</code>使用更精确的原子钟计时，每隔几年会有一个闰秒，我们在开发程序的时候可以忽略两者的误差，因为计算机的时钟在联网的时候会自动与时间服务器同步时间。</p><p>另一种是缩写，例如，<code class="language-plaintext highlighter-rouge">CST</code>表示<code class="language-plaintext highlighter-rouge">China Standard Time</code>，也就是中国标准时间。但是<code class="language-plaintext highlighter-rouge">CST</code>也可以表示美国中部时间<code class="language-plaintext highlighter-rouge">Central Standard Time USA</code>，因此，缩写容易产生混淆，我们尽量不要使用缩写。</p><p>最后一种是以洲／城市表示，例如，<code class="language-plaintext highlighter-rouge">Asia/Shanghai</code>，表示上海所在地的时区。特别注意城市名称不是任意的城市，而是由国际标准组织规定的城市。</p><p>因为时区的存在，东八区的2019年11月20日早上8:15，和西五区的2019年11月19日晚上19:15，他们的时刻是相同的。时刻相同的意思就是，分别在两个时区的两个人，如果在这一刻通电话，他们各自报出自己手表上的时间，虽然本地时间是不同的，但是这两个时间表示的时刻是相同的。</p><h3 id="夏令时">夏令时</h3><p>时区还不是最复杂的，更复杂的是夏令时。所谓夏令时，就是夏天开始的时候，把时间往后拨1小时，夏天结束的时候，再把时间往前拨1小时。我们国家实行过一段时间夏令时，1992年就废除了，但美国人到现在还在使用，所以时间换算更加复杂。</p><p>因为涉及到夏令时，相同的时区，如果表示的方式不同，转换出的时间是不同的。我们举个栗子：</p><p>对于2019-11-20和2019-6-20两个日期来说，假设北京人在纽约：</p><ul><li>如果以<code class="language-plaintext highlighter-rouge">GMT</code>或者<code class="language-plaintext highlighter-rouge">UTC</code>作为时区，无论日期是多少，时间都是<code class="language-plaintext highlighter-rouge">19:00</code>；</li><li>如果以国家／城市表示，例如<code class="language-plaintext highlighter-rouge">America／NewYork</code>，虽然纽约也在西五区，但是，因为夏令时的存在，在不同的日期，<code class="language-plaintext highlighter-rouge">GMT</code>时间和纽约时间可能是不一样的：</li></ul><table><thead><tr><th style="text-align: left">时区</th><th style="text-align: left">2019-11-20</th><th style="text-align: left">2019-6-20</th></tr></thead><tbody><tr><td style="text-align: left">GMT-05:00</td><td style="text-align: left">19:00</td><td style="text-align: left">19:00</td></tr><tr><td style="text-align: left">UTC-05:00</td><td style="text-align: left">19:00</td><td style="text-align: left">19:00</td></tr><tr><td style="text-align: left">America/New_York</td><td style="text-align: left">19:00</td><td style="text-align: left">20:00</td></tr></tbody></table><p>实行夏令时的不同地区，进入和退出夏令时的时间很可能是不同的。同一个地区，根据历史上是否实行过夏令时，标准时间在不同年份换算成当地时间也是不同的。因此，计算夏令时，没有统一的公式，必须按照一组给定的规则来算，并且，该规则要<strong>定期更新</strong>。</p><p>计算夏令时请使用标准库提供的相关类，不要试图自己计算夏令时。</p><h3 id="本地化">本地化</h3><p>在计算机中，通常使用<code class="language-plaintext highlighter-rouge">Locale</code>表示一个国家或地区的日期、时间、数字、货币等格式。<code class="language-plaintext highlighter-rouge">Locale</code>由<code class="language-plaintext highlighter-rouge">语言_国家</code>的字母缩写构成，例如，<code class="language-plaintext highlighter-rouge">zh_CN</code>表示中文+中国，<code class="language-plaintext highlighter-rouge">en_US</code>表示英文+美国。语言使用小写，国家使用大写。</p><p>对于日期来说，不同的Locale，例如，中国和美国的表示方式如下：</p><ul><li>zh_CN：2016-11-30</li><li>en_US：11/30/2016</li></ul><p>计算机用<code class="language-plaintext highlighter-rouge">Locale</code>在日期、时间、货币和字符串之间进行转换。一个电商网站会根据用户所在的<code class="language-plaintext highlighter-rouge">Locale</code>对用户显示如下：</p><table><thead><tr><th style="text-align: left"> </th><th style="text-align: left">中国用户</th><th style="text-align: left">美国用户</th></tr></thead><tbody><tr><td style="text-align: left">购买价格</td><td style="text-align: left">12000.00</td><td style="text-align: left">12,000.00</td></tr><tr><td style="text-align: left">购买日期</td><td style="text-align: left">2016-11-30</td><td style="text-align: left">11/30/2016</td></tr></tbody></table><h3 id="如何表示时间">如何表示时间</h3><p>在计算机中，应该如何表示日期和时间呢？</p><p>我们经常看到的日期和时间表示方式如下：</p><ul><li>2019-11-20 0:15:00 GMT+00:00</li><li>2019年11月20日8:15:00</li><li>11/19/2019 19:15:00 America/New_York</li></ul><p>如果直接以字符串的形式存储，那么不同的格式，不同的语言会让表示方式非常繁琐。</p><p>在理解日期和时间的表示方式之前，我们先要理解数据的存储和展示。</p><p>当我们定义一个整型变量并赋值时：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">123400</span><span class="o">;</span>
</code></pre></div></div><p>编译器会把上述字符串（程序源码就是一个字符串）编译成字节码。在程序的运行期，变量<code class="language-plaintext highlighter-rouge">n</code>指向的内存实际上是一个4字节区域：</p><pre><code class="language-ascii">┌──┬──┬──┬──┐
│00│01│e2│08│
└──┴──┴──┴──┘
</code></pre><p>注意到计算机内存除了二进制的<code class="language-plaintext highlighter-rouge">0</code>/<code class="language-plaintext highlighter-rouge">1</code>外没有其他任何格式。上述十六机制是为了简化表示。</p><p>当我们用<code class="language-plaintext highlighter-rouge">System.out.println(n)</code>打印这个整数的时候，实际上<code class="language-plaintext highlighter-rouge">println()</code>这个方法在内部把<code class="language-plaintext highlighter-rouge">int</code>类型转换成<code class="language-plaintext highlighter-rouge">String</code>类型，然后打印出字符串<code class="language-plaintext highlighter-rouge">123400</code>。</p><p>类似的，我们也可以以十六进制的形式打印这个整数，或者，如果<code class="language-plaintext highlighter-rouge">n</code>表示一个价格，我们就以<code class="language-plaintext highlighter-rouge">$123,400.00</code>的形式来打印它：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.text.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">123400</span><span class="o">;</span>
        <span class="c1">// 123400</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">n</span><span class="o">);</span>
        <span class="c1">// 1e208</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Integer</span><span class="o">.</span><span class="na">toHexString</span><span class="o">(</span><span class="n">n</span><span class="o">));</span>
        <span class="c1">// $123,400.00</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">NumberFormat</span><span class="o">.</span><span class="na">getCurrencyInstance</span><span class="o">(</span><span class="nc">Locale</span><span class="o">.</span><span class="na">US</span><span class="o">).</span><span class="na">format</span><span class="o">(</span><span class="n">n</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>可见，整数<code class="language-plaintext highlighter-rouge">123400</code>是数据的存储格式，它的存储格式非常简单。而我们打印的各种各样的字符串，则是数据的展示格式。展示格式有多种形式，但本质上它就是一个转换方法：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="nf">toDisplay</span><span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">{}</span>
</code></pre></div></div><p>理解了数据的存储和展示，我们回头看看以下几种日期和时间：</p><ul><li>2019-11-20 0:15:01 GMT+00:00</li><li>2019年11月20日8:15:01</li><li>11/19/2019 19:15:01 America/New_York</li></ul><p>它们实际上是数据的展示格式，分别按英国时区、中国时区、纽约时区对同一个时刻进行展示。而这个“同一个时刻”在计算机中存储的本质上只是一个整数，我们称它为<code class="language-plaintext highlighter-rouge">Epoch Time</code>。</p><p><code class="language-plaintext highlighter-rouge">Epoch Time</code>是计算从1970年1月1日零点（格林威治时区／GMT+00:00）到现在所经历的秒数，例如：</p><p><code class="language-plaintext highlighter-rouge">1574208900</code>表示从1970年1月1日零点GMT时区到该时刻一共经历了1574208900秒，换算成伦敦、北京和纽约时间分别是：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1574208900 = 北京时间2019-11-20 8:15:00
           = 伦敦时间2019-11-20 0:15:00
           = 纽约时间2019-11-19 19:15:00
</code></pre></div></div><p>因此，在计算机中，只需要存储一个整数<code class="language-plaintext highlighter-rouge">1574208900</code>表示某一<strong>时刻</strong>。当需要显示为某一地区的当地时间时，我们就把它格式化为一个字符串：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="nf">displayDateTime</span><span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">,</span> <span class="nc">String</span> <span class="n">timezone</span><span class="o">)</span> <span class="o">{}</span>
</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">Epoch Time</code>又称为<strong>时间戳</strong>，在不同的编程语言中，会有几种存储方式：</p><ul><li>以秒为单位的整数：1574208900，缺点是精度只能到秒；</li><li>以毫秒为单位的整数：1574208900123，最后3位表示毫秒数；</li><li>以秒为单位的浮点数：1574208900.123，小数点后面表示零点几秒。</li></ul><p>它们之间转换非常简单。而在Java程序中，时间戳通常是用<code class="language-plaintext highlighter-rouge">long</code>表示的毫秒数，即：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">long</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">1574208900123L</span><span class="o">;</span>
</code></pre></div></div><p>转换成北京时间就是<code class="language-plaintext highlighter-rouge">2019-11-20T8:15:00.123</code>。要获取当前时间戳，可以使用<code class="language-plaintext highlighter-rouge">System.currentTimeMillis()</code>，这是Java程序获取时间戳最常用的方法。</p><h3 id="标准库api">标准库API</h3><p>Java标准库有两套处理日期和时间的API：</p><ul><li>一套定义在<code class="language-plaintext highlighter-rouge">java.util</code>这个包里面，主要包括<code class="language-plaintext highlighter-rouge">Date</code>、<code class="language-plaintext highlighter-rouge">Calendar</code>和<code class="language-plaintext highlighter-rouge">TimeZone</code>这几个类；</li><li>一套新的API是在Java 8引入的，定义在<code class="language-plaintext highlighter-rouge">java.time</code>这个包里面，主要包括<code class="language-plaintext highlighter-rouge">LocalDateTime</code>、<code class="language-plaintext highlighter-rouge">ZonedDateTime</code>、<code class="language-plaintext highlighter-rouge">ZoneId</code>等。</li></ul><p>为什么会有新旧两套API呢？因为历史遗留原因，旧的API存在很多问题，所以引入了新的API。</p><p>那么我们能不能跳过旧的API直接用新的API呢？如果涉及到遗留代码就不行，因为很多遗留代码仍然使用旧的API，所以目前仍然需要对旧的API有一定了解，很多时候还需要在新旧两种对象之间进行转换。</p><h2 id="旧api">旧API</h2><h3 id="date">Date</h3><p><code class="language-plaintext highlighter-rouge">java.util.Date</code>是用于表示一个日期和时间的对象，注意与<code class="language-plaintext highlighter-rouge">java.sql.Date</code>区分，后者用在数据库中。Date的源码中存储了一个long类型的以毫秒表示的时间戳：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Date</span> <span class="kd">implements</span> <span class="nc">Serializable</span><span class="o">,</span> <span class="nc">Cloneable</span><span class="o">,</span> <span class="nc">Comparable</span><span class="o">&lt;</span><span class="nc">Date</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">transient</span> <span class="kt">long</span> <span class="n">fastTime</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div><p>基本用法：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 获取当前时间:</span>
        <span class="nc">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">date</span><span class="o">.</span><span class="na">getYear</span><span class="o">()</span> <span class="o">+</span> <span class="mi">1900</span><span class="o">);</span> <span class="c1">// 必须加上1900</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">date</span><span class="o">.</span><span class="na">getMonth</span><span class="o">()</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span> <span class="c1">// 0~11，必须加上1</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">date</span><span class="o">.</span><span class="na">getDate</span><span class="o">());</span> <span class="c1">// 1~31，不需要改变</span>
        <span class="c1">// 转换为String:</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">date</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="c1">// 转换为GMT时区:</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">date</span><span class="o">.</span><span class="na">toGMTString</span><span class="o">());</span>
        <span class="c1">// 转换为本地时区:</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">date</span><span class="o">.</span><span class="na">toLocaleString</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>打印本地时区表示的日期和时间时，不同的计算机可能会有不同的结果。</p><p><code class="language-plaintext highlighter-rouge">Date</code>对象有几个<strong>严重</strong>的问题：它<strong>不能转换时区</strong>，除了<code class="language-plaintext highlighter-rouge">toGMTString()</code>可以按<code class="language-plaintext highlighter-rouge">GMT+0:00</code>输出外，Date总是以<strong>当前计算机系统的默认时区</strong>为基础进行输出。此外，我们也很难对日期和时间进行加减，计算两个日期相差多少天，计算某个月第一个星期一的日期等。</p><h3 id="simpledateformat">SimpleDateFormat</h3><p>如果想要精确地控制日期和时间的格式，可以使用<code class="language-plaintext highlighter-rouge">SimpleDateFormat</code>对一个<code class="language-plaintext highlighter-rouge">Date</code>进行转换。它用预定义的字符串表示格式化：</p><ul><li>yyyy：年</li><li>MM：月</li><li>dd: 日</li><li>HH: 小时</li><li>mm: 分钟</li><li>ss: 秒</li></ul><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.text.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 获取当前时间:</span>
        <span class="nc">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">();</span>
        <span class="kt">var</span> <span class="n">sdf</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">"yyyy-MM-dd HH:mm:ss"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">sdf</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">date</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>Java的格式化预定义了许多不同的格式，我们以<code class="language-plaintext highlighter-rouge">MMM</code>和<code class="language-plaintext highlighter-rouge">E</code>为例：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.text.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 获取当前时间:</span>
        <span class="nc">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">();</span>
        <span class="kt">var</span> <span class="n">sdf</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">"E MMM dd, yyyy"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">sdf</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">date</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>上述代码在不同的语言环境会打印出类似<code class="language-plaintext highlighter-rouge">Sun Sep 15, 2019</code>这样的日期。可以从<a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/text/SimpleDateFormat.html">JDK文档</a>查看详细的格式说明。一般来说，字母越长，输出越长。以<code class="language-plaintext highlighter-rouge">M</code>为例，假设当前月份是9月：</p><ul><li><code class="language-plaintext highlighter-rouge">M</code>：输出<code class="language-plaintext highlighter-rouge">9</code></li><li><code class="language-plaintext highlighter-rouge">MM</code>：输出<code class="language-plaintext highlighter-rouge">09</code></li><li><code class="language-plaintext highlighter-rouge">MMM</code>：输出<code class="language-plaintext highlighter-rouge">Sep</code></li><li><code class="language-plaintext highlighter-rouge">MMMM</code>：输出<code class="language-plaintext highlighter-rouge">September</code></li></ul><h3 id="calendar">Calendar</h3><p><code class="language-plaintext highlighter-rouge">Calendar</code>可以用于获取并设置年、月、日、时、分、秒，它和<code class="language-plaintext highlighter-rouge">Date</code>比，主要多了一个可以做简单的日期和时间<strong>运算</strong>的功能。</p><p>我们来看<code class="language-plaintext highlighter-rouge">Calendar</code>的基本用法：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 获取当前时间:</span>
        <span class="nc">Calendar</span> <span class="n">c</span> <span class="o">=</span> <span class="nc">Calendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">YEAR</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">c</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">MONTH</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">d</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">DAY_OF_MONTH</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">w</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">DAY_OF_WEEK</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">hh</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">HOUR_OF_DAY</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">mm</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">MINUTE</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">ss</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">SECOND</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">ms</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">MILLISECOND</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">y</span> <span class="o">+</span> <span class="s">"-"</span> <span class="o">+</span> <span class="n">m</span> <span class="o">+</span> <span class="s">"-"</span> <span class="o">+</span> <span class="n">d</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">w</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">hh</span> <span class="o">+</span> <span class="s">":"</span> <span class="o">+</span> <span class="n">mm</span> <span class="o">+</span> <span class="s">":"</span> <span class="o">+</span> <span class="n">ss</span> <span class="o">+</span> <span class="s">"."</span> <span class="o">+</span> <span class="n">ms</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>注意到<code class="language-plaintext highlighter-rouge">Calendar</code>获取年月日这些信息变成了<code class="language-plaintext highlighter-rouge">get(int field)</code>，返回的年份不必转换，返回的月份仍然要加1，返回的星期要<strong>特别注意</strong>，<code class="language-plaintext highlighter-rouge">1</code>~<code class="language-plaintext highlighter-rouge">7</code>分别表示周日，周一，……，周六。</p><p><code class="language-plaintext highlighter-rouge">Calendar</code>只有一种方式获取，即<code class="language-plaintext highlighter-rouge">Calendar.getInstance()</code>，而且一获取到就是当前时间。如果我们想给它设置成特定的一个日期和时间，就必须先清除所有字段：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.text.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 当前时间:</span>
        <span class="nc">Calendar</span> <span class="n">c</span> <span class="o">=</span> <span class="nc">Calendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
        <span class="c1">// 清除所有:</span>
        <span class="n">c</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
        <span class="c1">// 设置2019年:</span>
        <span class="n">c</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">YEAR</span><span class="o">,</span> <span class="mi">2019</span><span class="o">);</span>
        <span class="c1">// 设置9月:注意8表示9月:</span>
        <span class="n">c</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">MONTH</span><span class="o">,</span> <span class="mi">8</span><span class="o">);</span>
        <span class="c1">// 设置2日:</span>
        <span class="n">c</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">DATE</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
        <span class="c1">// 设置时间:</span>
        <span class="n">c</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">HOUR_OF_DAY</span><span class="o">,</span> <span class="mi">21</span><span class="o">);</span>
        <span class="n">c</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">MINUTE</span><span class="o">,</span> <span class="mi">22</span><span class="o">);</span>
        <span class="n">c</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">SECOND</span><span class="o">,</span> <span class="mi">23</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">"yyyy-MM-dd HH:mm:ss"</span><span class="o">).</span><span class="na">format</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getTime</span><span class="o">()));</span>
        <span class="c1">// 2019-09-02 21:22:23</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>利用<code class="language-plaintext highlighter-rouge">Calendar.getTime()</code>可以将一个<code class="language-plaintext highlighter-rouge">Calendar</code>对象转换成<code class="language-plaintext highlighter-rouge">Date</code>对象，然后就可以用<code class="language-plaintext highlighter-rouge">SimpleDateFormat</code>进行格式化了。</p><p><code class="language-plaintext highlighter-rouge">Calendar</code>也可以对日期和时间进行简单的加减：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.text.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 当前时间:</span>
        <span class="nc">Calendar</span> <span class="n">c</span> <span class="o">=</span> <span class="nc">Calendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
        <span class="c1">// 清除所有:</span>
        <span class="n">c</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
        <span class="c1">// 设置年月日时分秒:</span>
        <span class="n">c</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="mi">2019</span><span class="o">,</span> <span class="mi">10</span> <span class="cm">/* 11月 */</span><span class="o">,</span> <span class="mi">20</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
        <span class="c1">// 加5天并减去2小时:</span>
        <span class="n">c</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">DAY_OF_MONTH</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span>
        <span class="n">c</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">HOUR_OF_DAY</span><span class="o">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">);</span>
        <span class="c1">// 显示时间:</span>
        <span class="kt">var</span> <span class="n">sdf</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">"yyyy-MM-dd HH:mm:ss"</span><span class="o">);</span>
        <span class="nc">Date</span> <span class="n">d</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">getTime</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">sdf</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">d</span><span class="o">));</span>
        <span class="c1">// 2019-11-25 6:15:00</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><h3 id="timezone">TimeZone</h3><p>时区用<code class="language-plaintext highlighter-rouge">TimeZone</code>对象表示：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">TimeZone</span> <span class="n">tzDefault</span> <span class="o">=</span> <span class="nc">TimeZone</span><span class="o">.</span><span class="na">getDefault</span><span class="o">();</span> <span class="c1">// 当前时区</span>
        <span class="nc">TimeZone</span> <span class="n">tzGMT9</span> <span class="o">=</span> <span class="nc">TimeZone</span><span class="o">.</span><span class="na">getTimeZone</span><span class="o">(</span><span class="s">"GMT+09:00"</span><span class="o">);</span> <span class="c1">// GMT+9:00时区</span>
        <span class="nc">TimeZone</span> <span class="n">tzNY</span> <span class="o">=</span> <span class="nc">TimeZone</span><span class="o">.</span><span class="na">getTimeZone</span><span class="o">(</span><span class="s">"America/New_York"</span><span class="o">);</span> <span class="c1">// 纽约时区</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">tzDefault</span><span class="o">.</span><span class="na">getID</span><span class="o">());</span> <span class="c1">// Asia/Shanghai</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">tzGMT9</span><span class="o">.</span><span class="na">getID</span><span class="o">());</span> <span class="c1">// GMT+09:00</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">tzNY</span><span class="o">.</span><span class="na">getID</span><span class="o">());</span> <span class="c1">// America/New_York</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>时区的唯一标识是以字符串表示的ID，我们获取指定<code class="language-plaintext highlighter-rouge">TimeZone</code>对象也是以这个ID为参数获取，<code class="language-plaintext highlighter-rouge">GMT+09:00</code>、<code class="language-plaintext highlighter-rouge">Asia/Shanghai</code>都是有效的时区ID。要列出系统支持的所有ID，请使用<code class="language-plaintext highlighter-rouge">TimeZone.getAvailableIDs()</code>。</p><h3 id="时区转换">时区转换</h3><p><code class="language-plaintext highlighter-rouge">Calendar</code>和<code class="language-plaintext highlighter-rouge">Date</code>相比，提供了时区转换的功能。有了时区，我们就可以对指定时间进行转换。例如，下面的例子演示了如何将北京时间<code class="language-plaintext highlighter-rouge">2019-11-20 8:15:00</code><strong>转换为</strong>纽约时间：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.text.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 当前时间:</span>
        <span class="nc">Calendar</span> <span class="n">c</span> <span class="o">=</span> <span class="nc">Calendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
        <span class="c1">// 清除所有:</span>
        <span class="n">c</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
        <span class="c1">// 设置为北京时区:</span>
        <span class="n">c</span><span class="o">.</span><span class="na">setTimeZone</span><span class="o">(</span><span class="nc">TimeZone</span><span class="o">.</span><span class="na">getTimeZone</span><span class="o">(</span><span class="s">"Asia/Shanghai"</span><span class="o">));</span>
        <span class="c1">// 设置年月日时分秒:</span>
        <span class="n">c</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="mi">2019</span><span class="o">,</span> <span class="mi">10</span> <span class="cm">/* 11月 */</span><span class="o">,</span> <span class="mi">20</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
        <span class="c1">// 显示时间:</span>
        <span class="kt">var</span> <span class="n">sdf</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">"yyyy-MM-dd HH:mm:ss"</span><span class="o">);</span>
        <span class="n">sdf</span><span class="o">.</span><span class="na">setTimeZone</span><span class="o">(</span><span class="nc">TimeZone</span><span class="o">.</span><span class="na">getTimeZone</span><span class="o">(</span><span class="s">"America/New_York"</span><span class="o">));</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">sdf</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getTime</span><span class="o">()));</span>
        <span class="c1">// 2019-11-19 19:15:00</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>可见，利用<code class="language-plaintext highlighter-rouge">Calendar</code>进行时区转换的步骤是：</p><ol><li>清除所有字段；</li><li>设定<strong>指定时区</strong>；</li><li>设定日期和时间；</li><li>创建<code class="language-plaintext highlighter-rouge">SimpleDateFormat</code>并设定要转换为的<strong>目标时区</strong>；</li><li>格式化获取的<code class="language-plaintext highlighter-rouge">Date</code>对象（<strong>注意<code class="language-plaintext highlighter-rouge">Date</code>对象无时区信息，时区信息存储在<code class="language-plaintext highlighter-rouge">SimpleDateFormat</code>中</strong>）。</li></ol><p>因此，本质上时区转换只能通过<code class="language-plaintext highlighter-rouge">SimpleDateFormat</code>在<strong>显示的时候完成</strong>。</p><p><strong>用SimpleDateFormat将Data转换为指定时区显示</strong></p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">SimpleDateFormat</span> <span class="n">sdf2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">"yyyy-MM-dd HH:mm:ss"</span><span class="o">);</span>
<span class="n">sdf2</span><span class="o">.</span><span class="na">setTimeZone</span><span class="o">(</span><span class="nc">TimeZone</span><span class="o">.</span><span class="na">getTimeZone</span><span class="o">(</span><span class="s">"America/New_York"</span><span class="o">));</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">sdf2</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">()));</span>
</code></pre></div></div><h2 id="新api">新API</h2><p>从<strong>Java 8</strong>开始，<code class="language-plaintext highlighter-rouge">java.time</code>包提供了新的日期和时间API，主要涉及的类型有：</p><ul><li>本地日期和时间：<code class="language-plaintext highlighter-rouge">LocalDateTime</code>，<code class="language-plaintext highlighter-rouge">LocalDate</code>，<code class="language-plaintext highlighter-rouge">LocalTime</code>；</li><li>带时区的日期和时间：<code class="language-plaintext highlighter-rouge">ZonedDateTime</code>；</li><li>时刻：<code class="language-plaintext highlighter-rouge">Instant</code>；</li><li>时区：<code class="language-plaintext highlighter-rouge">ZoneId</code>，<code class="language-plaintext highlighter-rouge">ZoneOffset</code>；</li><li>时间间隔：<code class="language-plaintext highlighter-rouge">Duration</code>。</li></ul><p>以及一套新的用于取代<code class="language-plaintext highlighter-rouge">SimpleDateFormat</code>的格式化类型<code class="language-plaintext highlighter-rouge">DateTimeFormatter</code>。</p><p>和旧的API相比，新API严格区分了时刻、本地日期、本地时间和带时区的日期时间，并且，对日期和时间进行运算更加方便。</p><p>此外，新API修正了旧API不合理的常量设计：</p><ul><li><strong>Month的范围用1~12表示1月到12月；</strong></li><li><strong>Week的范围用1~7表示周一到周日。</strong></li></ul><p>最后，新API的类型几乎全部是不变类型（和String类似），可以放心使用不必担心被修改。</p><h3 id="localdatetime">LocalDateTime</h3><p>我们首先来看最常用的<code class="language-plaintext highlighter-rouge">LocalDateTime</code>，它表示一个本地日期和时间：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.time.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">LocalDate</span> <span class="n">d</span> <span class="o">=</span> <span class="nc">LocalDate</span><span class="o">.</span><span class="na">now</span><span class="o">();</span> <span class="c1">// 当前日期</span>
        <span class="nc">LocalTime</span> <span class="n">t</span> <span class="o">=</span> <span class="nc">LocalTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span> <span class="c1">// 当前时间</span>
        <span class="nc">LocalDateTime</span> <span class="n">dt</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span> <span class="c1">// 当前日期和时间</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">d</span><span class="o">);</span> <span class="c1">// 严格按照ISO 8601格式打印</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">t</span><span class="o">);</span> <span class="c1">// 严格按照ISO 8601格式打印</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">dt</span><span class="o">);</span> <span class="c1">// 严格按照ISO 8601格式打印</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>控制台：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">2024</span><span class="o">-</span><span class="mo">04</span><span class="o">-</span><span class="mi">13</span>
<span class="mi">11</span><span class="o">:</span><span class="mi">46</span><span class="o">:</span><span class="mf">38.314562900</span>
<span class="mi">2021</span><span class="o">-</span><span class="mo">07</span><span class="o">-</span><span class="mi">13</span><span class="nl">T11:</span><span class="mi">46</span><span class="o">:</span><span class="mf">38.314562900</span>
</code></pre></div></div><p>如果不想显示纳秒，可以把纳秒位清零：</p><p><code class="language-plaintext highlighter-rouge">LocalTime.now().withNano(0)</code>可以将当前时间的纳秒部分清零，得到一个没有纳秒的时间。同样地，<code class="language-plaintext highlighter-rouge">LocalDateTime.now().withNano(0)</code>可以将当前日期时间的纳秒部分清零，得到一个没有纳秒的日期时间。</p><p>本地日期和时间通过<code class="language-plaintext highlighter-rouge">now()</code>获取到的总是以当前默认时区返回的，和旧API不同，<code class="language-plaintext highlighter-rouge">LocalDateTime</code>、<code class="language-plaintext highlighter-rouge">LocalDate</code>和<code class="language-plaintext highlighter-rouge">LocalTime</code>默认严格按照<a href="https://www.iso.org/iso-8601-date-and-time-format.html">ISO 8601</a>规定的日期和时间格式进行打印。</p><p>上述代码其实有一个小问题，在获取3个类型的时候，由于执行一行代码总会消耗一点时间，因此，3个类型的日期和时间很可能对不上（时间的毫秒数基本上不同）。为了保证获取到同一时刻的日期和时间，可以改写如下：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">LocalDateTime</span> <span class="n">dt</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span> <span class="c1">// 当前日期和时间</span>
<span class="nc">LocalDate</span> <span class="n">d</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="na">toLocalDate</span><span class="o">();</span> <span class="c1">// 转换到当前日期</span>
<span class="nc">LocalTime</span> <span class="n">t</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="na">toLocalTime</span><span class="o">();</span> <span class="c1">// 转换到当前时间</span>
</code></pre></div></div><p>反过来，通过指定的日期和时间创建<code class="language-plaintext highlighter-rouge">LocalDateTime</code>可以通过<code class="language-plaintext highlighter-rouge">of()</code>方法：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 指定日期和时间:</span>
<span class="nc">LocalDate</span> <span class="n">d2</span> <span class="o">=</span> <span class="nc">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2019</span><span class="o">,</span> <span class="mi">11</span><span class="o">,</span> <span class="mi">30</span><span class="o">);</span> <span class="c1">// 2019-11-30, 注意11=11月</span>
<span class="nc">LocalTime</span> <span class="n">t2</span> <span class="o">=</span> <span class="nc">LocalTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">15</span><span class="o">,</span> <span class="mi">16</span><span class="o">,</span> <span class="mi">17</span><span class="o">);</span> <span class="c1">// 15:16:17</span>
<span class="nc">LocalDateTime</span> <span class="n">dt2</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2019</span><span class="o">,</span> <span class="mi">11</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">16</span><span class="o">,</span> <span class="mi">17</span><span class="o">);</span>
<span class="nc">LocalDateTime</span> <span class="n">dt3</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">d2</span><span class="o">,</span> <span class="n">t2</span><span class="o">);</span>
</code></pre></div></div><p>因为严格按照ISO 8601的格式，因此，将字符串转换为<code class="language-plaintext highlighter-rouge">LocalDateTime</code>就可以传入标准格式：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">LocalDateTime</span> <span class="n">dt</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"2019-11-19T15:16:17"</span><span class="o">);</span>
<span class="nc">LocalDate</span> <span class="n">d</span> <span class="o">=</span> <span class="nc">LocalDate</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"2019-11-19"</span><span class="o">);</span>
<span class="nc">LocalTime</span> <span class="n">t</span> <span class="o">=</span> <span class="nc">LocalTime</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"15:16:17"</span><span class="o">);</span>
</code></pre></div></div><p>注意ISO 8601<strong>规定</strong>的日期和时间分隔符是<code class="language-plaintext highlighter-rouge">T</code>。标准格式如下：</p><ul><li>日期：yyyy-MM-dd</li><li>时间：HH:mm:ss</li><li>带毫秒的时间：HH:mm:ss.SSS</li><li>日期和时间：yyyy-MM-dd’T’HH:mm:ss</li><li>带毫秒的日期和时间：yyyy-MM-dd’T’HH:mm:ss.SSS</li></ul><p><code class="language-plaintext highlighter-rouge">LocalDateTime</code>提供了对日期和时间进行加减的非常简单的链式调用：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.time.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">LocalDateTime</span> <span class="n">dt</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2019</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">26</span><span class="o">,</span> <span class="mi">20</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="mi">59</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">dt</span><span class="o">);</span>
        <span class="c1">// 加5天减3小时:</span>
        <span class="nc">LocalDateTime</span> <span class="n">dt2</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="na">plusDays</span><span class="o">(</span><span class="mi">5</span><span class="o">).</span><span class="na">minusHours</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">dt2</span><span class="o">);</span> <span class="c1">// 2019-10-31T17:30:59</span>
        <span class="c1">// 减1月:</span>
        <span class="nc">LocalDateTime</span> <span class="n">dt3</span> <span class="o">=</span> <span class="n">dt2</span><span class="o">.</span><span class="na">minusMonths</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">dt3</span><span class="o">);</span> <span class="c1">// 2019-09-30T17:30:59</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>注意到<strong>月份加减会自动调整日期</strong>，例如从<code class="language-plaintext highlighter-rouge">2019-10-31</code>减去1个月得到的结果是<code class="language-plaintext highlighter-rouge">2019-09-30</code>，<strong>因为9月没有31日</strong>。</p><p>对于<code class="language-plaintext highlighter-rouge">LocalDateTime</code>的<strong>加减</strong>操作，遵循以下规则：</p><ol><li><strong>月份加减</strong>：如果当前日期的月份为1到12之间的值，加减月份时会<strong>自动调整日期</strong>。例如，从1月31日减去一个月会得到2月28日（非闰年）或者2月29日（闰年），而不是简单地将日期减去30天。</li><li><strong>年份加减</strong>：年份的加减会保持当前日期的月份和日不变，也同时会确保日期的合法性。例如，2024年2月29日减去一年后，会变成2023年2月28日。</li><li><strong>其他字段加减</strong>：对于其他字段的加减操作（如天、小时、分钟、秒等），会根据当前日期时间的范围自动调整其他字段。如果在2019年10月31日23点加上1小时，结果会是2019年11月1日0点。</li></ol><p><code class="language-plaintext highlighter-rouge">LocalDateTime</code>会根据当前日期时间的范围自动调整其他字段，<code class="language-plaintext highlighter-rouge">LocalDateTime</code>会<strong>尽量保持</strong>结果的合法性，避免出现不符合日期时间逻辑的结果。</p><hr /><p>对日期和时间进行<strong>调整</strong>则使用<code class="language-plaintext highlighter-rouge">withXxx()</code>方法，例如：<code class="language-plaintext highlighter-rouge">withHour(15)</code>会把<code class="language-plaintext highlighter-rouge">10:11:12</code>变为<code class="language-plaintext highlighter-rouge">15:11:12</code>：</p><ul><li>调整年：<code class="language-plaintext highlighter-rouge">withYear()</code></li><li>调整月：<code class="language-plaintext highlighter-rouge">withMonth()</code></li><li>调整日：<code class="language-plaintext highlighter-rouge">withDayOfMonth()</code></li><li>调整时：<code class="language-plaintext highlighter-rouge">withHour()</code></li><li>调整分：<code class="language-plaintext highlighter-rouge">withMinute()</code></li><li>调整秒：<code class="language-plaintext highlighter-rouge">withSecond()</code></li></ul><p>示例代码如下：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.time.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">LocalDateTime</span> <span class="n">dt</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2019</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">26</span><span class="o">,</span> <span class="mi">20</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="mi">59</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">dt</span><span class="o">);</span>
        <span class="c1">// 日期变为31日:</span>
        <span class="nc">LocalDateTime</span> <span class="n">dt2</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="na">withDayOfMonth</span><span class="o">(</span><span class="mi">31</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">dt2</span><span class="o">);</span> <span class="c1">// 2019-10-31T20:30:59</span>
        <span class="c1">// 月份变为9:</span>
        <span class="nc">LocalDateTime</span> <span class="n">dt3</span> <span class="o">=</span> <span class="n">dt2</span><span class="o">.</span><span class="na">withMonth</span><span class="o">(</span><span class="mi">9</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">dt3</span><span class="o">);</span> <span class="c1">// 2019-09-30T20:30:59</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>同样注意到调整月份时，会相应地调整日期，即把<code class="language-plaintext highlighter-rouge">2019-10-31</code>的月份调整为<code class="language-plaintext highlighter-rouge">9</code>时，日期也自动变为<code class="language-plaintext highlighter-rouge">30</code>。</p><hr /><p>实际上，<code class="language-plaintext highlighter-rouge">LocalDateTime</code>还有一个通用的<code class="language-plaintext highlighter-rouge">with()</code>方法允许我们做更复杂的运算。例如：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.time.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.time.temporal.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 本月第一天0:00时刻:</span>
        <span class="nc">LocalDateTime</span> <span class="n">firstDay</span> <span class="o">=</span> <span class="nc">LocalDate</span><span class="o">.</span><span class="na">now</span><span class="o">().</span><span class="na">withDayOfMonth</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="na">atStartOfDay</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">firstDay</span><span class="o">);</span>
        <span class="c1">// 本月最后1天:</span>
        <span class="nc">LocalDate</span> <span class="n">lastDay</span> <span class="o">=</span> <span class="nc">LocalDate</span><span class="o">.</span><span class="na">now</span><span class="o">().</span><span class="na">with</span><span class="o">(</span><span class="nc">TemporalAdjusters</span><span class="o">.</span><span class="na">lastDayOfMonth</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">lastDay</span><span class="o">);</span>
        <span class="c1">// 下月第1天:</span>
        <span class="nc">LocalDate</span> <span class="n">nextMonthFirstDay</span> <span class="o">=</span> <span class="nc">LocalDate</span><span class="o">.</span><span class="na">now</span><span class="o">().</span><span class="na">with</span><span class="o">(</span><span class="nc">TemporalAdjusters</span><span class="o">.</span><span class="na">firstDayOfNextMonth</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">nextMonthFirstDay</span><span class="o">);</span>
        <span class="c1">// 本月第1个周一:</span>
        <span class="nc">LocalDate</span> <span class="n">firstWeekday</span> <span class="o">=</span> <span class="nc">LocalDate</span><span class="o">.</span><span class="na">now</span><span class="o">().</span><span class="na">with</span><span class="o">(</span><span class="nc">TemporalAdjusters</span><span class="o">.</span><span class="na">firstInMonth</span><span class="o">(</span><span class="nc">DayOfWeek</span><span class="o">.</span><span class="na">MONDAY</span><span class="o">));</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">firstWeekday</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>对于计算某个月第1个周日这样的问题，新的API可以轻松完成。</p><hr /><p>要判断两个<code class="language-plaintext highlighter-rouge">LocalDateTime</code>的先后，可以使用<code class="language-plaintext highlighter-rouge">isBefore()</code>、<code class="language-plaintext highlighter-rouge">isAfter()</code>方法，对于<code class="language-plaintext highlighter-rouge">LocalDate</code>和<code class="language-plaintext highlighter-rouge">LocalTime</code>类似：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.time.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">LocalDateTime</span> <span class="n">now</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
        <span class="nc">LocalDateTime</span> <span class="n">target</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2019</span><span class="o">,</span> <span class="mi">11</span><span class="o">,</span> <span class="mi">19</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">now</span><span class="o">.</span><span class="na">isBefore</span><span class="o">(</span><span class="n">target</span><span class="o">));</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">LocalDate</span><span class="o">.</span><span class="na">now</span><span class="o">().</span><span class="na">isBefore</span><span class="o">(</span><span class="nc">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2019</span><span class="o">,</span> <span class="mi">11</span><span class="o">,</span> <span class="mi">19</span><span class="o">)));</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">LocalTime</span><span class="o">.</span><span class="na">now</span><span class="o">().</span><span class="na">isAfter</span><span class="o">(</span><span class="nc">LocalTime</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"08:15:00"</span><span class="o">)));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>注意到<code class="language-plaintext highlighter-rouge">LocalDateTime</code>无法与时间戳进行转换，因为<code class="language-plaintext highlighter-rouge">LocalDateTime</code>没有时区，无法确定某一时刻。后面我们要介绍的<code class="language-plaintext highlighter-rouge">ZonedDateTime</code>相当于<code class="language-plaintext highlighter-rouge">LocalDateTime</code>加时区的组合，它具<strong>有时区</strong>，可以与<code class="language-plaintext highlighter-rouge">long</code>表示的时间戳进行转换。</p><h3 id="duration和period">Duration和Period</h3><p><code class="language-plaintext highlighter-rouge">Duration</code>和<code class="language-plaintext highlighter-rouge">Period</code>的表示方法也符合ISO 8601的格式，它以<code class="language-plaintext highlighter-rouge">P...T...</code>的形式表示，<code class="language-plaintext highlighter-rouge">P...T</code>之间表示日期间隔，<code class="language-plaintext highlighter-rouge">T</code>后面表示时间间隔。如果是<code class="language-plaintext highlighter-rouge">PT...</code>的格式表示仅有时间间隔。利用<code class="language-plaintext highlighter-rouge">ofXxx()</code>或者<code class="language-plaintext highlighter-rouge">parse()</code>方法也可以直接创建<code class="language-plaintext highlighter-rouge">Duration</code>：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Duration</span> <span class="n">d1</span> <span class="o">=</span> <span class="nc">Duration</span><span class="o">.</span><span class="na">ofHours</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span> <span class="c1">// 10 hours</span>
<span class="nc">Duration</span> <span class="n">d2</span> <span class="o">=</span> <span class="nc">Duration</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"P1DT2H3M"</span><span class="o">);</span> <span class="c1">// 1 day, 2 hours, 3 minutes</span>
</code></pre></div></div><p>Java 8引入的<code class="language-plaintext highlighter-rouge">java.time</code>API。怎么和一个开源的<a href="https://www.joda.org/">Joda Time</a>很像？难道JDK也开始抄袭开源了？其实正是因为开源的Joda Time设计很好，应用广泛，所以JDK团队邀请Joda Time的作者Stephen Colebourne共同设计了<code class="language-plaintext highlighter-rouge">java.time</code>API。</p><p><code class="language-plaintext highlighter-rouge">Duration</code>表示两个时刻之间的<strong>时间间隔</strong>。另一个类似的<code class="language-plaintext highlighter-rouge">Period</code>表示两个日期之间的天数：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.time.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">LocalDateTime</span> <span class="n">start</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2019</span><span class="o">,</span> <span class="mi">11</span><span class="o">,</span> <span class="mi">19</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
        <span class="nc">LocalDateTime</span> <span class="n">end</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2020</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">19</span><span class="o">,</span> <span class="mi">25</span><span class="o">,</span> <span class="mi">30</span><span class="o">);</span>
        <span class="nc">Duration</span> <span class="n">d</span> <span class="o">=</span> <span class="nc">Duration</span><span class="o">.</span><span class="na">between</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">end</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">d</span><span class="o">);</span> <span class="c1">// PT1235H10M30S</span>
        <span class="nc">Period</span> <span class="n">p</span> <span class="o">=</span> <span class="nc">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2019</span><span class="o">,</span> <span class="mi">11</span><span class="o">,</span> <span class="mi">19</span><span class="o">).</span><span class="na">until</span><span class="o">(</span><span class="nc">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2020</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">9</span><span class="o">));</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">p</span><span class="o">);</span> <span class="c1">// P1M21D</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>注意到两个<code class="language-plaintext highlighter-rouge">LocalDateTime</code>之间的差值使用<code class="language-plaintext highlighter-rouge">Duration</code>表示，类似<code class="language-plaintext highlighter-rouge">PT1235H10M30S</code>，表示1235小时10分钟30秒。而两个<code class="language-plaintext highlighter-rouge">LocalDate</code>之间的差值用<code class="language-plaintext highlighter-rouge">Period</code>表示，类似<code class="language-plaintext highlighter-rouge">P1M21D</code>，表示1个月21天。而这里的一个月要结合具体开始日期来计算。</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">LocalDate</span> <span class="n">l1</span> <span class="o">=</span> <span class="nc">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2024</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
<span class="nc">LocalDate</span> <span class="n">l2</span> <span class="o">=</span> <span class="nc">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2024</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">l1</span><span class="o">+</span><span class="s">"~"</span><span class="o">+</span><span class="n">l2</span><span class="o">+</span><span class="s">":"</span><span class="o">+</span><span class="n">l1</span><span class="o">.</span><span class="na">until</span><span class="o">(</span><span class="n">l2</span><span class="o">));</span><span class="c1">//2024-02-01~2024-03-04:P1M3D</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">ChronoUnit</span><span class="o">.</span><span class="na">DAYS</span><span class="o">.</span><span class="na">between</span><span class="o">(</span><span class="n">l1</span><span class="o">,</span> <span class="n">l2</span><span class="o">));</span><span class="c1">//32</span>
<span class="n">l1</span><span class="o">=</span><span class="n">l1</span><span class="o">.</span><span class="na">withYear</span><span class="o">(</span><span class="mi">2023</span><span class="o">);</span>
<span class="n">l2</span><span class="o">=</span><span class="n">l2</span><span class="o">.</span><span class="na">withYear</span><span class="o">(</span><span class="mi">2023</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">l1</span><span class="o">+</span><span class="s">"~"</span><span class="o">+</span><span class="n">l2</span><span class="o">+</span><span class="s">":"</span><span class="o">+</span><span class="n">l1</span><span class="o">.</span><span class="na">until</span><span class="o">(</span><span class="n">l2</span><span class="o">));</span><span class="c1">//2023-02-01~2023-03-04:P1M3D</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">ChronoUnit</span><span class="o">.</span><span class="na">DAYS</span><span class="o">.</span><span class="na">between</span><span class="o">(</span><span class="n">l1</span><span class="o">,</span> <span class="n">l2</span><span class="o">));</span><span class="c1">//31</span>
<span class="n">l1</span><span class="o">=</span><span class="n">l1</span><span class="o">.</span><span class="na">withMonth</span><span class="o">(</span><span class="mi">3</span><span class="o">).</span><span class="na">withDayOfMonth</span><span class="o">(</span><span class="mi">4</span><span class="o">);</span>
<span class="n">l2</span><span class="o">=</span><span class="n">l2</span><span class="o">.</span><span class="na">withMonth</span><span class="o">(</span><span class="mi">2</span><span class="o">).</span><span class="na">withDayOfMonth</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">l1</span><span class="o">+</span><span class="s">"~"</span><span class="o">+</span><span class="n">l2</span><span class="o">+</span><span class="s">":"</span><span class="o">+</span><span class="n">l1</span><span class="o">.</span><span class="na">until</span><span class="o">(</span><span class="n">l2</span><span class="o">));</span><span class="c1">//2023-03-04~2023-02-01:P-1M-3D</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">ChronoUnit</span><span class="o">.</span><span class="na">DAYS</span><span class="o">.</span><span class="na">between</span><span class="o">(</span><span class="n">l1</span><span class="o">,</span> <span class="n">l2</span><span class="o">));</span><span class="c1">//31</span>
</code></pre></div></div><p><strong>为啥无论是否闰年都是P1M3D？</strong></p><p><code class="language-plaintext highlighter-rouge">Period</code>类表示的是日期之间的差距，它以<strong>年、月、日为单位</strong>表示两个日期之间的间隔。这里涉及到月份的计算方式：计算月份差距时，会先计算月份的差距，然后再计算天数的差距。</p><p>这里的一个月是指一个自然月，而<strong>不是固定的天数</strong>，一个月可能是28、29、30、31天。</p><p>因此，如果从2月1日到3月4日有32天（包括2月份的29天和3月份的3天），则间隔仍然表示为<code class="language-plaintext highlighter-rouge">P1M3D</code>，即1个月3天的间隔。</p><p>因此，如果只给出一个P1M3D，<strong>你无法确定间隔是几天</strong>。</p><p><code class="language-plaintext highlighter-rouge">Period</code>类中的月份和天数是分开计算的，所以如果只给出<code class="language-plaintext highlighter-rouge">P1M3D</code>，无法确定具体的天数间隔。这种情况下，需要结合<strong>具体</strong>的<strong>日期</strong>来确定间隔的准确天数。年间隔同理。</p><p>如果你需要计算两个日期之间的天数间隔，可以使用<code class="language-plaintext highlighter-rouge">ChronoUnit</code>类的<code class="language-plaintext highlighter-rouge">between</code>方法。这个方法返回两个日期之间的指定时间单位的数量。例如，计算<code class="language-plaintext highlighter-rouge">2022-03-22</code>和<code class="language-plaintext highlighter-rouge">2022-04-25</code>之间的天数间隔：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">LocalDate</span> <span class="n">date1</span> <span class="o">=</span> <span class="nc">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2022</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">22</span><span class="o">);</span>
<span class="nc">LocalDate</span> <span class="n">date2</span> <span class="o">=</span> <span class="nc">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2022</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">25</span><span class="o">);</span>
<span class="kt">long</span> <span class="n">daysBetween</span> <span class="o">=</span> <span class="nc">ChronoUnit</span><span class="o">.</span><span class="na">DAYS</span><span class="o">.</span><span class="na">between</span><span class="o">(</span><span class="n">date1</span><span class="o">,</span> <span class="n">date2</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">daysBetween</span><span class="o">);</span> <span class="c1">// 输出：34</span>
</code></pre></div></div><p>这里的<code class="language-plaintext highlighter-rouge">ChronoUnit.DAYS</code>表示计算天数间隔，<code class="language-plaintext highlighter-rouge">between</code>方法返回的是<code class="language-plaintext highlighter-rouge">long</code>类型的间隔天数。</p><h3 id="zoneddatetime">ZonedDateTime</h3><p><code class="language-plaintext highlighter-rouge">LocalDateTime</code><strong>总是表示本地日期和时间</strong>，要表示一个<strong>带时区</strong>的日期和时间，就需要<code class="language-plaintext highlighter-rouge">ZonedDateTime</code>。</p><p>可以简单地把<code class="language-plaintext highlighter-rouge">ZonedDateTime</code>理解成<code class="language-plaintext highlighter-rouge">LocalDateTime</code>加<code class="language-plaintext highlighter-rouge">ZoneId</code>。<code class="language-plaintext highlighter-rouge">ZoneId</code>是<code class="language-plaintext highlighter-rouge">java.time</code>引入的新的时区类，注意和旧的<code class="language-plaintext highlighter-rouge">java.util.TimeZone</code>区别。</p><p>要创建一个<code class="language-plaintext highlighter-rouge">ZonedDateTime</code>对象，有以下几种方法，一种是通过<code class="language-plaintext highlighter-rouge">now()</code>方法返回当前时间：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.time.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">ZonedDateTime</span> <span class="n">zbj</span> <span class="o">=</span> <span class="nc">ZonedDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span> <span class="c1">// 默认时区</span>
        <span class="nc">ZonedDateTime</span> <span class="n">zny</span> <span class="o">=</span> <span class="nc">ZonedDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">(</span><span class="nc">ZoneId</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"America/New_York"</span><span class="o">));</span> <span class="c1">// 用指定时区获取当前时间</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">zbj</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">zny</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>观察打印的两个<code class="language-plaintext highlighter-rouge">ZonedDateTime</code>，发现它们时区不同，但表示的时间都是同一时刻（毫秒数不同是执行语句时的时间差）：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2019-09-15T20:58:18.786182+08:00[Asia/Shanghai]
2019-09-15T08:58:18.788860-04:00[America/New_York]
</code></pre></div></div><p>另一种方式是通过给一个<code class="language-plaintext highlighter-rouge">LocalDateTime</code>附加一个<code class="language-plaintext highlighter-rouge">ZoneId</code>，就可以变成<code class="language-plaintext highlighter-rouge">ZonedDateTime</code>：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.time.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">LocalDateTime</span> <span class="n">ldt</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2019</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">16</span><span class="o">,</span> <span class="mi">17</span><span class="o">);</span>
        <span class="nc">ZonedDateTime</span> <span class="n">zbj</span> <span class="o">=</span> <span class="n">ldt</span><span class="o">.</span><span class="na">atZone</span><span class="o">(</span><span class="nc">ZoneId</span><span class="o">.</span><span class="na">systemDefault</span><span class="o">());</span>
        <span class="nc">ZonedDateTime</span> <span class="n">zny</span> <span class="o">=</span> <span class="n">ldt</span><span class="o">.</span><span class="na">atZone</span><span class="o">(</span><span class="nc">ZoneId</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"America/New_York"</span><span class="o">));</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">zbj</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">zny</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>以这种方式创建的<code class="language-plaintext highlighter-rouge">ZonedDateTime</code>，它的<strong>日期和时间</strong>与<code class="language-plaintext highlighter-rouge">LocalDateTime</code>相同，但附加的<strong>时区不同</strong>，因此<strong>是两个不同的时刻</strong>：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2019-09-15T15:16:17+08:00[Asia/Shanghai]
2019-09-15T15:16:17-04:00[America/New_York]
</code></pre></div></div><h3 id="时区转换-1">时区转换</h3><p>要转换时区，首先我们需要有一个<code class="language-plaintext highlighter-rouge">ZonedDateTime</code>对象，然后，通过<code class="language-plaintext highlighter-rouge">withZoneSameInstant()</code>将关联时区转换到另一个时区，转换后日期和时间都会相应调整。</p><p>下面的代码演示了如何将北京时间转换为纽约时间：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.time.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 以中国时区获取当前时间:</span>
        <span class="nc">ZonedDateTime</span> <span class="n">zbj</span> <span class="o">=</span> <span class="nc">ZonedDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">(</span><span class="nc">ZoneId</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"Asia/Shanghai"</span><span class="o">));</span>
        <span class="c1">// 转换为纽约时间:</span>
        <span class="nc">ZonedDateTime</span> <span class="n">zny</span> <span class="o">=</span> <span class="n">zbj</span><span class="o">.</span><span class="na">withZoneSameInstant</span><span class="o">(</span><span class="nc">ZoneId</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"America/New_York"</span><span class="o">));</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">zbj</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">zny</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>要特别注意，时区转换的时候，由于<strong>夏令时</strong>的存在，不同的日期转换的结果很可能是不同的。这是北京时间9月15日的转换结果：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2019-09-15T21:05:50.187697+08:00[Asia/Shanghai]
2019-09-15T09:05:50.187697-04:00[America/New_York]
</code></pre></div></div><p>这是北京时间11月15日的转换结果：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2019-11-15T21:05:50.187697+08:00[Asia/Shanghai]
2019-11-15T08:05:50.187697-05:00[America/New_York]
</code></pre></div></div><p>两次转换后的纽约时间有1小时的夏令时时差。</p><p><strong>涉及到时区时，千万不要自己计算时差，否则难以正确处理夏令时。</strong></p><p>有了<code class="language-plaintext highlighter-rouge">ZonedDateTime</code>，将其转换为本地时间就非常简单：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">ZonedDateTime</span> <span class="n">zdt</span> <span class="o">=</span> <span class="o">...</span>
<span class="nc">LocalDateTime</span> <span class="n">ldt</span> <span class="o">=</span> <span class="n">zdt</span><span class="o">.</span><span class="na">toLocalDateTime</span><span class="o">();</span>
</code></pre></div></div><p>转换为<code class="language-plaintext highlighter-rouge">LocalDateTime</code>时，<strong>直接丢弃了时区信息</strong>。</p><h3 id="datetimeformatter">DateTimeFormatter</h3><p>使用旧的<code class="language-plaintext highlighter-rouge">Date</code>对象时，我们用<code class="language-plaintext highlighter-rouge">SimpleDateFormat</code>进行格式化显示。使用新的<code class="language-plaintext highlighter-rouge">LocalDateTime</code>或<code class="language-plaintext highlighter-rouge">ZonedDateTime</code>时，我们要进行格式化显示，就要使用<code class="language-plaintext highlighter-rouge">DateTimeFormatter</code>。</p><p>和<code class="language-plaintext highlighter-rouge">SimpleDateFormat</code>不同的是，<code class="language-plaintext highlighter-rouge">DateTimeFormatter</code>不但是不变对象，它还是<strong>线程安全</strong>的。因为<code class="language-plaintext highlighter-rouge">SimpleDateFormat</code><strong>不是线程安全</strong>的，使用的时候，只能在方法内部创建新的局部变量。而<code class="language-plaintext highlighter-rouge">DateTimeFormatter</code>可以只创建一个实例，到处引用。</p><p>如果要自定义输出的格式，或者要把一个非ISO 8601格式的字符串解析成<code class="language-plaintext highlighter-rouge">LocalDateTime</code>，可以使用新的<code class="language-plaintext highlighter-rouge">DateTimeFormatter</code>：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.time.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.time.format.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 自定义格式化:</span>
        <span class="nc">DateTimeFormatter</span> <span class="n">dtf</span> <span class="o">=</span> <span class="nc">DateTimeFormatter</span><span class="o">.</span><span class="na">ofPattern</span><span class="o">(</span><span class="s">"yyyy/MM/dd HH:mm:ss"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">dtf</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">()));</span>
        <span class="c1">// 用自定义格式解析:</span>
        <span class="nc">LocalDateTime</span> <span class="n">dt2</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"2019/11/30 15:16:17"</span><span class="o">,</span> <span class="n">dtf</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">dt2</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>创建<code class="language-plaintext highlighter-rouge">DateTimeFormatter</code>时，我们仍然通过传入格式化字符串实现：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">DateTimeFormatter</span> <span class="n">formatter</span> <span class="o">=</span> <span class="nc">DateTimeFormatter</span><span class="o">.</span><span class="na">ofPattern</span><span class="o">(</span><span class="s">"yyyy-MM-dd HH:mm"</span><span class="o">);</span>
</code></pre></div></div><p>格式化字符串的使用方式与<code class="language-plaintext highlighter-rouge">SimpleDateFormat</code>完全一致。</p><p>另一种创建<code class="language-plaintext highlighter-rouge">DateTimeFormatter</code>的方法是，传入格式化字符串时，同时指定<code class="language-plaintext highlighter-rouge">Locale</code>：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">DateTimeFormatter</span> <span class="n">formatter</span> <span class="o">=</span> <span class="nc">DateTimeFormatter</span><span class="o">.</span><span class="na">ofPattern</span><span class="o">(</span><span class="s">"E, yyyy-MMMM-dd HH:mm"</span><span class="o">,</span> <span class="nc">Locale</span><span class="o">.</span><span class="na">US</span><span class="o">);</span>
</code></pre></div></div><p>这种方式可以按照<code class="language-plaintext highlighter-rouge">Locale</code>默认习惯格式化。我们来看实际效果：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">ZonedDateTime</span> <span class="n">zdt</span> <span class="o">=</span> <span class="nc">ZonedDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
<span class="nc">DateTimeFormatter</span> <span class="n">formatter</span> <span class="o">=</span> <span class="nc">DateTimeFormatter</span><span class="o">.</span><span class="na">ofPattern</span><span class="o">(</span><span class="s">"yyyy-MM-dd'T'HH:mm ZZZZ"</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">formatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">zdt</span><span class="o">));</span>
<span class="nc">DateTimeFormatter</span> <span class="n">zhFormatter</span> <span class="o">=</span> <span class="nc">DateTimeFormatter</span><span class="o">.</span><span class="na">ofPattern</span><span class="o">(</span><span class="s">"yyyy MMM dd EE HH:mm"</span><span class="o">,</span> <span class="nc">Locale</span><span class="o">.</span><span class="na">CHINA</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">zhFormatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">zdt</span><span class="o">));</span>
<span class="nc">DateTimeFormatter</span> <span class="n">usFormatter</span> <span class="o">=</span> <span class="nc">DateTimeFormatter</span><span class="o">.</span><span class="na">ofPattern</span><span class="o">(</span><span class="s">"E, MMMM/dd/yyyy HH:mm"</span><span class="o">,</span> <span class="nc">Locale</span><span class="o">.</span><span class="na">US</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">usFormatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">zdt</span><span class="o">));</span>
</code></pre></div></div><p>在格式化字符串中，如果需要输出<strong>固定字符</strong>，可以用<code class="language-plaintext highlighter-rouge">'xxx'</code>表示。</p><p>运行上述代码，分别以默认方式、中国地区和美国地区对当前时间进行显示，结果如下：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2019-09-15T23:16 GMT+08:00
2019 9月 15 周日 23:16
Sun, September/15/2019 23:16
</code></pre></div></div><p>当我们直接调用<code class="language-plaintext highlighter-rouge">System.out.println()</code>对一个<code class="language-plaintext highlighter-rouge">ZonedDateTime</code>或者<code class="language-plaintext highlighter-rouge">LocalDateTime</code>实例进行打印的时候，实际上，调用的是它们的<code class="language-plaintext highlighter-rouge">toString()</code>方法，默认的<code class="language-plaintext highlighter-rouge">toString()</code>方法显示的字符串就是按照<code class="language-plaintext highlighter-rouge">ISO 8601</code>格式显示的，可以通过<code class="language-plaintext highlighter-rouge">DateTimeFormatter</code>预定义的几个静态变量来引用：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">LocalDateTime</span> <span class="n">ldt</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">DateTimeFormatter</span><span class="o">.</span><span class="na">ISO_DATE</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">ldt</span><span class="o">));</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">DateTimeFormatter</span><span class="o">.</span><span class="na">ISO_DATE_TIME</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">ldt</span><span class="o">));</span>
</code></pre></div></div><p>得到的输出和<code class="language-plaintext highlighter-rouge">toString()</code>类似：</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2019-09-15
2019-09-15T23:16:51.56217
</code></pre></div></div><h3 id="instant">Instant</h3><p>计算机存储的当前时间，本质上只是一个不断递增的整数。Java提供的<code class="language-plaintext highlighter-rouge">System.currentTimeMillis()</code>返回的就是以毫秒表示的当前时间戳。</p><p>这个当前时间戳在<code class="language-plaintext highlighter-rouge">java.time</code>中以<code class="language-plaintext highlighter-rouge">Instant</code>类型表示，我们用<code class="language-plaintext highlighter-rouge">Instant.now()</code>获取当前时间戳，效果和<code class="language-plaintext highlighter-rouge">System.currentTimeMillis()</code>类似：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.time.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Instant</span> <span class="n">now</span> <span class="o">=</span> <span class="nc">Instant</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">now</span><span class="o">.</span><span class="na">getEpochSecond</span><span class="o">());</span> <span class="c1">// 秒</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">now</span><span class="o">.</span><span class="na">toEpochMilli</span><span class="o">());</span> <span class="c1">// 毫秒</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>打印的结果类似：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1568568760
1568568760316
</code></pre></div></div><p>实际上，<code class="language-plaintext highlighter-rouge">Instant</code>内部只有两个核心字段：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Instant</span> <span class="kd">implements</span> <span class="o">...</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">seconds</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">nanos</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div><p>一个是以秒为单位的时间戳，一个是更精确的纳秒精度。它和<code class="language-plaintext highlighter-rouge">System.currentTimeMillis()</code>返回的<code class="language-plaintext highlighter-rouge">long</code>相比，只是多了更高精度的纳秒。</p><p>既然<code class="language-plaintext highlighter-rouge">Instant</code>就是时间戳，那么，给它附加上一个时区，就可以创建出<code class="language-plaintext highlighter-rouge">ZonedDateTime</code>：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 以指定时间戳创建Instant:</span>
<span class="nc">Instant</span> <span class="n">ins</span> <span class="o">=</span> <span class="nc">Instant</span><span class="o">.</span><span class="na">ofEpochSecond</span><span class="o">(</span><span class="mi">1568568760</span><span class="o">);</span>
<span class="nc">ZonedDateTime</span> <span class="n">zdt</span> <span class="o">=</span> <span class="n">ins</span><span class="o">.</span><span class="na">atZone</span><span class="o">(</span><span class="nc">ZoneId</span><span class="o">.</span><span class="na">systemDefault</span><span class="o">());</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">zdt</span><span class="o">);</span> <span class="c1">// 2019-09-16T01:32:40+08:00[Asia/Shanghai]</span>
</code></pre></div></div><p>也可以这样写：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Instant</span> <span class="n">ins</span> <span class="o">=</span> <span class="nc">Instant</span><span class="o">.</span><span class="na">ofEpochSecond</span><span class="o">(</span><span class="mi">1568568760</span><span class="o">);</span>
<span class="nc">ZonedDateTime</span> <span class="n">zdt</span> <span class="o">=</span> <span class="nc">ZonedDateTime</span><span class="o">.</span><span class="na">ofInstant</span><span class="o">(</span><span class="n">ins</span><span class="o">,</span> <span class="nc">ZoneId</span><span class="o">.</span><span class="na">systemDefault</span><span class="o">());</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">zdt</span><span class="o">);</span>
</code></pre></div></div><p>可见，对于某一个时间戳，给它关联上指定的<code class="language-plaintext highlighter-rouge">ZoneId</code>，就得到了<code class="language-plaintext highlighter-rouge">ZonedDateTime</code>，继而可以获得了对应时区的<code class="language-plaintext highlighter-rouge">LocalDateTime</code>。</p><p>所以，<code class="language-plaintext highlighter-rouge">LocalDateTime</code>，<code class="language-plaintext highlighter-rouge">ZoneId</code>，<code class="language-plaintext highlighter-rouge">Instant</code>，<code class="language-plaintext highlighter-rouge">ZonedDateTime</code>和<code class="language-plaintext highlighter-rouge">long</code>都可以互相转换：</p><pre><code class="language-ascii">┌─────────────┐
│LocalDateTime│────┐
└─────────────┘    │    ┌─────────────┐
                   ├───&gt;│ZonedDateTime│
┌─────────────┐    │    └─────────────┘
│   ZoneId    │────┘           ▲
└─────────────┘      ┌─────────┴─────────┐
                     │                   │
                     ▼                   ▼
              ┌─────────────┐     ┌─────────────┐
              │   Instant   │&lt;───&gt;│    long     │
              └─────────────┘     └─────────────┘
</code></pre><p>转换的时候，只需要留意<code class="language-plaintext highlighter-rouge">long</code>类型以毫秒还是秒为单位即可。</p><h2 id="旧api转新api">旧API转新API</h2><p>如果要把旧式的<code class="language-plaintext highlighter-rouge">Date</code>或<code class="language-plaintext highlighter-rouge">Calendar</code>转换为新API对象，可以通过<code class="language-plaintext highlighter-rouge">toInstant()</code>方法转换为<code class="language-plaintext highlighter-rouge">Instant</code>对象，再继续转换为<code class="language-plaintext highlighter-rouge">ZonedDateTime</code>：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Date -&gt; Instant:</span>
<span class="nc">Instant</span> <span class="n">ins1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">().</span><span class="na">toInstant</span><span class="o">();</span>
<span class="c1">// Calendar -&gt; Instant -&gt; ZonedDateTime:</span>
<span class="nc">Calendar</span> <span class="n">calendar</span> <span class="o">=</span> <span class="nc">Calendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
<span class="nc">Instant</span> <span class="n">ins2</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="na">toInstant</span><span class="o">();</span>
<span class="nc">ZonedDateTime</span> <span class="n">zdt</span> <span class="o">=</span> <span class="n">ins2</span><span class="o">.</span><span class="na">atZone</span><span class="o">(</span><span class="n">calendar</span><span class="o">.</span><span class="na">getTimeZone</span><span class="o">().</span><span class="na">toZoneId</span><span class="o">());</span>
</code></pre></div></div><p>从上面的代码还可以看到，旧的<code class="language-plaintext highlighter-rouge">TimeZone</code>提供了一个<code class="language-plaintext highlighter-rouge">toZoneId()</code>，可以把自己变成新的<code class="language-plaintext highlighter-rouge">ZoneId</code>。</p><h2 id="新api转旧api">新API转旧API</h2><p>如果要把新的<code class="language-plaintext highlighter-rouge">ZonedDateTime</code>转换为旧的API对象，只能借助<code class="language-plaintext highlighter-rouge">long</code>型时间戳做一个“中转”：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ZonedDateTime -&gt; long:</span>
<span class="nc">ZonedDateTime</span> <span class="n">zdt</span> <span class="o">=</span> <span class="nc">ZonedDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
<span class="kt">long</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">zdt</span><span class="o">.</span><span class="na">toEpochSecond</span><span class="o">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="o">;</span>
<span class="c1">// long -&gt; Date:</span>
<span class="nc">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">(</span><span class="n">ts</span><span class="o">);</span>
<span class="c1">// long -&gt; Calendar:</span>
<span class="nc">Calendar</span> <span class="n">calendar</span> <span class="o">=</span> <span class="nc">Calendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
<span class="n">calendar</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
<span class="n">calendar</span><span class="o">.</span><span class="na">setTimeZone</span><span class="o">(</span><span class="nc">TimeZone</span><span class="o">.</span><span class="na">getTimeZone</span><span class="o">(</span><span class="n">zdt</span><span class="o">.</span><span class="na">getZone</span><span class="o">().</span><span class="na">getId</span><span class="o">()));</span>
<span class="n">calendar</span><span class="o">.</span><span class="na">setTimeInMillis</span><span class="o">(</span><span class="n">zdt</span><span class="o">.</span><span class="na">toEpochSecond</span><span class="o">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="o">);</span>
</code></pre></div></div><p>从上面的代码还可以看到，新的<code class="language-plaintext highlighter-rouge">ZoneId</code>转换为旧的<code class="language-plaintext highlighter-rouge">TimeZone</code>，需要借助<code class="language-plaintext highlighter-rouge">ZoneId.getId()</code>返回的<code class="language-plaintext highlighter-rouge">String</code>完成。</p><h2 id="在数据库中存储日期和时间">在数据库中存储日期和时间</h2><p>除了旧式的<code class="language-plaintext highlighter-rouge">java.util.Date</code>，我们还可以找到另一个<code class="language-plaintext highlighter-rouge">java.sql.Date</code>，它继承自<code class="language-plaintext highlighter-rouge">java.util.Date</code>，但会<strong>自动忽略</strong>所有时间相关信息。这个奇葩的设计原因要追溯到数据库的日期与时间类型。</p><p>在数据库中，也存在几种日期和时间类型：</p><ul><li><code class="language-plaintext highlighter-rouge">DATETIME</code>：表示日期和时间；</li><li><code class="language-plaintext highlighter-rouge">DATE</code>：仅表示日期；</li><li><code class="language-plaintext highlighter-rouge">TIME</code>：仅表示时间；</li><li><code class="language-plaintext highlighter-rouge">TIMESTAMP</code>：和<code class="language-plaintext highlighter-rouge">DATETIME</code>类似，但是数据库会在创建或者更新记录的时候同时修改<code class="language-plaintext highlighter-rouge">TIMESTAMP</code>。</li></ul><p>在使用Java程序操作数据库时，我们需要把数据库类型与Java类型<strong>映射</strong>起来。下表是数据库类型与Java新旧API的映射关系：</p><table><thead><tr><th style="text-align: left">数据库</th><th style="text-align: left">对应Java类（旧）</th><th style="text-align: left">对应Java类（新）</th></tr></thead><tbody><tr><td style="text-align: left">DATETIME</td><td style="text-align: left">java.util.Date</td><td style="text-align: left">LocalDateTime</td></tr><tr><td style="text-align: left">DATE</td><td style="text-align: left">java.sql.Date</td><td style="text-align: left">LocalDate</td></tr><tr><td style="text-align: left">TIME</td><td style="text-align: left">java.sql.Time</td><td style="text-align: left">LocalTime</td></tr><tr><td style="text-align: left">TIMESTAMP</td><td style="text-align: left">java.sql.Timestamp</td><td style="text-align: left">LocalDateTime</td></tr></tbody></table><p>实际上，在数据库中，我们需要存储的最常用的是时刻（<code class="language-plaintext highlighter-rouge">Instant</code>），因为有了时刻信息，就可以根据用户自己选择的时区，显示出正确的本地时间。所以，最好的方法是直接用长整数<code class="language-plaintext highlighter-rouge">long</code>表示，在数据库中存储为<code class="language-plaintext highlighter-rouge">BIGINT</code>类型。</p><p>通过存储一个<code class="language-plaintext highlighter-rouge">long</code>型时间戳，我们可以编写一个<code class="language-plaintext highlighter-rouge">timestampToString()</code>的方法，非常简单地为不同用户以不同的偏好来显示不同的本地时间：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.time.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.time.format.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">long</span> <span class="n">ts</span> <span class="o">=</span> <span class="mi">1574208900000L</span><span class="o">;</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">timestampToString</span><span class="o">(</span><span class="n">ts</span><span class="o">,</span> <span class="nc">Locale</span><span class="o">.</span><span class="na">CHINA</span><span class="o">,</span> <span class="s">"Asia/Shanghai"</span><span class="o">));</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">timestampToString</span><span class="o">(</span><span class="n">ts</span><span class="o">,</span> <span class="nc">Locale</span><span class="o">.</span><span class="na">US</span><span class="o">,</span> <span class="s">"America/New_York"</span><span class="o">));</span>
    <span class="o">}</span>
    <span class="kd">static</span> <span class="nc">String</span> <span class="nf">timestampToString</span><span class="o">(</span><span class="kt">long</span> <span class="n">epochMilli</span><span class="o">,</span> <span class="nc">Locale</span> <span class="n">lo</span><span class="o">,</span> <span class="nc">String</span> <span class="n">zoneId</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Instant</span> <span class="n">ins</span> <span class="o">=</span> <span class="nc">Instant</span><span class="o">.</span><span class="na">ofEpochMilli</span><span class="o">(</span><span class="n">epochMilli</span><span class="o">);</span>
        <span class="nc">DateTimeFormatter</span> <span class="n">f</span> <span class="o">=</span> <span class="nc">DateTimeFormatter</span><span class="o">.</span><span class="na">ofLocalizedDateTime</span><span class="o">(</span><span class="nc">FormatStyle</span><span class="o">.</span><span class="na">MEDIUM</span><span class="o">,</span> <span class="nc">FormatStyle</span><span class="o">.</span><span class="na">SHORT</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="na">withLocale</span><span class="o">(</span><span class="n">lo</span><span class="o">).</span><span class="na">format</span><span class="o">(</span><span class="nc">ZonedDateTime</span><span class="o">.</span><span class="na">ofInstant</span><span class="o">(</span><span class="n">ins</span><span class="o">,</span> <span class="nc">ZoneId</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">zoneId</span><span class="o">)));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>对上述方法进行调用，结果如下：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2019年11月20日 上午8:15
Nov 19, 2019, 7:15 PM
</code></pre></div></div><p>数据库使用<strong>TIMESTAMP</strong>有什么弊端？</p><p>不易看出具体的日期时间。当 timestamp 存储的时间大于 ‘2038-01-19 03:14:07’ UTC，mysql就会报错</p><div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"><h3>文档信息</h3><ul><li>本文作者：<a href="" target="_blank">acteds</a></li><li>本文链接：<a href="/2021/04/12/%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4/" target="_blank">https://acteds.github.io/2021/04/12/%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4/</a></li><li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li></ul></div></article><div class="share"></div><div class="comment"> <script src="https://beaudar.lipk.org/client.js" repo="mzlogin/blog-comments" issue-term="title" label="gitment" theme="github-light" comment-order="desc" input-position="top" crossorigin="anonymous" async> </script></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"></div><ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul><script src="/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: '/assets/search_data.json?v=1731077976', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 10, fuzzy: false, exclude: ['Welcome'] }) </script><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="/assets/js/jquery.toc.js"></script></div></div></section><footer class="container"><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2024 <span title="acteds">acteds</span> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo(0,0)" >TOP</a></li></ul><a href="https://github.com/acteds/acteds.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="/" title="首页" target="">首页</a></li><li> <a href="/categories/" title="分类" target="">分类</a></li><li> <a href="/wiki/" title="维基" target="">维基</a></li><li> <a href="/about/" title="关于" target="">关于</a></li><li><a href="/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a></div><script src="/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script></body></html>
