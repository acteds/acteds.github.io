<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>批处理batch重点知识1.基础 &mdash; 个人博客</title><link rel="stylesheet" href="/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="/assets/css/components/collection.css"><link rel="stylesheet" href="/assets/css/components/repo-card.css"><link rel="stylesheet" href="/assets/css/sections/repo-list.css"><link rel="stylesheet" href="/assets/css/components/boxed-group.css"><link rel="stylesheet" href="/assets/css/globals/common.css"><link rel="stylesheet" href="/assets/css/globals/responsive.css"><link rel="stylesheet" href="/assets/css/posts/index.css"><link rel="stylesheet" href="/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="/assets/css/highlight/monokai.sublime.css"><link rel="canonical" href="/2019/04/13/%E6%89%B9%E5%A4%84%E7%90%86batch%E9%87%8D%E7%82%B9%E7%9F%A5%E8%AF%861.%E5%9F%BA%E7%A1%80/"><link rel="alternate" type="application/atom+xml" title="个人博客" href="/feed.xml"><link rel="shortcut icon" href="/favicon.ico"><meta property="og:title" content="批处理batch重点知识1.基础"><meta name="keywords" content="windows, batch"><meta name="og:keywords" content="windows, batch"><meta name="description" content="引言本篇文章介绍批处理的基础"><meta name="og:description" content="引言本篇文章介绍批处理的基础"><meta property="og:url" content="/2019/04/13/%E6%89%B9%E5%A4%84%E7%90%86batch%E9%87%8D%E7%82%B9%E7%9F%A5%E8%AF%861.%E5%9F%BA%E7%A1%80/"><meta property="og:site_name" content="个人博客"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2019-04-13"> <script src="/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="/assets/js/jquery-ui.js"></script> <script src="/assets/js/main.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-80669434-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-80669434-1'); </script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1><a href="/" title="个人博客"><span class="octicon octicon-mark-github"></span> 个人博客</a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="/" class=" site-header-nav-item" target="" title="首页">首页</a> <a href="/categories/" class=" site-header-nav-item" target="" title="分类">分类</a> <a href="/wiki/" class=" site-header-nav-item" target="" title="维基">维基</a> <a href="/about/" class=" site-header-nav-item" target="" title="关于">关于</a></nav></div></header><section class="collection-head small geopattern" data-pattern-id="批处理batch重点知识1.基"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">批处理batch重点知识1.基础</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2019/04/13 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="/categories/#windows" title="windows">windows</a> </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="/categories/#batch" title="batch">batch</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 7198 字，约 21 分钟 </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths" ><article class="article-content markdown-body"><h1 id="引言">引言</h1><p>本篇文章介绍批处理的基础</p><h1 id="特性">特性</h1><ul><li><strong><font color="red">对于文件路径引用请加""不然有空格会出错，文件或文件夹请勿用特殊符号()空格等</font></strong></li><li>批处理命令的关键字不区分大小写</li><li>在<code class="language-plaintext highlighter-rouge">.bat</code>或<code class="language-plaintext highlighter-rouge">.cmd</code>文件里写批处理命令,并双击执行,若出错或没有在末尾写<strong>pause</strong>命令,则在执行完成后会自动关闭控制台窗口.</li><li><strong><font color="red">在命令行窗口和批处理文件中`%`的写法略有差异：</font></strong><ul><li>在命令行窗口中，只需要一个百分号:%.</li><li>在批处理文件中，需要连续两个百分号:%%。</li></ul></li><li>注意在批处理文件保存时使用GBK编码,否则会导致中文乱码.</li></ul><h1 id="控制台">控制台</h1><ul><li><strong>窗口半透明</strong>: 在Win10中，CMD窗口支持半透明设计，可以通过手工设置或按下<code class="language-plaintext highlighter-rouge">Ctrl</code>+<code class="language-plaintext highlighter-rouge">Shift</code>+<code class="language-plaintext highlighter-rouge">加号/减号</code>实时调整透明度，方便编写代码查看底下效果。</li><li><strong>切换全屏</strong>: Win10中的CMD可以点击右上角按钮或按下<code class="language-plaintext highlighter-rouge">Alt</code>+<code class="language-plaintext highlighter-rouge">回车</code>全屏，解决了以前只能半屏显示的问题。</li><li><strong>查阅命令历史</strong>: 在CMD中按上、下箭头键调用之前执行过的命令，也可以按下<code class="language-plaintext highlighter-rouge">F7</code>查看并执行历史命令。</li><li><strong>拖拽文件夹快速输入路径</strong>: 将文件夹拖入CMD窗口中，目标路径会自动出现在当前光标后，简化了输入长路径的步骤。</li><li><strong>预测补全</strong>: 在CMD中按<code class="language-plaintext highlighter-rouge">Tab</code>键可以自动补全命令符后面的内容，多按几下<code class="language-plaintext highlighter-rouge">Tab</code>键CMD会提取当前路径下的文件或文件夹名称补入光标位置。</li><li><strong>Ctrl+C/V</strong>: Win10的CMD支持<code class="language-plaintext highlighter-rouge">Ctrl</code>+<code class="language-plaintext highlighter-rouge">C</code>和<code class="language-plaintext highlighter-rouge">Ctrl</code>+<code class="language-plaintext highlighter-rouge">V</code>复制粘贴，也可以用鼠标右键快速粘贴剪贴板内容。</li><li><strong>搜索文本</strong>: Win10的CMD新增了文本搜索功能，可以在输入过程中或输出完后任意搜索想要的内容，通过右击点搜索或按Ctrl+F实现，非常方便。</li></ul><h1 id="显示内容-echo">显示内容 echo</h1><p>显示内容到控制台:</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> 文字或者变量
</code></pre></div></div><p>在当前脚本不显示执行语句:</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="na">off</span>
</code></pre></div></div><p>在当前脚本显示执行语句:</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="na">on</span>
</code></pre></div></div><p>在当前脚本不显示执行语句,同时使用<code class="language-plaintext highlighter-rouge">@</code>不显示本条执行语句:</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@echo <span class="na">off</span>
</code></pre></div></div><p>空行输出:</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@echo <span class="na">off</span> 

<span class="nb">echo</span><span class="o">=</span> 
<span class="nb">echo</span><span class="o">,</span> 
<span class="nb">echo</span><span class="o">;</span> 

<span class="nb">echo</span><span class="o">+</span> 
<span class="nb">echo</span>/ 
<span class="nb">echo</span><span class="o">[</span> 
<span class="nb">echo</span><span class="o">]</span> 

<span class="nb">echo</span>: 
<span class="nb">echo</span>. 
<span class="nb">echo</span>\
<span class="nb">pause</span>
</code></pre></div></div><p>这十种方法可以分为三组，每组的效率依次递减。<a href="http://demon.tw/reverse/cmd-internal-echo.html">一般情况下使用第一组,它们的效率最高</a>.</p><h1 id="注释">注释</h1><p>在批处理中常见的注释形式：</p><ul><li><strong>行注释</strong>：使用 <code class="language-plaintext highlighter-rouge">rem</code> 关键字可以添加行注释，<code class="language-plaintext highlighter-rouge">rem</code> 后面的内容将被解释器忽略。<div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">rem 注释内容</span>
</code></pre></div></div></li><li><strong>段注释</strong>：通过在标签之前添加冒号 <code class="language-plaintext highlighter-rouge">:</code> 可以实现段注释，段注释可以跨越多行，并且可以包含命令和特殊字符，只要不包含与标签重名的标签行即可。<div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">goto</span> <span class="nb">start</span>
<span class="o">=</span> 可以是多行文本，可以是命令
<span class="o">=</span> 可以包含重定向符号和其他特殊字符
<span class="o">=</span> 只要不包含:start这一行，就都是注释
 <span class="nl">:start</span>
</code></pre></div></div></li><li><strong>其他注释形式</strong>：<ul><li><code class="language-plaintext highlighter-rouge">::</code> 注释内容（第一个冒号后也可以跟任何一个非字母数字的字符）。</li><li><code class="language-plaintext highlighter-rouge">echo</code> 注释内容（不能出现重定向符号和管道符号）<code class="language-plaintext highlighter-rouge">&gt;nul</code>。</li><li><code class="language-plaintext highlighter-rouge">if not exist nul</code> 注释内容（不能出现重定向符号和管道符号）。</li><li><code class="language-plaintext highlighter-rouge">:注释内容</code>（注释文本不能与已有标签重名）。</li><li><code class="language-plaintext highlighter-rouge">%注释内容%</code>（可以用作行间注释，不能出现重定向符号和管道符号）。</li><li><code class="language-plaintext highlighter-rouge">goto 标签</code> 注释内容（可以用作说明 <code class="language-plaintext highlighter-rouge">goto</code> 的条件和执行内容）。</li><li><code class="language-plaintext highlighter-rouge">:标签</code> 注释内容（可以用作标签下方段的执行内容）。</li></ul></li></ul><h1 id="变量扩展">变量扩展</h1><p>在批处理脚本中，<code class="language-plaintext highlighter-rouge">%1</code> 和 <code class="language-plaintext highlighter-rouge">%2</code> 是用来表示传递给脚本的参数的变量。<code class="language-plaintext highlighter-rouge">%1</code> 表示第一个参数,<code class="language-plaintext highlighter-rouge">%2</code> 表示第二个参数。<code class="language-plaintext highlighter-rouge">%0</code>表示批处理脚本自己的变量。如果有更多传入参数,则以此类推。这些参数可以在执行脚本时通过命令行或拖动执行,传递给脚本，例如：</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">myscript</span>.bat <span class="kd">arg1</span> <span class="kd">arg2</span>
</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">arg1</code> 将会被存储在 <code class="language-plaintext highlighter-rouge">%1</code> 中，<code class="language-plaintext highlighter-rouge">arg2</code> 将会被存储在 <code class="language-plaintext highlighter-rouge">%2</code> 中。</p><h2 id="与1相关的变量扩展--">与%1相关的变量扩展 :</h2><table><thead><tr><th>变量扩展</th><th>说明</th></tr></thead><tbody><tr><td>%~1</td><td>删除引号 <code class="language-plaintext highlighter-rouge">"</code>，扩展 <strong>%1</strong><br />1. 若字符串首尾同时存在引号，则删除首尾的引号；<br />2. 若字符串尾不存在引号，则删除字符串首的引号；<br />3. 如果字符串中间存在引号，或者只在尾部存在引号，则不删除。</td></tr><tr><td>%~f1</td><td>将 <strong>%1</strong>扩展到一个完全合格的路径名</td></tr><tr><td>%~d1</td><td>将 <strong>%1</strong>扩展到一个驱动器号</td></tr><tr><td>%~p1</td><td>将 <strong>%1</strong>扩展到一个路径</td></tr><tr><td>%~n1</td><td>将 <strong>%1</strong>扩展到一个文件名</td></tr><tr><td>%~x1</td><td>将 <strong>%1</strong>扩展到一个文件扩展名</td></tr><tr><td>%~s1</td><td>将 <strong>%1</strong>扩展到一个含有短名的路径</td></tr><tr><td>%~a1</td><td>将 <strong>%1</strong>扩展到文件属性</td></tr><tr><td>%~t1</td><td>将 <strong>%1</strong>扩展到文件的日期/时间</td></tr><tr><td>%~z1</td><td>将 <strong>%1</strong>扩展到文件的大小</td></tr><tr><td>%~$PATH:1</td><td>在 <strong>PATH</strong> 环境变量目录里查找指定文件 <strong>%1</strong>,并将 <strong>%1</strong>扩展到找到的第一个完全合格的名称。如果环境变量名未被定义，或者没有找到文件，那么会扩展为空字符串。</td></tr><tr><td>%~dp1</td><td>将 <strong>%1</strong> 扩展到驱动器号和路径</td></tr><tr><td>%~nx1</td><td>将 <strong>%1</strong> 扩展到文件名和扩展名</td></tr><tr><td>%~dp$PATH:1</td><td>在 <strong>PATH</strong> 环境变量目录里查找指定文件 <strong>%1</strong>，并扩展到找到的第一个文件的驱动器号和路径。</td></tr><tr><td>%~ftza1</td><td>将 <strong>%1</strong> 扩展到类似 DIR 的输出行。</td></tr></tbody></table><h2 id="与var相关的变量扩展--">与%VAR%相关的变量扩展 :</h2><table><thead><tr><th>变量扩展</th><th>说明</th></tr></thead><tbody><tr><td>%VAR:str1=str2%</td><td>将<strong>VAR</strong>中的<strong>str1</strong>替换为<strong>str2</strong><br /><strong>str2</strong>如果为空则可以达到删除的效果,<strong>str1</strong>前可以加’*‘号匹配任意字符,例子:<code class="language-plaintext highlighter-rouge">%ABC:*B=%</code>的执行结果是<code class="language-plaintext highlighter-rouge">C</code></td></tr><tr><td>%VAR:~0,-2%</td><td>提取<strong>VAR</strong> 变量除了最后两个字符的所有字符</td></tr><tr><td>%VAR:~2%</td><td>提取<strong>VAR</strong> 变量的除前两个的所有字符</td></tr><tr><td>%VAR:~-2%</td><td>提取<strong>VAR</strong> 变量的最后两个</td></tr><tr><td>%VAR:~2,5%</td><td>提取从第2个字符开始的5个字符</td></tr></tbody></table><h2 id="动态变量--">动态变量 :</h2><p>还有几个动态变量，运行 <code class="language-plaintext highlighter-rouge">set</code>命令是看不到的:</p><table><thead><tr><th>变量扩展</th><th>说明</th></tr></thead><tbody><tr><td>%CD%</td><td>代表当前目录的字符串</td></tr><tr><td>%DATE%</td><td>当前日期</td></tr><tr><td>%TIME%</td><td>当前时间</td></tr><tr><td>%RANDOM%</td><td>随机整数，介于0~32767</td></tr><tr><td>%ERRORLEVEL%</td><td>当前 ERRORLEVEL 值</td></tr><tr><td>%CMDEXTVERSION%</td><td>当前命令处理器扩展名版本号</td></tr><tr><td>%CMDCMDLINE%</td><td>调用命令处理器的原始命令行</td></tr></tbody></table><p>用<code class="language-plaintext highlighter-rouge">echo</code>命令可以查看每个变量值，如<code class="language-plaintext highlighter-rouge">echo %time%</code>,<code class="language-plaintext highlighter-rouge">%time%</code>精确到毫秒，在批处理需要延时处理时可以用到.</p><h1 id="----">@ % %% : ::~()</h1><h2 id="--">@ :</h2><p><code class="language-plaintext highlighter-rouge">@</code> 是 Windows 命令行中的一个前缀，用于指示命令或语句在执行时不要显示在屏幕上。它通常用于隐藏命令的执行过程，使输出更清晰。例如：</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@echo <span class="na">off</span>
@echo <span class="kd">Hello</span><span class="o">,</span> <span class="kd">World</span><span class="err">!</span>
</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">@echo off</code> 会关闭命令的回显，而 <code class="language-plaintext highlighter-rouge">@echo Hello, World!</code> 则会输出 “Hello, World!”，但不会显示 <code class="language-plaintext highlighter-rouge">echo</code> 命令本身。<code class="language-plaintext highlighter-rouge">@</code> 仅影响紧随其后的命令或语句，不会影响之前或之后的命令或语句。</p><h2 id="---1">%、%% :</h2><ul><li><p><strong>变量引用</strong>：在批处理中,当百分号成对出现，并且其间包含非特殊字符时，一般做变量引用处理。例如，<code class="language-plaintext highlighter-rouge">%var%</code> 表示引用名为 <code class="language-plaintext highlighter-rouge">var</code> 的变量的值。</p></li><li><p><strong>形式参数引用</strong>：<code class="language-plaintext highlighter-rouge">%</code> 也用于引用传递给批处理脚本的参数。形式参数以 <code class="language-plaintext highlighter-rouge">%0</code>、<code class="language-plaintext highlighter-rouge">%1</code>、<code class="language-plaintext highlighter-rouge">%2</code> 等形式表示，其中 <code class="language-plaintext highlighter-rouge">%0</code> 表示脚本自身的名称，<code class="language-plaintext highlighter-rouge">%1</code> 表示第一个参数，<code class="language-plaintext highlighter-rouge">%2</code> 表示第二个参数，以此类推。如果参数超过了 <code class="language-plaintext highlighter-rouge">%9</code>，则需要使用 <code class="language-plaintext highlighter-rouge">%*</code> 来表示所有参数。</p></li><li><p><strong>赋予参数</strong>：在调用批处理脚本时，参数和参数之间用逗号或空格隔开。例如，<code class="language-plaintext highlighter-rouge">myscript.bat param1 param2</code>，其中 <code class="language-plaintext highlighter-rouge">param1</code> 和 <code class="language-plaintext highlighter-rouge">param2</code> 就是传递给脚本的参数。</p></li><li><p><strong>模运算</strong>：在 <code class="language-plaintext highlighter-rouge">set /a</code> 语句中，<code class="language-plaintext highlighter-rouge">%</code> 用于表示两数相除取余数，即模运算。</p></li><li><p><strong>百分号在命令行窗口和批处理文件中的写法</strong>：在命令行窗口中，只需要一个百分号 <code class="language-plaintext highlighter-rouge">%</code>；在批处理文件中，需要连续两个百分号 <code class="language-plaintext highlighter-rouge">%%</code>。这是因为在批处理文件中，单个百分号被用作变量引用的标识符，因此需要使用两个百分号来表示一个实际的百分号字符。</p></li></ul><h2>:、::</h2><p><code class="language-plaintext highlighter-rouge">:</code> 用于定义标签，而 <code class="language-plaintext highlighter-rouge">::</code> 用于添加注释。在 <code class="language-plaintext highlighter-rouge">set</code> 语句中，<code class="language-plaintext highlighter-rouge">:</code> 还可以用于截取或替换字符串。</p><ul><li><code class="language-plaintext highlighter-rouge">:</code> 表示一个标签，用于标识批处理文件中的位置。例如，<code class="language-plaintext highlighter-rouge">:label</code> 表示一个名为 <code class="language-plaintext highlighter-rouge">label</code> 的标签，可以在脚本中使用 <code class="language-plaintext highlighter-rouge">goto label</code> 或 <code class="language-plaintext highlighter-rouge">call :label</code> 跳转到该标签处或调用该子过程。</li><li><code class="language-plaintext highlighter-rouge">::</code> 表示一个注释，用于在脚本中添加注释内容。<code class="language-plaintext highlighter-rouge">::</code> 后面的内容会被解释器忽略，不会执行。与 <code class="language-plaintext highlighter-rouge">rem</code> 命令相比，<code class="language-plaintext highlighter-rouge">::</code> 的注释更为清晰，因为它不会受到特殊字符的影响，而 <code class="language-plaintext highlighter-rouge">rem</code> 命令中的某些特殊字符可能会被解释。</li><li>在 <code class="language-plaintext highlighter-rouge">set</code> 语句中，当 <code class="language-plaintext highlighter-rouge">:</code> 和 <code class="language-plaintext highlighter-rouge">~</code> 同时使用时，<code class="language-plaintext highlighter-rouge">:</code> 表示截取字符串的功能。例如，<code class="language-plaintext highlighter-rouge">set var=%str:~0,1%</code> 表示截取变量 <code class="language-plaintext highlighter-rouge">str</code> 的第一个字符。当 <code class="language-plaintext highlighter-rouge">:</code> 和 <code class="language-plaintext highlighter-rouge">=</code> 同时使用时，<code class="language-plaintext highlighter-rouge">:</code> 起到替换字符串的功能。例如，<code class="language-plaintext highlighter-rouge">set var=%str:a=1%</code> 表示将变量 <code class="language-plaintext highlighter-rouge">str</code> 中的字符 <code class="language-plaintext highlighter-rouge">a</code> 替换为 <code class="language-plaintext highlighter-rouge">1</code>。</li></ul><h2 id="-1">~</h2><ul><li>在 <code class="language-plaintext highlighter-rouge">set</code> 语句中，和 <code class="language-plaintext highlighter-rouge">:</code> 同时使用时，用于截取字符串的功能。例如，<code class="language-plaintext highlighter-rouge">set var=%str:~0,1%</code> 表示截取变量 <code class="language-plaintext highlighter-rouge">str</code> 的第一个字符。</li><li>在 <code class="language-plaintext highlighter-rouge">set /a</code> 语句中，<code class="language-plaintext highlighter-rouge">~</code> 是一元运算符号，表示将操作数字按位取反。例如，<code class="language-plaintext highlighter-rouge">set /a num=~1</code> 的执行结果是 <code class="language-plaintext highlighter-rouge">-2</code>，<code class="language-plaintext highlighter-rouge">set /a num=~0</code> 的结果是 <code class="language-plaintext highlighter-rouge">-1</code>。</li><li>在 <code class="language-plaintext highlighter-rouge">%1</code>、<code class="language-plaintext highlighter-rouge">for</code> 循环中的变量 <code class="language-plaintext highlighter-rouge">%a</code> 等中使用时，具体效果取决于上下文，通常是用于变量扩展。例如，在 <code class="language-plaintext highlighter-rouge">for</code> 循环中，<code class="language-plaintext highlighter-rouge">%~a</code> 可以获取 <code class="language-plaintext highlighter-rouge">%a</code> 的扩展属性。</li></ul><h2 id="-2">()</h2><p>() 用作代码块的起始和结束标志，用来执行多条语句作为一个整体，一般在<code class="language-plaintext highlighter-rouge">for</code>和<code class="language-plaintext highlighter-rouge">if</code>中用的比较多.示例:</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@echo <span class="na">off</span>
<span class="kd">set</span> <span class="na">/a </span><span class="kd">a</span><span class="o">=</span><span class="m">123</span>
<span class="k">if</span> <span class="ow">not</span> <span class="nv">%a%</span> <span class="o">==</span> <span class="m">123</span> <span class="o">(</span>
	<span class="nb">echo</span> 不是123
<span class="o">)</span> <span class="k">else</span> <span class="o">(</span>
	<span class="nb">echo</span> 是123
<span class="o">)</span>
<span class="nb">pause</span>
</code></pre></div></div><h1 id="set">set</h1><p><code class="language-plaintext highlighter-rouge">set</code>用来声明变量<br /> 语法:</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">SET</span> <span class="o">[</span><span class="kd">variable</span><span class="o">=[</span><span class="kd">string</span><span class="o">]]</span>
</code></pre></div></div><p>注意:SET命令不允许变量名称含有等号.</p><h2 id="一般用法">一般用法:</h2><p><strong>设置变量</strong><br /> 格式：<code class="language-plaintext highlighter-rouge">set 变量名=变量值</code>;被设定的变量以%变量名%引用<br /> <strong>取消变量</strong><br /> 格式：<code class="language-plaintext highlighter-rouge">set 变量名=</code>;取消后的变量若被引用%变量名%将为空<br /> <strong>展示变量</strong><br /> 格式：<code class="language-plaintext highlighter-rouge">set 变量名</code>;展示以变量名开头的所有变量的值<br /> <strong>列出所有可用的变量</strong><br /> 格式：<code class="language-plaintext highlighter-rouge">set</code></p><p><strong>设定数值型变量</strong>(用 /a 参数时，在=后面的变量可以不加%直接引用)</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@echo <span class="na">off</span>
<span class="kd">set</span> <span class="na">/a </span><span class="kd">a</span><span class="o">=</span><span class="m">1</span><span class="o">+</span><span class="m">2</span><span class="o">*</span><span class="m">3</span>
<span class="nb">echo</span> <span class="nv">%a%</span>
<span class="kd">set</span> <span class="na">/a </span><span class="kd">a</span><span class="o">=</span><span class="kd">a</span><span class="na">+a
</span><span class="nb">echo</span> <span class="nv">%a%</span>
<span class="nb">pause</span>
</code></pre></div></div><h2 id="set-p">set /p:</h2><p><code class="language-plaintext highlighter-rouge">set /p</code> 命令用于接受用户输入并将输入的内容赋值给变量。以下是一些示例用法：</p><ul><li><strong>基本用法</strong>：在控制台显示提示信息，然后接受用户输入赋值给变量 <code class="language-plaintext highlighter-rouge">a</code>。<div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">set</span> <span class="na">/p </span><span class="kd">a</span><span class="o">=</span>请输入值
</code></pre></div></div></li><li><strong>从文件中读取</strong>：显示自定义的提示信息，然后将文件 <code class="language-plaintext highlighter-rouge">1.txt</code> 中的内容赋值给变量 <code class="language-plaintext highlighter-rouge">a</code>，通常表现为文件的第一行内容。<div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">set</span> <span class="na">/p </span><span class="kd">a</span><span class="o">=</span><span class="kd">promptstring</span><span class="o">&lt;</span><span class="m">1</span>.txt
</code></pre></div></div></li><li><strong>从空设备中读取</strong>：显示自定义的提示信息，然后将空设备 <code class="language-plaintext highlighter-rouge">nul</code> 中的内容赋值给变量 <code class="language-plaintext highlighter-rouge">a</code>，实际上不会有内容被赋值，变量 <code class="language-plaintext highlighter-rouge">a</code> 保持未定义状态。<div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">set</span> <span class="na">/p </span><span class="kd">a</span><span class="o">=</span><span class="kd">promptstring</span><span class="o">&lt;</span><span class="kr">nul</span>
</code></pre></div></div></li><li><strong>空变量</strong>：显示自定义的提示信息，但不会将任何内容赋值给变量，仅作为显示之用。需要用户按回车键结束语句。<div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">set</span> <span class="na">/p </span><span class="o">=</span><span class="kd">promptstring</span>
</code></pre></div></div></li></ul><h1 id="call">call</h1><p><code class="language-plaintext highlighter-rouge">call</code>命令用来从一个批处理脚本中调用另一个批处理脚本<br /> 语法:</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">call</span> <span class="o">[</span> <span class="o">[</span><span class="kd">Drive</span>:<span class="o">]</span> <span class="o">[</span><span class="kd">Path</span><span class="o">]</span> <span class="kd">FileName</span> <span class="o">[</span><span class="kd">BatchParameters</span><span class="o">]]</span> <span class="o">[</span><span class="nl">:label</span> <span class="o">[</span><span class="kd">arguments</span><span class="o">]]</span>  
</code></pre></div></div><p>参数:</p><ul><li><strong>[Drive:][Path] FileName</strong> 指定要调用的批处理程序的位置和名称。</li><li><strong>Filename</strong> 参数必须是.bat 或 .cmd 扩展名的类型文件。</li><li><strong>BatchParameters</strong> 指定批处理程序所需的命令行信息（即参数项）。</li></ul><p>使用<code class="language-plaintext highlighter-rouge">call</code>调用另一个批处理程序，不会终止父批处理程序。如果不用<code class="language-plaintext highlighter-rouge">call</code>而直接调用别的批处理文件，那么执行完那个批处理文件后将无法返回当前文件执行后续命令。<br /> <code class="language-plaintext highlighter-rouge">call</code> 命令可以在同一个批处理脚本中的不同部分之间进行跳转调用。<br /> 在脚本或批处理文件外使用<code class="language-plaintext highlighter-rouge">call</code>没有作用，它不会在命令行起作用。<br /> <code class="language-plaintext highlighter-rouge">call</code>调用类似于函数调用的执行逻辑。<br /> 调用标签:</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@echo <span class="na">off</span>
<span class="k">call</span> <span class="nl">:label</span>
<span class="nb">echo</span> <span class="m">1</span>
<span class="nb">echo</span> <span class="m">2</span>
<span class="nl">:label</span>
<span class="nb">echo</span> <span class="m">3</span>
<span class="nb">echo</span> <span class="m">4</span>
</code></pre></div></div><p>结果：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>3
4
请按任意键继续. . .
1
2
3
4
请按任意键继续. . .
</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">call</code>调用标签时也可以带参数:</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@echo <span class="na">off</span>
<span class="k">call</span> <span class="nl">:loop</span> <span class="kd">Hello</span> <span class="kd">World</span><span class="err">!</span>
<span class="nb">pause</span><span class="o">&gt;</span><span class="kr">nul</span> <span class="o">&amp;</span> <span class="k">goto</span> <span class="nl">:eof</span>
<span class="nl">:loop</span>
<span class="nb">echo</span> <span class="err">%</span><span class="m">1</span>
<span class="nb">echo</span> <span class="err">%</span><span class="m">2</span>
<span class="nl">:eof</span>
<span class="k">exit</span>
</code></pre></div></div><p>结果:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hello
World!
</code></pre></div></div><h1 id="start">start</h1><p>对于start概括两句话：“不同进程不能传值”，“相同进程单向传值，父传子”。<br /> 对于call，“同一进程，变量互通”。（进程参数不能引用）<br /> <strong><code class="language-plaintext highlighter-rouge">start</code>与<code class="language-plaintext highlighter-rouge">call</code>命令的区别</strong>：<br /> <strong>调用范围不同</strong>：<code class="language-plaintext highlighter-rouge">call</code>主要用来进行批处理的内部调用，如<code class="language-plaintext highlighter-rouge">call :pend</code> 和一些dos命令的调用如<code class="language-plaintext highlighter-rouge">call set test=2</code>，但也可以调用其他可执行文件。而<code class="language-plaintext highlighter-rouge">start</code>则不能进行内部调用，但其可以执行基本上所有的外部程序，还可以执行shell，如打开文件夹<code class="language-plaintext highlighter-rouge">start "" "%WINDIR%"</code>，安装网络打印机<code class="language-plaintext highlighter-rouge">start "" "\\IP\Printer"</code>等等。<br /> <strong>调用方式不同</strong>：<code class="language-plaintext highlighter-rouge">call</code>是严格意义上的调用，在<code class="language-plaintext highlighter-rouge">call</code>另一个批处理时是在同一窗体进程里执行。而start执行时则是在不同的窗口进程里执行的，使用 <code class="language-plaintext highlighter-rouge">start /b</code> 可以在后台执行程序，但其结果与前台执行不同。<br /> 如:<code class="language-plaintext highlighter-rouge">call set test=2</code> 和 <code class="language-plaintext highlighter-rouge">start /b set test=2</code> 执行的结果相同，但后者有两个进程，且在窗口里要执行两次exit才能退出，因此使用<code class="language-plaintext highlighter-rouge">start</code>执行的批处理文件最好在最后写上<code class="language-plaintext highlighter-rouge">exit</code>，否则无法退出被调用的批处理的dos窗口。被<code class="language-plaintext highlighter-rouge">call</code>调用的批处理文件中如果存在<code class="language-plaintext highlighter-rouge">exit</code>则会直接结束原始调用的批处理程序。因此与<code class="language-plaintext highlighter-rouge">start</code>相反,不要使用<code class="language-plaintext highlighter-rouge">exit</code>退出,可以使用<code class="language-plaintext highlighter-rouge">goto :eof</code>来取代<code class="language-plaintext highlighter-rouge">exit</code>。<br /> <strong>调用结果不同</strong>：<code class="language-plaintext highlighter-rouge">call</code> 可以传递参数或变量给被调用的批处理，并且被调用的批处理也可以设置参数或变量以回传。而 <code class="language-plaintext highlighter-rouge">start</code> 只能传递参数或变量给被调用的批处理，无法回传参数或变量。<br /> <strong>注意事项</strong>：使用 <code class="language-plaintext highlighter-rouge">call</code> 调用其他批处理时，要注意使用不同的标签名来跳转，以避免跳转到原批处理中而导致执行不完整。</p><h1 id="goto">goto</h1><p>在批处理中，<code class="language-plaintext highlighter-rouge">goto</code> 语句用于无条件地跳转到脚本中的指定标签处。标签是一个以冒号开头的标识符，用于标记脚本中的某一行。<code class="language-plaintext highlighter-rouge">goto</code> 语句的基本语法如下：</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">goto</span> <span class="nb">label</span>
</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">label</code> 是要跳转到的标签。例如：</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@echo <span class="na">off</span>
<span class="nb">echo</span> <span class="kd">Before</span> <span class="kd">the</span> <span class="k">goto</span>.
<span class="k">goto</span> <span class="kd">mylabel</span>
<span class="nb">echo</span> <span class="kd">This</span> <span class="kd">line</span> <span class="kd">will</span> <span class="kd">be</span> <span class="kd">skipped</span>.
<span class="nl">:mylabel</span>
<span class="nb">echo</span> <span class="kd">After</span> <span class="kd">the</span> <span class="k">goto</span>.
</code></pre></div></div><p>在上面的例子中，<code class="language-plaintext highlighter-rouge">goto mylabel</code> 会跳转到标签 <code class="language-plaintext highlighter-rouge">:mylabel</code> 处，执行标签处的命令。因此，输出将会是：</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Before the goto.
After the goto.
</code></pre></div></div><p>需要注意的是，<code class="language-plaintext highlighter-rouge">goto</code> 语句是一个无条件跳转，会直接跳转到指定的标签处，而不会执行跳转语句之后的代码。如果要在条件满足时执行跳转，可以结合 <code class="language-plaintext highlighter-rouge">if</code> 语句使用。</p><h1 id="-3">&amp;|&amp;&amp;||</h1><h2 id="-连接符">&amp; 连接符</h2><p>命令格式 :</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>...<span class="o">]</span> <span class="kd">command1</span> <span class="o">&amp;</span> <span class="kd">command2</span>
</code></pre></div></div><p>用来分隔一个命令行中的多个命令。cmd.exe 先运行第一个命令，然后运行第二个命令。</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="m">123</span><span class="o">&amp;</span><span class="nb">echo</span> <span class="m">456</span>
</code></pre></div></div><h2 id="-4">&amp;&amp;</h2><p>命令格式:</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>...<span class="o">]</span> <span class="kd">command1</span> <span class="o">&amp;&amp;</span> <span class="kd">command2</span> 
</code></pre></div></div><p>只有在符号<code class="language-plaintext highlighter-rouge">&amp;&amp;</code>前面的命令执行成功时，才会执行该符号后面的命令。</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> <span class="m">123</span><span class="o">&amp;&amp;</span><span class="nb">echo</span> 已进入123文件夹
</code></pre></div></div><h2 id="-5">||</h2><p>命令格式:</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>...<span class="o">]</span> <span class="kd">command1</span> <span class="o">||</span> <span class="kd">command2</span>
</code></pre></div></div><p>只有在符号<code class="language-plaintext highlighter-rouge">||</code>前面的命令执行失败时，才会执行符号<code class="language-plaintext highlighter-rouge">||</code>后面的命令。</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> <span class="m">123</span><span class="o">||</span><span class="nb">echo</span> 无法进入123文件夹
</code></pre></div></div><h2 id="-管道符">| 管道符</h2><p>命令格式:</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">command1</span><span class="o">|</span><span class="kd">command2</span>
</code></pre></div></div><p>让前一命令的输出当做后一命令的输入</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">help</span><span class="o">|</span><span class="nb">more</span>
</code></pre></div></div><h1 id="-6">&gt;&lt;»</h1><p>使用重定向符号可以将输出结果保存到文件中。</p><table><thead><tr><th>说明</th><th>数字</th></tr></thead><tbody><tr><td>标准输入（stdin）</td><td>0</td></tr><tr><td>标准输出（stdout）</td><td>1</td></tr><tr><td>标准错误输出（stderr）</td><td>2</td></tr></tbody></table><p><code class="language-plaintext highlighter-rouge">&gt;</code>符号和<code class="language-plaintext highlighter-rouge">&gt;&gt;</code>符号为两个常用的重定向符号。<br /> <code class="language-plaintext highlighter-rouge">&gt;</code>会将原始文件的内容清空，而<code class="language-plaintext highlighter-rouge">&gt;&gt;</code>会在文件后面追加内容，如果文件不存在则都会创建文件。</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="kd">Hello</span> <span class="kd">World</span> <span class="o">&gt;</span><span class="kd">file</span>.txt
</code></pre></div></div><p>运行后，会将<code class="language-plaintext highlighter-rouge">Hello World</code>输出到<code class="language-plaintext highlighter-rouge">file.txt</code>中<br /> 上述代码等价于下面的代码：</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="kd">Hello</span> <span class="kd">World</span> <span class="m">1</span><span class="o">&gt;</span><span class="kd">file</span>.txt
</code></pre></div></div><p>其中<code class="language-plaintext highlighter-rouge">1</code>的意思是代表将标准输出重定向，标准输出即正常的输出内容。<br /> 而<code class="language-plaintext highlighter-rouge">2&gt;file.txt</code>则代表将错误信息输出到<code class="language-plaintext highlighter-rouge">file.txt</code>中，这样<code class="language-plaintext highlighter-rouge">Hello World</code>会显示在屏幕上，只有报错的信息会保存在<code class="language-plaintext highlighter-rouge">file.txt</code>中</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="kd">Hello</span> <span class="kd">World</span> <span class="o">&gt;&gt;</span><span class="kd">file</span>.txt
</code></pre></div></div><p>上面的语句使用了2个&gt;，表示追加内容，如果<code class="language-plaintext highlighter-rouge">file.txt</code>内容不是空，则<code class="language-plaintext highlighter-rouge">Hello World</code>会在最后一行的后面另起一行保存。</p><p>对于<code class="language-plaintext highlighter-rouge">&lt;</code>符号,是这样使用的:</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">set</span> <span class="na">/p </span><span class="kd">a</span><span class="o">=</span><span class="kd">promptstring</span><span class="o">&lt;</span><span class="m">1</span>.txt
</code></pre></div></div><p>先显示<code class="language-plaintext highlighter-rouge">promptstring</code>，再把”&lt;”管道号右边的1.txt文件中从第一个字符开始直到碰到回车符的内容赋值给变量a（通常表现为第一行）。</p><p>0的使用(输入):输入0代表标准输入(stdin)，可以用来重定向输入。</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="m">123</span><span class="o">&gt;</span><span class="kd">a</span>.txt
<span class="m">0</span><span class="o">&lt;</span><span class="kd">a</span>.txt <span class="kd">set</span> <span class="na">/p </span><span class="kd">a</span><span class="o">=</span><span class="m">123</span><span class="o">?</span>
<span class="nb">echo</span> <span class="nv">%a%</span>
<span class="nb">pause</span>
</code></pre></div></div><p>将标准错误输出重定向到标准输出，并将输出结果丢弃:</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span><span class="kr">nul</span> <span class="m">2</span><span class="o">&gt;&amp;</span><span class="m">1</span>
</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">2&gt;&amp;1</code>是将标准错误输出重定向到标准输出,符号<code class="language-plaintext highlighter-rouge">&gt;&amp;</code>是一个整体，不可分开，分开后就不是上述含义了。<br /> 比如有些人可能会这么想：<code class="language-plaintext highlighter-rouge">2</code>是标准错误输入，<code class="language-plaintext highlighter-rouge">1</code>是标准输出，<code class="language-plaintext highlighter-rouge">&gt;</code>是重定向符号，那么”将标准错误输出重定向到标准输出”是不是就应该写成<code class="language-plaintext highlighter-rouge">2&gt;1</code>就行了？这么做实际上是:将标准错误输出重定向到名为<code class="language-plaintext highlighter-rouge">1</code>的文件里去了<br /> 在批处理中写成<code class="language-plaintext highlighter-rouge">2&amp;&gt;1</code>也是不可以的</p><details close=""> <summary>以下简写在批处理中是无法使用的:</summary> 每次都写”1&gt;nul 2&gt;&amp;1”太麻烦，能简写吗？有两种简写方式:`&amp;&gt;nul`,`&gt;&amp;nul`<br /> 上面两种方式都和”1&gt;nul 2&gt;&amp;1”一个语义。<br /> `&amp;&gt;`和`&gt;&amp;`语义上是没有任何区别的，但是第一中方式是最佳选择，一般使用第一种<br /> </details><div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"><h3>文档信息</h3><ul><li>本文作者：<a href="" target="_blank">acteds</a></li><li>本文链接：<a href="/2019/04/13/%E6%89%B9%E5%A4%84%E7%90%86batch%E9%87%8D%E7%82%B9%E7%9F%A5%E8%AF%861.%E5%9F%BA%E7%A1%80/" target="_blank">https://acteds.github.io/2019/04/13/%E6%89%B9%E5%A4%84%E7%90%86batch%E9%87%8D%E7%82%B9%E7%9F%A5%E8%AF%861.%E5%9F%BA%E7%A1%80/</a></li><li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li></ul></div></article><div class="share"></div><div class="comment"> <script src="https://beaudar.lipk.org/client.js" repo="mzlogin/blog-comments" issue-term="title" label="gitment" theme="github-light" comment-order="desc" input-position="top" crossorigin="anonymous" async> </script></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"></div><ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul><script src="/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: '/assets/search_data.json?v=1713620532', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 10, fuzzy: false, exclude: ['Welcome'] }) </script><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="/assets/js/jquery.toc.js"></script></div></div></section><footer class="container"><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2024 <span title="acteds">acteds</span> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo(0,0)" >TOP</a></li></ul><a href="https://github.com/acteds/acteds.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="/" title="首页" target="">首页</a></li><li> <a href="/categories/" title="分类" target="">分类</a></li><li> <a href="/wiki/" title="维基" target="">维基</a></li><li> <a href="/about/" title="关于" target="">关于</a></li><li><a href="/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a></div><script src="/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script></body></html>
