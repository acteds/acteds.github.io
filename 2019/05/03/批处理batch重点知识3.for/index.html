<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>批处理batch重点知识3.for &mdash; 个人博客</title><link rel="stylesheet" href="/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="/assets/css/components/collection.css"><link rel="stylesheet" href="/assets/css/components/repo-card.css"><link rel="stylesheet" href="/assets/css/sections/repo-list.css"><link rel="stylesheet" href="/assets/css/components/boxed-group.css"><link rel="stylesheet" href="/assets/css/globals/common.css"><link rel="stylesheet" href="/assets/css/globals/responsive.css"><link rel="stylesheet" href="/assets/css/posts/index.css"><link rel="stylesheet" href="/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="/assets/css/highlight/monokai.sublime.css"><link rel="canonical" href="/2019/05/03/%E6%89%B9%E5%A4%84%E7%90%86batch%E9%87%8D%E7%82%B9%E7%9F%A5%E8%AF%863.for/"><link rel="alternate" type="application/atom+xml" title="个人博客" href="/feed.xml"><link rel="shortcut icon" href="/favicon.ico"><meta property="og:title" content="批处理batch重点知识3.for"><meta name="keywords" content="windows, batch"><meta name="og:keywords" content="windows, batch"><meta name="description" content="引言本篇文章介绍批处理for语句的无参形式、带/d的子文件夹形式、带/r的遍历形式、带/l的循环形式、带/f的文本处理形式。"><meta name="og:description" content="引言本篇文章介绍批处理for语句的无参形式、带/d的子文件夹形式、带/r的遍历形式、带/l的循环形式、带/f的文本处理形式。"><meta property="og:url" content="/2019/05/03/%E6%89%B9%E5%A4%84%E7%90%86batch%E9%87%8D%E7%82%B9%E7%9F%A5%E8%AF%863.for/"><meta property="og:site_name" content="个人博客"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2019-05-03"> <script src="/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="/assets/js/jquery-ui.js"></script> <script src="/assets/js/main.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-80669434-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-80669434-1'); </script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1><a href="/" title="个人博客"><span class="octicon octicon-mark-github"></span> 个人博客</a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="/" class=" site-header-nav-item" target="" title="首页">首页</a> <a href="/categories/" class=" site-header-nav-item" target="" title="分类">分类</a> <a href="/wiki/" class=" site-header-nav-item" target="" title="维基">维基</a> <a href="/about/" class=" site-header-nav-item" target="" title="关于">关于</a></nav></div></header><section class="collection-head small geopattern" data-pattern-id="批处理batch重点知识3.f"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">批处理batch重点知识3.for</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2019/05/03 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="/categories/#windows" title="windows">windows</a> </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="/categories/#batch" title="batch">batch</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 5724 字，约 17 分钟 </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths" ><article class="article-content markdown-body"><h1 id="引言">引言</h1><p>本篇文章介绍批处理<strong>for</strong>语句的无参形式、带<code class="language-plaintext highlighter-rouge">/d</code>的子文件夹形式、带<code class="language-plaintext highlighter-rouge">/r</code>的遍历形式、带<code class="language-plaintext highlighter-rouge">/l</code>的循环形式、带<code class="language-plaintext highlighter-rouge">/f</code>的文本处理形式。</p><h1 id="for-循环">for 循环</h1><font color="red">bat文件中for里用%%i，cmd直接输入时用%i</font><h2 id="一般格式">一般格式：</h2><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">FOR</span> <span class="o">[</span>参数<span class="o">]</span> <span class="err">%%</span>变量名 <span class="kd">IN</span> <span class="o">(</span>相关文件或命令<span class="o">)</span> <span class="kd">DO</span> 执行的命令
</code></pre></div></div><h2 id="无参数子文件">无参数(子文件)</h2><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">FOR</span> <span class="vm">%%variable</span> <span class="kd">IN</span> <span class="o">(</span><span class="kd">set</span><span class="o">)</span> <span class="kd">DO</span> <span class="kd">command</span> <span class="o">[</span><span class="kd">command</span><span class="na">-parameters</span><span class="o">]</span>
</code></pre></div></div><ul><li><strong>for</strong>语句的形式变量<code class="language-plaintext highlighter-rouge">i</code>，可以换成26个字母中的任意一个，<strong>区分大小写</strong>，形式变量<code class="language-plaintext highlighter-rouge">i</code>也可以换成其他的字符，注意不要与<code class="language-plaintext highlighter-rouge">%0</code>～<code class="language-plaintext highlighter-rouge">%9</code>这10个形式变量发生冲突。</li><li><strong>in</strong>和<strong>do</strong>之间的<strong>set</strong>表示的字符串或变量可以是一个，也可以是多个，用<strong>空格键、跳格键、逗号、分号</strong>或<strong>等号分隔</strong>；</li><li><strong>for</strong>语句<strong>依次提取</strong> <strong>set</strong>中的每一个元素，把它的值赋予形式变量<code class="language-plaintext highlighter-rouge">i</code>，然后把<code class="language-plaintext highlighter-rouge">%%i</code>带到<strong>do</strong>后的<strong>command</strong>中参与命令的执行；直到集合中的所有元素都被遍历后才停止<strong>for</strong>循环.</li></ul><p>实例:</p><p>显示结果分成了3行,每一行都从逗号处被切分；</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="vm">%%I</span> <span class="k">in</span> <span class="o">(</span><span class="kd">a</span><span class="o">,</span><span class="kd">b</span><span class="o">,</span><span class="kd">c</span><span class="o">)</span> <span class="k">do</span> <span class="nb">echo</span> <span class="vm">%%I</span>
</code></pre></div></div><p>直接显示<code class="language-plaintext highlighter-rouge">a.b.c</code>，<strong>因为.号不是分隔符</strong></p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="vm">%%I</span> <span class="k">in</span> <span class="o">(</span><span class="kd">a</span>.b.c<span class="o">)</span> <span class="k">do</span> <span class="nb">echo</span> <span class="vm">%%I</span>
</code></pre></div></div><p>当set带有<code class="language-plaintext highlighter-rouge">*</code>或<code class="language-plaintext highlighter-rouge">?</code>号时会搜索当前工作路径相匹配的文件与文件夹路径.</p><p>无参数时只会搜索当前目录下的文件，且不能匹配带隐藏属性的文件.</p><p>显示当前目录下与<code class="language-plaintext highlighter-rouge">*.*</code>相匹配的文件(不遍历子文件夹）</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="vm">%%i</span> <span class="k">in</span> <span class="o">(*</span>.<span class="o">*)</span> <span class="k">do</span> <span class="nb">echo</span> <span class="vm">%%i</span>
</code></pre></div></div><p>显示<code class="language-plaintext highlighter-rouge">d:\7-Zip\</code>目录下与<code class="language-plaintext highlighter-rouge">*.*</code>相匹配的文件(不遍历子文件夹）</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="kd">d</span>:\7<span class="na">-Zip</span>\<span class="o">*</span>.<span class="o">*)</span> <span class="k">do</span> @echo <span class="vm">%%i</span>
</code></pre></div></div><p>检测当前硬盘都有哪些分区,包括U盘和移动硬盘的分区</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@echo <span class="na">off</span>
<span class="kd">set</span> <span class="kd">str</span><span class="o">=</span><span class="kd">c</span> <span class="kd">d</span> <span class="kd">e</span> <span class="kd">f</span> <span class="kd">g</span> <span class="kd">h</span> <span class="kd">i</span> <span class="kd">j</span> <span class="kd">k</span> <span class="kd">l</span> <span class="kd">m</span> <span class="kd">n</span> <span class="kd">o</span> <span class="kd">p</span> <span class="kd">q</span> <span class="kd">r</span> <span class="kd">s</span> <span class="kd">t</span> <span class="kd">u</span> <span class="kd">v</span> <span class="kd">w</span> <span class="kd">x</span> <span class="kd">y</span> <span class="kd">z</span>
<span class="nb">echo</span> 当前硬盘的分区有：
<span class="k">for</span> <span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="nv">%str%</span><span class="o">)</span> <span class="k">do</span> <span class="k">if</span> <span class="ow">exist</span> <span class="vm">%%i</span>: <span class="nb">echo</span> <span class="vm">%%i</span>:
<span class="nb">pause</span>
</code></pre></div></div><h2 id="参数-d子文件夹"><strong>参数 /d(子文件夹)</strong></h2><p>这个参数只能搜索当前目录的<strong>子文件夹</strong>，且不能匹配带隐藏属性的文件夹</p><p>格式:</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="na">/d </span><span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span>元素集合<span class="o">)</span> <span class="k">do</span> 命令语句集合
</code></pre></div></div><p>当<code class="language-plaintext highlighter-rouge">元素集合</code>中包含有通配符<code class="language-plaintext highlighter-rouge">?</code>或<code class="language-plaintext highlighter-rouge">*</code>时，会匹配文件夹。如果没有包含通配符，则有<code class="language-plaintext highlighter-rouge">/d</code>参数和无<code class="language-plaintext highlighter-rouge">/d</code>参数效果一样.</p><p>它<strong>仅能匹配当前目录下的第一级文件夹</strong>，或是指定位置的文件夹的下一级文件夹，而不能匹配更深层次的子文件夹。</p><p>显示c盘根目录下的所有目录(不遍历子文件夹）</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="na">/d </span><span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="kd">c</span>:\<span class="o">*)</span> <span class="k">do</span> @echo <span class="vm">%%i</span>
</code></pre></div></div><p>显示当前目录下名字只有1-3个字母的目录</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="na">/d </span><span class="vm">%%i</span> <span class="k">in</span> <span class="o">(???)</span> <span class="k">do</span> @echo <span class="vm">%%i</span>
</code></pre></div></div><h2 id="参数-r遍历">参数 /r(遍历)</h2><p>遍历文件夹(包括子文件夹)，但不能列举带隐藏属性的文件夹<br /> 格式:</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="na">/r </span>文件夹 <span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span>元素集合<span class="o">)</span> <span class="k">do</span> 命令语句集合
</code></pre></div></div><p>列举<code class="language-plaintext highlighter-rouge">文件夹</code>及该文件夹路径下所有子文件夹，并把列举出来的文件夹路径与元素集合中的每一个元素拼接成形如“文件夹路径\元素”赋值给<code class="language-plaintext highlighter-rouge">%%i</code>,并执行一次<strong>命令语句集合</strong>.</p><p><strong>当<code class="language-plaintext highlighter-rouge">元素集合</code>带以点号分隔的通配符<code class="language-plaintext highlighter-rouge">?</code>或<code class="language-plaintext highlighter-rouge">*</code>的时候</strong>，把<code class="language-plaintext highlighter-rouge">元素集合</code>视为文件（不视为文件夹），整条语句的作用是匹配文件夹及其所有子文件夹下匹配的文件；<strong>若不以点号分隔，则把<code class="language-plaintext highlighter-rouge">元素集合</code>视为文件夹</strong>（不视为文件）；</p><p>当省略掉文件夹时，则针对当前目录；</p><p>将<code class="language-plaintext highlighter-rouge">d:\7zip</code>下的EXE文件输出</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="na">/r </span><span class="kd">d</span>:\7<span class="na">-zip </span><span class="vm">%%i</span> <span class="k">in</span> <span class="o">(*</span>.exe<span class="o">)</span> <span class="k">do</span> @echo <span class="vm">%%i</span>
</code></pre></div></div><p>将<code class="language-plaintext highlighter-rouge">d:\7zip</code>下的所有文件夹输出并加上<strong>in</strong>后面括号内的字符</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="na">/r </span><span class="kd">d</span>:\7<span class="na">-zip </span><span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span>任何没有通配符的字符<span class="o">)</span> <span class="k">do</span> @echo <span class="vm">%%i</span>
</code></pre></div></div><p>在<code class="language-plaintext highlighter-rouge">d:\7zip</code>列举<code class="language-plaintext highlighter-rouge">7z.dll</code>存在的目录</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="na">/r </span><span class="kd">d</span>:\7<span class="na">-zip </span><span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="m">7</span><span class="kd">z</span>.dll<span class="o">)</span> <span class="k">do</span> @if <span class="ow">exist</span> <span class="vm">%%i</span> <span class="nb">echo</span> <span class="vm">%%i</span>
</code></pre></div></div><p>将<code class="language-plaintext highlighter-rouge">d:\7zip</code>下的所有文件夹输出并加上<strong>in</strong>内的字符,这里会输出3次</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="na">/r </span><span class="kd">d</span>:\7<span class="na">-zip </span><span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="kd">a</span> <span class="kd">b</span> <span class="kd">c</span><span class="o">)</span> <span class="k">do</span> <span class="nb">echo</span> <span class="vm">%%i</span>
</code></pre></div></div><p><strong>for /r /d是可以一起使用的</strong></p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@echo <span class="na">off</span>
<span class="kd">For</span> <span class="na">/r /d </span><span class="vm">%%i</span> <span class="k">in</span> <span class="o">(*)</span> <span class="k">do</span> <span class="nb">echo</span> <span class="vm">%%i</span>
<span class="nb">pause</span><span class="o">&gt;</span><span class="kr">nul</span>
</code></pre></div></div><p>效果：</p><p>显示当前目录下所有的文件夹(<strong>包括子文件夹</strong>)；等价于 <code class="language-plaintext highlighter-rouge">dir /ad /s /b</code>。</p><p><code class="language-plaintext highlighter-rouge">for /r /d </code>其实是对 <code class="language-plaintext highlighter-rouge">/d</code> 参数的扩展，<code class="language-plaintext highlighter-rouge">/d</code>参数本身只能处理第一层文件夹，但是加上<code class="language-plaintext highlighter-rouge">/r</code>参数后就可以处理所有的子文件夹；</p><p>但<code class="language-plaintext highlighter-rouge">for /r /d</code><strong>依然不能处理隐藏文件夹</strong>。</p><p>这里给出使用<code class="language-plaintext highlighter-rouge">for /r /d</code>的一般条件：</p><ol><li>要对文件夹进行操作（<code class="language-plaintext highlighter-rouge">dir /ad /s /b</code>可以显示，但不能对文件夹进行操作）；</li><li>不处理隐藏文件夹（说到底，还是<code class="language-plaintext highlighter-rouge">for /f</code> 和<code class="language-plaintext highlighter-rouge">dir</code>结合的命令更强大些）。</li></ol><p><strong>for /r</strong> 与 <strong>dir /ad /s</strong>类似,它们有如下几个优缺点:</p><p><strong>for /r：</strong></p><ul><li>只通过1条语句就可以同时实现获取目录路径和处理目录路径的操作；</li><li>遍历文件夹的时候，是边列举边处理的，获取到一条路径就处理一条路径，内存占用小，处理大量路径的时候不会产生停顿感；</li><li>不能获取到带隐藏属性的目录，会产生遗漏；不能获取带指定属性的目录</li></ul><p><strong>dir /ad /s：</strong></p><ul><li>能一次性获取带任意属性的目录，不会产生遗漏；能通过指定不同的参数获取带任意属性的目录，更具灵活性。</li><li><code class="language-plaintext highlighter-rouge">dir /ad /s</code> 语句仅能获取到目录路径，若要实现进一步的处理，还需要嵌入 for /f 语句中才能实现，写法不够简洁；</li><li>嵌入<code class="language-plaintext highlighter-rouge"> for /f</code> 语句之后，需要写成 <code class="language-plaintext highlighter-rouge">for /f "delims=" %%i in ('dir /ad /b /s') do ……</code> 的格式，受 <code class="language-plaintext highlighter-rouge">for /f</code> 语句运行机制的制约，需要先列举完所有的路径放入内存之后，才能对每一条路径进行进一步的处理，处理大量路径时，内存占用量偏大，并且在前期会产生明显的停顿感，用户体验度不够好；</li></ul><h2 id="参数-l-循环">参数 /L (循环)</h2><p>语法:</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">FOR</span> <span class="na">/L </span><span class="vm">%variable</span> <span class="kd">IN</span> <span class="o">(</span><span class="nb">start</span><span class="o">,</span><span class="kd">step</span><span class="o">,</span><span class="kd">end</span><span class="o">)</span> <span class="kd">DO</span> <span class="kd">command</span> <span class="o">[</span><span class="kd">command</span><span class="na">-parameters</span><span class="o">]</span>
</code></pre></div></div><p>与C语言的for差不多.</p><div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">=</span><span class="n">start</span><span class="p">;</span><span class="n">a</span><span class="o">&lt;=</span><span class="p">(</span><span class="err">或</span><span class="o">&gt;=</span><span class="p">)</span><span class="n">end</span><span class="p">;</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="o">+</span><span class="n">step</span><span class="p">)</span>
</code></pre></div></div><p>详解：</p><p>在这个语句中，<strong>start</strong>、<strong>step</strong>和<strong>end</strong>都只能取整数，正负皆可，<strong>start</strong>指代起始值，<strong>step</strong>指代步长，<strong>end</strong>为终止值，具体含义为：从<strong>start</strong>开始计数，以<strong>step</strong>为步长，直至最接近 <strong>end</strong>的那个整数值为止，这之间有多少个数，<strong>do</strong>后的语句就执行多少次。</p><p>实际上，<strong>start</strong>，<strong>step</strong>和<strong>end</strong>的值可正可负，甚至为0，限制非常宽松：</p><ul><li><strong>步长step的值不能为0；</strong></li><li><strong>当步长step的值为正整数时，终止值end不能小于初始值start；</strong></li><li><strong>当步长step的值为负整数的时候，终止值end不能大于初始值start。</strong></li></ul><p>换而言之，必须保证in和do之间能取到一个有效的数组序列。</p><div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="o">/</span><span class="n">l</span> <span class="o">%%</span><span class="n">i</span> <span class="n">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="k">do</span> <span class="err">@</span><span class="n">set</span> <span class="o">/</span><span class="n">p</span> <span class="o">=%%</span><span class="n">i</span><span class="p">,</span><span class="o">&lt;</span><span class="n">nul</span>
</code></pre></div></div><p>输出2,3,4,5,</p><div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="o">/</span><span class="n">l</span> <span class="o">%%</span><span class="n">i</span> <span class="n">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="k">do</span> <span class="err">@</span><span class="n">echo</span> <span class="o">%%</span><span class="n">i</span><span class="p">,</span>
</code></pre></div></div><p>输出2,回车3,回车4,回车5,回车</p><div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="o">/</span><span class="n">l</span> <span class="o">%%</span><span class="n">i</span> <span class="n">in</span> <span class="p">(</span><span class="mi">2</span> <span class="mi">1</span> <span class="mi">5</span><span class="p">)</span> <span class="k">do</span> <span class="err">@</span><span class="n">echo</span> <span class="o">%%</span><span class="n">i</span><span class="p">,</span>
</code></pre></div></div><p>输出2,回车3,回车4,回车5,回车</p><p><strong>for /r</strong>与<strong>goto</strong>如何选择:</p><ul><li>当循环次数<strong>确定</strong>的时候，首选 <code class="language-plaintext highlighter-rouge">for /l</code> 语句，也可使用<code class="language-plaintext highlighter-rouge">goto</code>语句但不推荐；</li><li>当循环次数<strong>不确定</strong>的时候，用<code class="language-plaintext highlighter-rouge">goto</code>语句将是唯一的选择，因为，这个时候需要用<code class="language-plaintext highlighter-rouge">if</code>之类的条件语句来判断何时结束<code class="language-plaintext highlighter-rouge">goto</code>跳转。</li></ul><h2 id="参数-f-文件解析">参数 /F (文件解析)</h2><p><code class="language-plaintext highlighter-rouge">/f</code>参数用于解析文本。</p><p>逐行显示<strong>test.txt</strong>全部文本内容:</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="na">/f </span><span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="kd">test</span>.txt<span class="o">)</span> <span class="k">do</span> <span class="nb">echo</span> <span class="vm">%%i</span>
</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">/f</code>还具有以下几个参数:</p><p>切片<strong>delims=</strong> (默认以<code class="language-plaintext highlighter-rouge">空格键</code>或<code class="language-plaintext highlighter-rouge">跳格键</code>切分)</p><p>定点提取：<strong>tokens=</strong> （默认为<strong>tokens=1</strong>）</p><p>跳过无关内容：<strong>skip=</strong>（默认为<strong>skip=0</strong>）</p><p>忽略以指定字符打头的行：<strong>eol=</strong>（默认为<strong>eol=;</strong>）</p><p>改变语法应对特殊符号:<strong>usebackq</strong></p><h3 id="切片delims">切片delims=</h3><p>如果<strong>没有指定”delims=符号列表”,</strong>默认以空格键或跳格键作为字符串的切分字符</p><p>通过写 <code class="language-plaintext highlighter-rouge">for /f "delims="</code>来禁用默认设置（不会将<strong>“</strong>做为分隔符）</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="na">/f </span><span class="s2">"tokens=1,2 delims= eol="</span> <span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="kd">test</span>.txt<span class="o">)</span> <span class="k">do</span> <span class="nb">echo</span> <span class="vm">%%i</span>
</code></pre></div></div><p>写在中间也是没问题的，不会将分隔符定义为空格，但<strong>eol</strong>会用”号进行判断行首</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="na">/f </span><span class="s2">"delims=，"</span> <span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="kd">test</span>.txt<span class="o">)</span> <span class="k">do</span> <span class="nb">echo</span> <span class="vm">%%i</span>
</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">"delims=，"</code>表示以<code class="language-plaintext highlighter-rouge">，</code>号切割每行内容,并将第一段文字赋值给<code class="language-plaintext highlighter-rouge">%%i</code>.</p><p><strong>可以一次性指定多个分隔符号</strong></p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="na">/f </span><span class="s2">"delims=.，"</span> <span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="kd">test</span>.txt<span class="o">)</span> <span class="k">do</span> <span class="nb">echo</span> <span class="vm">%%i</span>
</code></pre></div></div><p>如果要让<strong><code class="language-plaintext highlighter-rouge">"</code></strong>号当分隔符,那么就不能在<strong>delims=</strong>外面加引号了:</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@echo <span class="na">off</span>
<span class="k">for</span> <span class="na">/f </span><span class="kd">usebackq</span><span class="se">^ </span><span class="kd">delims</span><span class="se">^=^"</span> <span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="s1">'内容1</span><span class="se">^"</span><span class="s1">内容2'</span><span class="o">)</span> <span class="k">do</span> <span class="nb">echo</span> <span class="vm">%%i</span>
<span class="nb">pause</span>
</code></pre></div></div><p><strong><code class="language-plaintext highlighter-rouge">^</code></strong>号在批处理中是转义符号.</p><p><strong>usebackq</strong>是为了兼容<strong><code class="language-plaintext highlighter-rouge">in ('内容1^"内容2')</code></strong>,把双引号改写成单引号了,后面会详细说明.<br /> 这样不写双引号，对特殊字符用<code class="language-plaintext highlighter-rouge">^</code>转义就可以将双引号当成一个分隔符</p><p>如果要指定空格和其他分隔符，那么空格要放在最后（必须在”号前）,因为空格用来作为参数的分隔符. 即:<strong>“delims=, “</strong>。</p><h3 id="定点提取tokens">定点提取tokens=</h3><p><strong>tokens=</strong>后面跟<strong>数字</strong>，可以跟多个，每个数字之间用逗号分隔。如 <strong><code class="language-plaintext highlighter-rouge">tokens=3,5,8</code></strong>，提取索引为3，5，8的文本内容，并分别赋值给<code class="language-plaintext highlighter-rouge">%%i</code>、<code class="language-plaintext highlighter-rouge">%%j</code>、<code class="language-plaintext highlighter-rouge">%%k</code>。文本切割由<strong>delims=</strong>处理，索引从1开始，<strong>默认为tokens=1</strong></p><p>实例：</p><p><strong>text.txt</strong>内容：</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>尺有所短，寸有所长，学好批处理没商量，考虑问题复杂化，解决问题简洁化。
</code></pre></div></div><p><strong>提取“学好批处理没商量”这句话</strong></p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="na">/f </span><span class="s2">"delims=， tokens=3"</span> <span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="kd">test</span>.txt<span class="o">)</span> <span class="k">do</span> <span class="nb">echo</span> <span class="vm">%%i</span>
</code></pre></div></div><p>如果 <strong>tokens=</strong> 后面指定了多个数字，如果形式变量为<strong>%%i</strong>，那么，第一个数字索引的内容会赋值给<strong>%%i</strong>，第二个就赋值给<strong>%%j</strong>，以此类推，<strong>遵循字母的排序</strong>。</p><p><strong>批处理命令for…in..do %%a被用到了%%z还不够用怎么办？</strong></p><p>汉字的unicode范围是：0x4E00~0x9FA5，可以用 bat+html 来列举</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@echo <span class="na">off</span>
<span class="o">(</span>
<span class="nb">echo</span> <span class="se">^&lt;</span><span class="kd">pre</span><span class="se">^&gt;</span>
<span class="k">for</span> <span class="na">/l </span><span class="vm">%%a</span> <span class="k">in</span> <span class="o">(</span><span class="mh">0x4E00</span> <span class="m">1</span> <span class="mh">0x9FA5</span><span class="o">)</span> <span class="k">do</span> <span class="nb">echo</span> <span class="se">^&amp;</span>#<span class="vm">%%a</span><span class="o">;</span>
<span class="nb">echo</span> <span class="se">^&lt;</span><span class="na">/pre</span><span class="se">^&gt;</span>
<span class="o">)&gt;</span>汉字.html
</code></pre></div></div><p>然后从中抽取任意一段连续的字符都可以，例如</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>一丁丂七丄丅丆万丈三上下丌不与丏丐丑丒
</code></pre></div></div><p>实例：</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@echo <span class="na">off</span>
<span class="k">for</span> <span class="na">/f </span><span class="s2">"tokens=1-31*"</span> <span class="err">%%</span>一 <span class="k">in</span> <span class="o">(</span><span class="s2">"a b c d e f g h i j k l m"</span><span class="o">)</span> <span class="k">do</span> <span class="nb">echo</span> <span class="err">%%</span>丈
<span class="nb">pause</span>
</code></pre></div></div><p>连续的数字可以只写<strong>最小值</strong>和<strong>最大值</strong>，中间用<strong>短横</strong>连起来。比如 <code class="language-plaintext highlighter-rouge">tokens=1,2,3,4,5</code> 可以简写为 <code class="language-plaintext highlighter-rouge">tokens=1-5</code> 。</p><p><strong>*号表示之后的全部内容</strong>，都由一个变量接收,不再被<strong>delims=</strong>切割,有这几种写法:<code class="language-plaintext highlighter-rouge">"tokens=2,*"</code>,<code class="language-plaintext highlighter-rouge">"tokens=2*"</code>,他们都表示第二个索引代表的内容复制给第一个变量,之后的全部文本赋值给第二个变量。</p><p><strong>跳过无关内容skip=N</strong></p><p>简单来说就是跳过前N行，直接从第N+1行处理，N<strong>是一个正整数</strong>，表示要跳过的行数。例如：</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="na">/f </span><span class="s2">"skip=2"</span> <span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="kd">test</span>.txt<span class="o">)</span> <span class="k">do</span> <span class="nb">echo</span> <span class="vm">%%i</span>
</code></pre></div></div><p>这段代码将跳过头两行内容，从第<strong>3</strong>行起显示test.txt中的信息。</p><h3 id="忽略以指定字符打头的行eol">忽略以指定字符打头的行：eol=;</h3><p><strong>eol=只能指定1个字符。</strong></p><p>默认为<strong>eol=;</strong></p><p>如果设置了<strong>delims=;</strong>则eol=;不会生效,即优先级低于<strong>delims</strong>。</p><p>实例:</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="na">/f </span><span class="s2">"eol=;"</span> <span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="kd">test</span>.txt<span class="o">)</span> <span class="k">do</span> <span class="nb">echo</span> <span class="vm">%%i</span>
</code></pre></div></div><p>如果要取消这个默认设置，只能说没有办法：可以将它指定为一个偏僻字符。</p><p>如果在行尾：<code class="language-plaintext highlighter-rouge">"tokens=1,2 delims= eol="</code> <strong>eol</strong>会用<code class="language-plaintext highlighter-rouge">"</code>进行判断行首</p><p>换成中间：<strong><code class="language-plaintext highlighter-rouge">"tokens=1,2 eol= delims="</code></strong> <strong>eol</strong>会用<code class="language-plaintext highlighter-rouge">空格</code>判断行首</p><h3 id="for-f-的句式以及usebackq">for /f 的句式（以及usebackq）</h3><p><strong>for /f %%i in (……) do (……)</strong> 语句有好几种变形语句具体格式为：</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="na">/f </span><span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span>文件名<span class="o">)</span> <span class="k">do</span> <span class="o">(</span>……<span class="o">)</span>
<span class="k">for</span> <span class="na">/f </span><span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="s1">'命令语句'</span><span class="o">)</span> <span class="k">do</span> <span class="o">(</span>……<span class="o">)</span>
<span class="k">for</span> <span class="na">/f </span><span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="s2">"字符串"</span><span class="o">)</span> <span class="k">do</span> <span class="o">(</span>……<span class="o">)</span>
</code></pre></div></div><p><strong>如果是文件，则无需包裹；如果是命令语句，则用单引号包裹；如果是字符串，则使用双引号括起来</strong>。</p><p>1、读取文本文件中的内容，应该使用第1条语句；</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="na">/f </span><span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="kd">test</span>.txt<span class="o">)</span> <span class="k">do</span> <span class="nb">echo</span> <span class="vm">%%i</span>；
</code></pre></div></div><p>2、读取命令语句执行结果中的内容，应该使用第2条语句；</p><p>显示当前目录下文件名中含有test字符串的文本文件</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="na">/f </span><span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="s1">'dir /a-d /b *test*.txt'</span><span class="o">)</span> <span class="k">do</span> <span class="nb">echo</span> <span class="vm">%%i</span>
</code></pre></div></div><p>3、处理字符串，应该使用第3条语句；</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="na">/f </span><span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="s2">"12345678"</span><span class="o">)</span> <span class="k">do</span> <span class="nb">echo</span> <span class="vm">%%i</span>
</code></pre></div></div><p><strong>usebackq参数用来应对一些特殊情况:</strong></p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="na">/f </span><span class="s2">"usebackq"</span> <span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="s2">"文件名"</span><span class="o">)</span> <span class="k">do</span> <span class="o">(</span>……<span class="o">)</span>
<span class="k">for</span> <span class="na">/f </span><span class="s2">"usebackq"</span> <span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="sb">`命令语句`</span><span class="o">)</span> <span class="k">do</span> <span class="o">(</span>……<span class="o">)</span>
<span class="k">for</span> <span class="na">/f </span><span class="s2">"usebackq"</span> <span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="s1">'字符串'</span><span class="o">)</span> <span class="k">do</span> <span class="o">(</span>……<span class="o">)</span>
</code></pre></div></div><p>之前读取文件的<strong><code class="language-plaintext highlighter-rouge">文件名</code></strong>语法变成<strong><code class="language-plaintext highlighter-rouge">"文件名"</code></strong>。</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="na">/f </span><span class="s2">"usebackq"</span> <span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="s2">"test 1.txt"</span><span class="o">)</span> <span class="k">do</span> <span class="nb">echo</span> <span class="vm">%%i</span>
</code></pre></div></div><p>之前读取命令语句执行结果中的内容,<strong>单引号<code class="language-plaintext highlighter-rouge">'</code></strong>改为后引号<strong>`</strong>:</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="na">/f </span><span class="s2">"usebackq"</span> <span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="sb">`dir /a-d /b *test*.txt`</span><span class="o">)</span> <span class="k">do</span> <span class="nb">echo</span> <span class="vm">%%i</span>
</code></pre></div></div><p>之前的处理字符串，原来的<strong>双引号<code class="language-plaintext highlighter-rouge">"</code></strong>要<strong>改为单引号<code class="language-plaintext highlighter-rouge">'</code></strong>；</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="na">/f </span><span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="s1">'12345678'</span><span class="o">)</span> <span class="k">do</span> <span class="nb">echo</span> <span class="vm">%%i</span>
</code></pre></div></div><p>特殊字符的处理:</p><div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@echo <span class="na">off</span>
<span class="k">for</span> <span class="na">/f </span><span class="s2">"usebackq delims="</span> <span class="vm">%%i</span> <span class="k">in</span> <span class="o">((</span><span class="s1">'</span><span class="se">^"</span><span class="s1">/*?:\</span><span class="se">^"</span><span class="s1"> '</span>：<span class="s1">'"&amp;</span><span class="se">^^</span><span class="s1"> "</span><span class="se">^&amp;</span><span class="s1">，"''"。'</span><span class="o">)</span> <span class="k">do</span> <span class="nb">echo</span> <span class="vm">%%i</span> 
<span class="nb">pause</span>
</code></pre></div></div><p>对于使用了<strong>usebackq</strong> 的<strong>(‘*’)</strong>或者没有<strong>usebackq</strong> 的<strong>(“*”)</strong>的内容有以下规则:</p><ol><li>双引号<code class="language-plaintext highlighter-rouge">"</code>必须成对出现，即双数，就近匹配（被<code class="language-plaintext highlighter-rouge">^</code>转义的双引号不算）</li><li>双引号内的内容会变成普通字符，双引号外的特殊符号要<code class="language-plaintext highlighter-rouge">^</code>转义（<strong>^&amp; “|&lt;&gt;</strong>等等）,<strong>/*?:\</strong>不用转义.</li><li>双引号内不能出现双引号，换个说法就是双引号内可以出现双引号，但需要使用两个双引号来表示一个双引号。</li><li>双引号不论是否被转义，都会显示出来。</li></ol><div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"><h3>文档信息</h3><ul><li>本文作者：<a href="" target="_blank">acteds</a></li><li>本文链接：<a href="/2019/05/03/%E6%89%B9%E5%A4%84%E7%90%86batch%E9%87%8D%E7%82%B9%E7%9F%A5%E8%AF%863.for/" target="_blank">https://acteds.github.io/2019/05/03/%E6%89%B9%E5%A4%84%E7%90%86batch%E9%87%8D%E7%82%B9%E7%9F%A5%E8%AF%863.for/</a></li><li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li></ul></div></article><div class="share"></div><div class="comment"> <script src="https://beaudar.lipk.org/client.js" repo="mzlogin/blog-comments" issue-term="title" label="gitment" theme="github-light" comment-order="desc" input-position="top" crossorigin="anonymous" async> </script></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"></div><ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul><script src="/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: '/assets/search_data.json?v=1718259048', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 10, fuzzy: false, exclude: ['Welcome'] }) </script><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="/assets/js/jquery.toc.js"></script></div></div></section><footer class="container"><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2024 <span title="acteds">acteds</span> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo(0,0)" >TOP</a></li></ul><a href="https://github.com/acteds/acteds.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="/" title="首页" target="">首页</a></li><li> <a href="/categories/" title="分类" target="">分类</a></li><li> <a href="/wiki/" title="维基" target="">维基</a></li><li> <a href="/about/" title="关于" target="">关于</a></li><li><a href="/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a></div><script src="/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script></body></html>
