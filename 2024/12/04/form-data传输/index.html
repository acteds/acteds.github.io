<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>form-data传输 &mdash; 个人博客</title><link rel="stylesheet" href="/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="/assets/css/components/collection.css"><link rel="stylesheet" href="/assets/css/components/repo-card.css"><link rel="stylesheet" href="/assets/css/sections/repo-list.css"><link rel="stylesheet" href="/assets/css/components/boxed-group.css"><link rel="stylesheet" href="/assets/css/globals/common.css"><link rel="stylesheet" href="/assets/css/globals/responsive.css"><link rel="stylesheet" href="/assets/css/posts/index.css"><link rel="stylesheet" href="/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="/assets/css/highlight/monokai.sublime.css"><link rel="canonical" href="/2024/12/04/form-data%E4%BC%A0%E8%BE%93/"><link rel="alternate" type="application/atom+xml" title="个人博客" href="/feed.xml"><link rel="shortcut icon" href="/favicon.ico"><meta property="og:title" content="form-data传输"><meta name="keywords" content="Java,http"><meta name="og:keywords" content="Java,http"><meta name="description" content="引言"><meta name="og:description" content="引言"><meta property="og:url" content="/2024/12/04/form-data%E4%BC%A0%E8%BE%93/"><meta property="og:site_name" content="个人博客"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2024-12-04"> <script src="/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="/assets/js/jquery-ui.js"></script> <script src="/assets/js/main.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-80669434-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-80669434-1'); </script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1><a href="/" title="个人博客"><span class="octicon octicon-mark-github"></span> 个人博客</a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="/" class=" site-header-nav-item" target="" title="首页">首页</a> <a href="/categories/" class=" site-header-nav-item" target="" title="分类">分类</a> <a href="/wiki/" class=" site-header-nav-item" target="" title="维基">维基</a> <a href="/about/" class=" site-header-nav-item" target="" title="关于">关于</a></nav></div></header><section class="collection-head small geopattern" data-pattern-id="form-data传输"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">form-data传输</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2024/12/04 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="/categories/#Java" title="Java">Java</a> </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="/categories/#http" title="http">http</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 3894 字，约 12 分钟 </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths" ><article class="article-content markdown-body"><h1 id="引言">引言</h1><p><code class="language-plaintext highlighter-rouge">http</code>-<code class="language-plaintext highlighter-rouge">form-data</code>，传输方式的一些说明。</p><h1 id="http">http</h1><h2 id="form-data">form-data</h2><h3 id="基本概念"><strong>基本概念</strong></h3><p><code class="language-plaintext highlighter-rouge">form-data</code> 是一种用于通过 HTTP POST 请求传输数据的编码方式，通常用于上传文件和发送表单数据。它允许将数据按字段进行分组，每个字段可以包含文本或二进制数据（如文件）。这种编码方式将表单数据按键值对形式进行传输，每个字段与其他字段之间通过边界分隔。</p><ul><li><strong>表单数据（Form Data）</strong>：即在 HTML 表单中通过 <code class="language-plaintext highlighter-rouge">&lt;input&gt;</code> 标签和其他表单元素传递的数据。</li><li><strong><code class="language-plaintext highlighter-rouge">multipart/form-data</code></strong>：指定数据采用多部分表单数据格式，每部分可以是文本字段，也可以是文件。</li></ul><p><strong><code class="language-plaintext highlighter-rouge">form-data</code> 传输的组成</strong></p><ul><li><strong>Content-Type</strong>: <code class="language-plaintext highlighter-rouge">multipart/form-data</code> 这意味着请求的数据是多部分的，通常用于文件上传。</li><li><strong>边界（boundary）</strong>: 这是一种分隔符，用于标识不同的字段和数据部分。<code class="language-plaintext highlighter-rouge">boundary</code> 是一个字符串，通常由服务器自动生成。</li></ul><p><strong><code class="language-plaintext highlighter-rouge">form-data</code> 示例</strong></p><p><strong>表单数据传输</strong></p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/upload"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"file"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">value=</span><span class="s">"user1"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Upload"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div><p>当表单提交时，浏览器会自动将数据转化为 <code class="language-plaintext highlighter-rouge">multipart/form-data</code> 格式并发送。</p><p><strong>Request Headers</strong></p><p>请求的头部包含如下信息：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /upload HTTP/1.1
Host: example.com
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Length: 1234
</code></pre></div></div><p><strong>Request Body (Body Body)</strong></p><p>表单数据的主体部分会如下所示进行编码：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="username"

user1
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="example.txt"
Content-Type: text/plain

&lt;文件内容&gt;
------WebKitFormBoundary7MA4YWxkTrZu0gW--
</code></pre></div></div><p>这里每一部分的数据使用边界字符串 <code class="language-plaintext highlighter-rouge">------WebKitFormBoundary7MA4YWxkTrZu0gW</code> 分隔，文件和文本字段都可以在同一个请求体内传输。</p><h3 id="限制">限制</h3><p><code class="language-plaintext highlighter-rouge">multipart/form-data</code> 是一种用于通过 HTTP POST 请求上传文件和提交表单数据的编码方式。尽管它广泛用于文件上传和表单数据提交，但在某些情况下会遇到大小和数据类型的限制。</p><p><strong>大小限制</strong> <code class="language-plaintext highlighter-rouge">multipart/form-data</code> 请求的最大传输大小通常受以下因素的限制：</p><p><strong>服务器配置</strong> <strong>Spring Boot (Tomcat 默认)</strong>: Spring Boot 使用的嵌入式 Tomcat 服务器有默认的文件上传大小限制。通常是 2MB。</p><p>可以在 <code class="language-plaintext highlighter-rouge">application.properties</code> 或 <code class="language-plaintext highlighter-rouge">application.yml</code> 中修改该配置：</p><div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.servlet.multipart.max-file-size</span><span class="p">=</span><span class="s">10MB   # 限制单个文件的大小</span>
<span class="py">spring.servlet.multipart.max-request-size</span><span class="p">=</span><span class="s">20MB # 限制整个请求的大小</span>
</code></pre></div></div><p>对于 <code class="language-plaintext highlighter-rouge">application.yml</code>，配置如下：</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">spring</span><span class="pi">:</span>
<span class="na">servlet</span><span class="pi">:</span>
  <span class="na">multipart</span><span class="pi">:</span>
    <span class="na">max-file-size</span><span class="pi">:</span> <span class="s">10MB</span>
    <span class="na">max-request-size</span><span class="pi">:</span> <span class="s">20MB</span>
</code></pre></div></div><p><strong>NGINX / 反向代理配置</strong> 如果你的应用通过 NGINX 作为反向代理访问，还需要配置 NGINX 的文件上传大小限制。默认情况下，NGINX 可能限制最大上传文件大小为 1MB。</p><div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">client_max_body_size</span> <span class="mi">20M</span><span class="p">;</span>  <span class="c1"># 设置最大请求体大小为 20MB</span>
</code></pre></div></div><p><strong>Web服务器和应用服务器的其他限制</strong></p><ul><li><strong>Apache</strong>、<strong>Tomcat</strong>、<strong>Jetty</strong> 等服务器也有类似的上传大小限制，通常可以通过相应的配置文件调整：<ul><li>Tomcat 中 <code class="language-plaintext highlighter-rouge">server.xml</code> 中的 <code class="language-plaintext highlighter-rouge">maxPostSize</code> 设置。</li><li>Apache 中的 <code class="language-plaintext highlighter-rouge">LimitRequestBody</code> 设置。</li></ul></li></ul><p><strong>数据类型限制</strong> <code class="language-plaintext highlighter-rouge">multipart/form-data</code> 本身不限制数据类型，理论上可以传递任何类型的数据（包括文本、数字、二进制数据、文件等）。不过，某些数据类型可能会遇到处理上的限制。</p><p><strong>文本数据</strong></p><ul><li>表单字段通常以 <code class="language-plaintext highlighter-rouge">key-value</code> 形式传输（如：<code class="language-plaintext highlighter-rouge">key=value</code>）。Spring 和其他框架会自动解析表单中的文本数据。</li><li>对于长文本数据，<code class="language-plaintext highlighter-rouge">multipart/form-data</code> 没有特别的限制，只要不超过请求大小的限制即可。</li></ul><p><strong>文件数据</strong></p><ul><li>文件内容通过 <code class="language-plaintext highlighter-rouge">Content-Type</code> 和 <code class="language-plaintext highlighter-rouge">Content-Disposition</code> 头传输，每个文件都会有文件名、类型、大小等元数据。</li><li><strong>文件大小</strong>：如前所述，上传的文件大小会受到服务器配置的限制。</li><li><strong>文件类型</strong>：文件的 <code class="language-plaintext highlighter-rouge">Content-Type</code>（MIME 类型）由浏览器自动生成，也可以在前端指定。例如，<code class="language-plaintext highlighter-rouge">image/jpeg</code>、<code class="language-plaintext highlighter-rouge">application/pdf</code>、<code class="language-plaintext highlighter-rouge">text/plain</code> 等。</li></ul><p><strong>大文件传输</strong></p><ul><li>上传非常大的文件时，<code class="language-plaintext highlighter-rouge">multipart/form-data</code> 可能会出现性能问题，特别是当文件和其他表单字段一起上传时，处理可能会比较慢。</li><li>大文件上传时，可以考虑使用分块上传（比如 HTML5 的 <code class="language-plaintext highlighter-rouge">FileReader</code> API 和服务器端的分块处理）。</li></ul><p><strong>编码和字符集限制</strong></p><ul><li><code class="language-plaintext highlighter-rouge">multipart/form-data</code> 默认使用 <strong><code class="language-plaintext highlighter-rouge">ISO-8859-1</code></strong> 编码方式，可能会在处理非拉丁字符集（如中文、阿拉伯文等）时遇到问题。为了正确处理字符集，可以在 <code class="language-plaintext highlighter-rouge">Content-Type</code> 中显式指定字符集：</li></ul><div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">Content-Type: multipart/form-data; charset=UTF-8; boundary=---boundary-string
</span></code></pre></div></div><ul><li>然而，<code class="language-plaintext highlighter-rouge">multipart/form-data</code> 本身并没有强制要求字符集设置为 <code class="language-plaintext highlighter-rouge">UTF-8</code>。对于表单文本字段的内容，推荐使用 UTF-8 编码来避免字符集不兼容问题。</li></ul><p><strong>特殊字符问题</strong> 在上传包含特殊字符（如 <code class="language-plaintext highlighter-rouge">&amp;</code>, <code class="language-plaintext highlighter-rouge">=</code>, <code class="language-plaintext highlighter-rouge">%</code>, <code class="language-plaintext highlighter-rouge">#</code> 等）或文件名中包含空格、中文字符时，需要进行 URL 编码或 Base64 编码，否则可能会导致请求失败。</p><p><strong>浏览器和客户端限制</strong> 不同浏览器或客户端对 <code class="language-plaintext highlighter-rouge">multipart/form-data</code> 可能有不同的支持和限制：</p><ul><li>文件大小限制：浏览器通常会限制每个文件的最大上传大小。浏览器可能会阻止超过某个大小的文件上传。</li><li>单个请求中的字段数：虽然没有硬性规定，但多数浏览器和服务器对单个请求中的字段数量有限制。</li></ul><h3 id="数组类型处理">数组类型处理</h3><p><code class="language-plaintext highlighter-rouge">multipart/form-data</code> 本身并不直接支持数组或列表类型，但可以通过特定方式传递数组或列表数据。实际上，可以通过以下两种常见方法来模拟数组或列表的传递：</p><p><strong>通过多个同名字段传递数组数据</strong></p><p>在 <code class="language-plaintext highlighter-rouge">multipart/form-data</code> 请求中，可以通过使用多个具有<strong>相同名字</strong>的字段来传递数组数据。Spring 会自动将这些字段映射到 <code class="language-plaintext highlighter-rouge">String[]</code> 或 <code class="language-plaintext highlighter-rouge">List&lt;String&gt;</code> 等集合类型。</p><p>在这种方式下，Spring 会自动将每个 <code class="language-plaintext highlighter-rouge">uniqueKey</code> 字段（如 <code class="language-plaintext highlighter-rouge">uniqueKey=key1&amp;uniqueKey=key2&amp;uniqueKey=key3</code>）解析为 <code class="language-plaintext highlighter-rouge">String[]</code> 类型，即 <code class="language-plaintext highlighter-rouge">["key1", "key2", "key3"]</code>。</p><p><strong>通过逗号分隔的字符串传递数组</strong></p><p>如果你希望将列表作为一个单独的字段传递，可以使用逗号分隔的字符串，并在后端将其转换为 <code class="language-plaintext highlighter-rouge">List</code> 或 <code class="language-plaintext highlighter-rouge">String[]</code>。</p><p>在这种方式下，<code class="language-plaintext highlighter-rouge">uniqueKey</code> 参数会作为一个字符串传递，包含逗号分隔的元素。你可以在后端使用 <code class="language-plaintext highlighter-rouge">split(",")</code> 方法将其转换为 <code class="language-plaintext highlighter-rouge">List&lt;String&gt;</code> 或 <code class="language-plaintext highlighter-rouge">String[]</code>。</p><p><strong>使用 JSON 格式传递数组</strong></p><p>另一种方法是通过 JSON 格式传递数组。为了实现这一点，你可以将整个数组或复杂的对象封装为 JSON 字符串，并在后端将其解析为 Java 对象。这种方法通常用于传递更复杂的数据结构。</p><p>在这种方法中，前端需要传递一个合法的 JSON 字符串，后端使用 <code class="language-plaintext highlighter-rouge">ObjectMapper</code> 来解析它为 <code class="language-plaintext highlighter-rouge">List&lt;String&gt;</code>。</p><p><strong>总结</strong></p><p>虽然 <code class="language-plaintext highlighter-rouge">multipart/form-data</code> 不直接支持数组类型，但可以通过以下方式来传递数组数据：</p><ol><li><p><strong>多个同名字段</strong>：通过在请求中传递多个具有相同名称的字段（例如，<code class="language-plaintext highlighter-rouge">uniqueKey=key1&amp;uniqueKey=key2&amp;uniqueKey=key3</code>）来模拟数组，Spring 会自动将其映射为 <code class="language-plaintext highlighter-rouge">String[]</code> 或 <code class="language-plaintext highlighter-rouge">List&lt;String&gt;</code>。</p></li><li><p><strong>逗号分隔的字符串</strong>：通过传递一个逗号分隔的字符串（例如，<code class="language-plaintext highlighter-rouge">uniqueKey=key1,key2,key3</code>），在后端将其拆分为数组或列表。</p></li><li><p><strong>JSON 格式</strong>：通过将数组封装为 JSON 字符串传递，并在后端解析为数组或列表（例如，<code class="language-plaintext highlighter-rouge">uniqueKey=["key1","key2","key3"]</code>）。</p></li></ol><div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"><h3>文档信息</h3><ul><li>本文作者：<a href="" target="_blank">acteds</a></li><li>本文链接：<a href="/2024/12/04/form-data%E4%BC%A0%E8%BE%93/" target="_blank">https://acteds.github.io/2024/12/04/form-data%E4%BC%A0%E8%BE%93/</a></li><li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li></ul></div></article><div class="share"></div><div class="comment"> <script src="https://beaudar.lipk.org/client.js" repo="mzlogin/blog-comments" issue-term="title" label="gitment" theme="github-light" comment-order="desc" input-position="top" crossorigin="anonymous" async> </script></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"></div><ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul><script src="/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: '/assets/search_data.json?v=1742480571', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 10, fuzzy: false, exclude: ['Welcome'] }) </script><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="/assets/js/jquery.toc.js"></script></div></div></section><footer class="container"><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2024 <span title="acteds">acteds</span> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo(0,0)" >TOP</a></li></ul><a href="https://github.com/acteds/acteds.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="/" title="首页" target="">首页</a></li><li> <a href="/categories/" title="分类" target="">分类</a></li><li> <a href="/wiki/" title="维基" target="">维基</a></li><li> <a href="/about/" title="关于" target="">关于</a></li><li><a href="/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a></div><script src="/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script></body></html>
