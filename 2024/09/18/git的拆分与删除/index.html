<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>Git的拆分与删除 &mdash; 个人博客</title><link rel="stylesheet" href="/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="/assets/css/components/collection.css"><link rel="stylesheet" href="/assets/css/components/repo-card.css"><link rel="stylesheet" href="/assets/css/sections/repo-list.css"><link rel="stylesheet" href="/assets/css/components/boxed-group.css"><link rel="stylesheet" href="/assets/css/globals/common.css"><link rel="stylesheet" href="/assets/css/globals/responsive.css"><link rel="stylesheet" href="/assets/css/posts/index.css"><link rel="stylesheet" href="/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="/assets/css/highlight/monokai.sublime.css"><link rel="canonical" href="/2024/09/18/git%E7%9A%84%E6%8B%86%E5%88%86%E4%B8%8E%E5%88%A0%E9%99%A4/"><link rel="alternate" type="application/atom+xml" title="个人博客" href="/feed.xml"><link rel="shortcut icon" href="/favicon.ico"><meta property="og:title" content="Git的拆分与删除"><meta name="keywords" content="Git"><meta name="og:keywords" content="Git"><meta name="description" content="引言拆分仓库可以减少单个仓库的体积，提高开发效率。Git 仓库的历史记录会随着项目的发展而膨胀。拆分仓库有助于删除不必要的历史记录，只保留当前需要的部分，减少仓库的冗余数据。对于删除来说也是如此，在全部的提交中删除不需要的文件或文件夹可以减少仓库的体积。"><meta name="og:description" content="引言拆分仓库可以减少单个仓库的体积，提高开发效率。Git 仓库的历史记录会随着项目的发展而膨胀。拆分仓库有助于删除不必要的历史记录，只保留当前需要的部分，减少仓库的冗余数据。对于删除来说也是如此，在全部的提交中删除不需要的文件或文件夹可以减少仓库的体积。"><meta property="og:url" content="/2024/09/18/git%E7%9A%84%E6%8B%86%E5%88%86%E4%B8%8E%E5%88%A0%E9%99%A4/"><meta property="og:site_name" content="个人博客"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2024-09-18"> <script src="/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="/assets/js/jquery-ui.js"></script> <script src="/assets/js/main.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-80669434-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-80669434-1'); </script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1><a href="/" title="个人博客"><span class="octicon octicon-mark-github"></span> 个人博客</a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="/" class=" site-header-nav-item" target="" title="首页">首页</a> <a href="/categories/" class=" site-header-nav-item" target="" title="分类">分类</a> <a href="/wiki/" class=" site-header-nav-item" target="" title="维基">维基</a> <a href="/about/" class=" site-header-nav-item" target="" title="关于">关于</a></nav></div></header><section class="collection-head small geopattern" data-pattern-id="Git的拆分与删除"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">Git的拆分与删除</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2024/09/18 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="/categories/#Git" title="Git">Git</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 2568 字，约 8 分钟 </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths" ><article class="article-content markdown-body"><h1 id="引言">引言</h1><p>拆分仓库可以减少单个仓库的体积，提高开发效率。Git 仓库的历史记录会随着项目的发展而膨胀。拆分仓库有助于删除不必要的历史记录，只保留当前需要的部分，减少仓库的冗余数据。对于删除来说也是如此，在全部的提交中删除不需要的文件或文件夹可以减少仓库的体积。</p><h1 id="git">Git</h1><h2 id="拆分">拆分</h2><p>要将某个文件夹或文件单独生成一个 Git 仓库，并保留其历史记录，可以使用 <code class="language-plaintext highlighter-rouge">git filter-repo</code> 简单的完成。</p><p>要安装<code class="language-plaintext highlighter-rouge">git-fiter-repo</code>，对于环境有如下依赖：</p><ul><li>git &gt;= 2.22.0 ；对于某些功能需要 git &gt;= 2.24.0</li><li>python3 &gt;= 3.6</li></ul><p>然后运行<code class="language-plaintext highlighter-rouge">pip install git-filter-repo</code> 即可，要验证是否安装成功，可以执行：<code class="language-plaintext highlighter-rouge">git filter-repo --version</code>。</p><hr /><p>首先，克隆或者复制包含该文件/文件夹的原始仓库，然后使用 <code class="language-plaintext highlighter-rouge">git filter-repo</code> 命令，就可以提取目标文件夹或文件，并移除其他无关内容了。</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git filter-repo <span class="nt">--path</span> <span class="o">[</span>&lt;folder-name&gt;|&lt;file-name&gt;]
</code></pre></div></div><p>参数解释：</p><ul><li><code class="language-plaintext highlighter-rouge">--path &lt;folder-name&gt;</code> 或 <code class="language-plaintext highlighter-rouge">--path &lt;file-name&gt;</code>：这个参数指定你要保留的路径。这个命令将只保留该路径中的文件，删除仓库中的其他所有内容。</li></ul><p>例如，要提取名为 <code class="language-plaintext highlighter-rouge">src</code> 的文件夹，可以运行：<code class="language-plaintext highlighter-rouge">git filter-repo --path src</code>如果提取单个文件，比如 <code class="language-plaintext highlighter-rouge">README.md</code>：<code class="language-plaintext highlighter-rouge">git filter-repo --path README.md</code></p><p>执行 <code class="language-plaintext highlighter-rouge">git filter-repo --path README.md</code> 后，Git 仓库将会只保留 <code class="language-plaintext highlighter-rouge">README.md</code> 文件及其所有历史记录，其他的文件和文件夹（及其对应的提交历史）将会被<strong>完全移除</strong>，包括：</p><p><strong>历史记录过滤</strong>：Git 会过滤所有提交记录，只保留那些与 <code class="language-plaintext highlighter-rouge">README.md</code> 文件相关的提交。任何与其他文件或文件夹相关的提交都会被删除。</p><p><strong>仓库内容变化</strong>：</p><ul><li><strong>保留的文件</strong>：最终的仓库中只会包含 <code class="language-plaintext highlighter-rouge">README.md</code> 文件，且这个文件的所有历史记录都会保留在提交历史中。</li><li><strong>移除的文件和文件夹</strong>：所有其他文件和文件夹会从仓库的所有历史版本中完全消失，不再存在于提交记录中。</li></ul><p><strong>提交历史</strong>：</p><ul><li>仓库中的提交历史会被重新写入，只有那些影响 <code class="language-plaintext highlighter-rouge">README.md</code> 文件的提交会保留，其他提交记录（与其他文件相关的提交）将被丢弃。</li></ul><p><strong>其他分支和标签</strong>：</p><ul><li>这些过滤操作会影响所有的分支和标签。它会对整个仓库的历史进行重写。因此，在其他分支和标签中，只有 <code class="language-plaintext highlighter-rouge">README.md</code> 及其相关的提交会保留。</li></ul><p>假设有如下仓库结构：</p><pre><code class="language-ascii">repo/
├── README.md
├── src/
│   └── main.java
└── docs/
    └── guide.md
</code></pre><p>并且有以下提交历史：</p><ol><li>创建 <code class="language-plaintext highlighter-rouge">README.md</code></li><li>添加 <code class="language-plaintext highlighter-rouge">src/main.java</code></li><li>修改 <code class="language-plaintext highlighter-rouge">README.md</code></li><li>添加 <code class="language-plaintext highlighter-rouge">docs/guide.md</code></li></ol><p>当执行 <code class="language-plaintext highlighter-rouge">git filter-repo --path README.md</code> 后：</p><ul><li>仓库中<strong>只会保留</strong> <code class="language-plaintext highlighter-rouge">README.md</code> 文件。</li><li>提交历史中<strong>只保留</strong>涉及 <code class="language-plaintext highlighter-rouge">README.md</code> 的提交（即提交 1 和 3），其他提交（例如 2 和 4）会被删除。</li><li><code class="language-plaintext highlighter-rouge">src/</code> 和 <code class="language-plaintext highlighter-rouge">docs/</code> 文件夹及其内容（如 <code class="language-plaintext highlighter-rouge">main.java</code> 和 <code class="language-plaintext highlighter-rouge">guide.md</code>）将从仓库的所有历史版本中被<strong>完全移除</strong>，就像它们从未存在过一样。</li></ul><hr /><p><strong>保留多个文件或文件夹</strong></p><p>在使用 <code class="language-plaintext highlighter-rouge">git filter-repo</code> 时，如果想保留多个文件或文件夹的历史记录，可以通过 <code class="language-plaintext highlighter-rouge">--path</code> 参数指定多个路径。<code class="language-plaintext highlighter-rouge">git filter-repo</code> 支持同时保留多个文件或文件夹的历史。</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git filter-repo <span class="nt">--path</span> &lt;path1&gt; <span class="nt">--path</span> &lt;path2&gt; <span class="nt">--path</span> &lt;path3&gt; ...
</code></pre></div></div><p>假设仓库结构如下：</p><pre><code class="language-ascii">repo/
├── README.md
├── src/
│   ├── main.java
│   └── utils.java
└── docs/
    └── guide.md
</code></pre><p>需要保留以下文件和文件夹：</p><ul><li><code class="language-plaintext highlighter-rouge">README.md</code></li><li><code class="language-plaintext highlighter-rouge">src/</code> 文件夹</li><li><code class="language-plaintext highlighter-rouge">docs/guide.md</code></li></ul><p>可以执行以下命令：</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git filter-repo <span class="nt">--path</span> README.md <span class="nt">--path</span> src <span class="nt">--path</span> docs/guide.md
</code></pre></div></div><p>保留子文件夹：</p><p>也可以只保留某个子文件夹内的部分内容，例如只保留 <code class="language-plaintext highlighter-rouge">src/utils.java</code> 而不是整个 <code class="language-plaintext highlighter-rouge">src</code> 文件夹。命令如下：</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git filter-repo <span class="nt">--path</span> src/utils.java
</code></pre></div></div><p>注意事项：</p><ul><li><p>如果要保留的文件路径很多，建议提前备份仓库，因为 <code class="language-plaintext highlighter-rouge">git filter-repo</code> 会直接修改历史记录。</p></li><li><p><code class="language-plaintext highlighter-rouge">git filter-repo</code> 操作会影响所有分支和标签，所以操作之前需要明确想要保留的内容。</p></li></ul><h2 id="删除">删除</h2><p>要在全部的提交中删除某个文件或者文件夹，可以使用如下命令：</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git filter-repo <span class="nt">--path</span> <span class="o">[</span>&lt;folder-name&gt;|&lt;file-name&gt;] <span class="nt">--invert-paths</span> <span class="nt">--force</span>
</code></pre></div></div><p>参数解释：</p><ul><li><code class="language-plaintext highlighter-rouge">--path &lt;folder-name&gt; | &lt;file-name&gt;</code>：指定要操作的文件夹或文件路径。如果是文件夹，请使用 <code class="language-plaintext highlighter-rouge">/</code> 结尾，如 <code class="language-plaintext highlighter-rouge">logs/</code>。如果是文件，提供完整路径如 <code class="language-plaintext highlighter-rouge">config/secret.txt</code>。</li><li><code class="language-plaintext highlighter-rouge">--invert-paths</code>：该参数表示反转路径过滤，意思是删除指定的路径及其历史，而保留其他所有内容。没有 <code class="language-plaintext highlighter-rouge">--invert-paths</code> 则会保留指定的路径并删除其他内容。</li><li><code class="language-plaintext highlighter-rouge">--force</code>：在某些情况下，如果运行 <code class="language-plaintext highlighter-rouge">git filter-repo</code> 后尝试再次运行时，Git 可能会警告已经处理过一次了。<code class="language-plaintext highlighter-rouge">--force</code> 选项允许你在这些情况下强制执行命令。</li></ul><p>这会<strong>永久性地修改历史记录</strong>，所有历史中的该文件或文件夹将被彻底移除，因此其他开发人员也需要强制更新他们的本地仓库。</p><hr /><p>如果已经把仓库推送到远程，删除了本地的文件历史后，必须强制推送历史变更：</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git push origin <span class="nt">--force</span> <span class="nt">--all</span>
git push origin <span class="nt">--force</span> <span class="nt">--tags</span>
</code></pre></div></div><p>如果需要清理已经被删除的文件的本地缓存，可以运行以下命令：</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">rm</span> <span class="nt">-rf</span> .git/refs/original/
git reflog expire <span class="nt">--expire</span><span class="o">=</span>now <span class="nt">--all</span>
git gc <span class="nt">--prune</span><span class="o">=</span>now <span class="nt">--aggressive</span>
</code></pre></div></div><div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"><h3>文档信息</h3><ul><li>本文作者：<a href="" target="_blank">acteds</a></li><li>本文链接：<a href="/2024/09/18/git%E7%9A%84%E6%8B%86%E5%88%86%E4%B8%8E%E5%88%A0%E9%99%A4/" target="_blank">https://acteds.github.io/2024/09/18/git%E7%9A%84%E6%8B%86%E5%88%86%E4%B8%8E%E5%88%A0%E9%99%A4/</a></li><li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li></ul></div></article><div class="share"></div><div class="comment"> <script src="https://beaudar.lipk.org/client.js" repo="mzlogin/blog-comments" issue-term="title" label="gitment" theme="github-light" comment-order="desc" input-position="top" crossorigin="anonymous" async> </script></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"></div><ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul><script src="/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: '/assets/search_data.json?v=1729777390', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 10, fuzzy: false, exclude: ['Welcome'] }) </script><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="/assets/js/jquery.toc.js"></script></div></div></section><footer class="container"><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2024 <span title="acteds">acteds</span> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo(0,0)" >TOP</a></li></ul><a href="https://github.com/acteds/acteds.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="/" title="首页" target="">首页</a></li><li> <a href="/categories/" title="分类" target="">分类</a></li><li> <a href="/wiki/" title="维基" target="">维基</a></li><li> <a href="/about/" title="关于" target="">关于</a></li><li><a href="/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a></div><script src="/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script></body></html>
