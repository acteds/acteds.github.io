<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>多个Git托管平台的配置 &mdash; 个人博客</title><link rel="stylesheet" href="/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="/assets/css/components/collection.css"><link rel="stylesheet" href="/assets/css/components/repo-card.css"><link rel="stylesheet" href="/assets/css/sections/repo-list.css"><link rel="stylesheet" href="/assets/css/components/boxed-group.css"><link rel="stylesheet" href="/assets/css/globals/common.css"><link rel="stylesheet" href="/assets/css/globals/responsive.css"><link rel="stylesheet" href="/assets/css/posts/index.css"><link rel="stylesheet" href="/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="/assets/css/highlight/monokai.sublime.css"><link rel="canonical" href="/2024/09/19/%E5%A4%9A%E4%B8%AAGit%E6%89%98%E7%AE%A1%E5%B9%B3%E5%8F%B0%E7%9A%84%E9%85%8D%E7%BD%AE/"><link rel="alternate" type="application/atom+xml" title="个人博客" href="/feed.xml"><link rel="shortcut icon" href="/favicon.ico"><meta property="og:title" content="多个Git托管平台的配置"><meta name="keywords" content="Git, GitLab, GitHub"><meta name="og:keywords" content="Git, GitLab, GitHub"><meta name="description" content="引言"><meta name="og:description" content="引言"><meta property="og:url" content="/2024/09/19/%E5%A4%9A%E4%B8%AAGit%E6%89%98%E7%AE%A1%E5%B9%B3%E5%8F%B0%E7%9A%84%E9%85%8D%E7%BD%AE/"><meta property="og:site_name" content="个人博客"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2024-09-19"> <script src="/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="/assets/js/jquery-ui.js"></script> <script src="/assets/js/main.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-80669434-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-80669434-1'); </script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1><a href="/" title="个人博客"><span class="octicon octicon-mark-github"></span> 个人博客</a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="/" class=" site-header-nav-item" target="" title="首页">首页</a> <a href="/categories/" class=" site-header-nav-item" target="" title="分类">分类</a> <a href="/wiki/" class=" site-header-nav-item" target="" title="维基">维基</a> <a href="/about/" class=" site-header-nav-item" target="" title="关于">关于</a></nav></div></header><section class="collection-head small geopattern" data-pattern-id="多个Git托管平台的配置"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">多个Git托管平台的配置</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2024/09/19 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="/categories/#Git" title="Git">Git</a> </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="/categories/#GitLab" title="GitLab">GitLab</a> </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="/categories/#GitHub" title="GitHub">GitHub</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 3485 字，约 10 分钟 </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths" ><article class="article-content markdown-body"><h1 id="引言">引言</h1><p>作为一个程序员，在工作中，可能需要将代码推送到公司的自建 Git 代码托管平台上（如 GitLab）。在生活中，当参与一些个人的开源项目，则又需要将代码推送到社区的 Git 代码托管平台上（如 Github 或 Gieet）。</p><h1 id="git">Git</h1><h2 id="多个git托管平台的配置">多个Git托管平台的配置</h2><p>最简单的解决方法就是，多个Git代码托管平台配置同一个SSH公钥。</p><p>第二种方法就是使用多组密钥指定给不同的平台：</p><p>SSH 允许统一个操作系统中存在多对密钥，因此可以使用 <code class="language-plaintext highlighter-rouge">ssh-keygen</code> 指令生成多组密钥，将不同的密钥分配给不通的 Git 代码托管平台。</p><p>通过平台要求的密钥加密算法生成SSH密钥后，可以通过：</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh-add id_rsa_github
</code></pre></div></div><p>这里的<code class="language-plaintext highlighter-rouge">id_rsa_github</code>是SSH密钥的名称。</p><p>如果不使用 <code class="language-plaintext highlighter-rouge">ssh-add</code> 指令添加新的密钥到 <code class="language-plaintext highlighter-rouge">ssh agent</code> 中，系统会仍然使用 <code class="language-plaintext highlighter-rouge">id_rsa</code> 作为默认的 SSH Key，因为 <code class="language-plaintext highlighter-rouge">id_rsa</code> 是被默认添加到 <code class="language-plaintext highlighter-rouge">ssh agent</code> 中。</p><h3 id="为远程服务器配置密钥">为远程服务器配置密钥</h3><p><code class="language-plaintext highlighter-rouge">~/.ssh</code> 目录下存在一个 <code class="language-plaintext highlighter-rouge">config</code> 文件，如果不存在可以使用 <code class="language-plaintext highlighter-rouge">touch config</code> 指令这个文件。</p><p>这个文件用于配置 SSH 客户端的信息，例如主机名、端口号、用户名、密钥等，对于 Git 代码托管平台来说，可以通过这个配置为不通的 Git 代码托管平台服务器配置不同的 SSH 密钥。创建 config 文件后，使用 vim 或者其他任意编辑器编辑 config 文件，输入以下内容：</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Host github
    User git
    Hostname github.com
    PreferredAuthentications publickey
    IdentityFile ~/.ssh/id_rsa_github

Host company-git
    User git
    # 替换为你公司的 Git 代码托管平台的服务器
    Hostname company-git-repo.com
    # 你公司 SSH 服务的端口号
    Port 22
    PreferredAuthentications publickey
    IdentityFile ~/.ssh/id_rsa_company
</code></pre></div></div><p>config 配置文件中的各项配置意思为：</p><ul><li><code class="language-plaintext highlighter-rouge">Host</code>：指定连接到的主机名，可以随意指定，相当于实际连接目标主机的<strong>别名</strong>；</li><li><code class="language-plaintext highlighter-rouge">User</code>：指定使用的用户名，通常为 <code class="language-plaintext highlighter-rouge">git</code>，也可以不指定；</li><li><code class="language-plaintext highlighter-rouge">Hostname</code>：指定连接到的主机的实际域名或IP地址。如果是向 Github 推送代码，则为 <code class="language-plaintext highlighter-rouge">github.com</code>，如果是向公司的 Git 代码托管平台推送代码，则填写公司主机的地址</li><li><code class="language-plaintext highlighter-rouge">Port</code>：SSH 服务的端口号，默认为 <code class="language-plaintext highlighter-rouge">22</code>，可以不写</li><li><code class="language-plaintext highlighter-rouge">PreferredAuthentications</code>：指定优先使用的身份验证方法，指定为<code class="language-plaintext highlighter-rouge">publickey</code>，即使用公钥进行身份认证。</li><li><code class="language-plaintext highlighter-rouge">IdentityFile</code>：指定要使用的私钥文件路径，即指向你创建的私钥，这里分别为不通的 Git 代码托管平台指定了不同的私钥</li></ul><p>然后将<strong>公钥</strong>在对应的平台上添加SSH。</p><p>如果出现：<code class="language-plaintext highlighter-rouge">fatal: Could not read from remote repository. Please make sure you have the correct access rights and the repository exists.</code></p><p>就需要更改<code class="language-plaintext highlighter-rouge">.ssh</code>文件夹的权限，使其只对文件所有者可读写。（可以留下SYSTEM和Administrators用户组）</p><h3 id="配置不同的-git-用户名以及邮箱">配置不同的 git 用户名以及邮箱</h3><p>除了解决了不同平台使用不通的公私钥问题外，在不通的仓库提交代码时用的用户名和邮箱也可能需要不一样，比如：</p><ul><li>在 Github 上，需要用网名来隐藏我的真实身份，因此提交代码的用户名为 <code class="language-plaintext highlighter-rouge">github-user</code>，邮箱为 <code class="language-plaintext highlighter-rouge">github-user@github.com</code>；</li><li>而在工作中，公司则要求提交代码时的 git 用户名必须为我的真实姓名拼音，邮箱则为公司邮箱。</li></ul><p>这些配置就跟 SSH 的配置无关了，这些就需要调整我们的 git 配置。</p><p>首先，在全局配置一个 git 用户名和邮箱，这里建议使用你在 Github 上想要使用的用户名和邮箱，毕竟 Github 常驻，而公司不常驻：</p><pre><code class="language-cmd">git config --global user.email github-user@github.com[更改成你的邮箱]
git config --global user.name github-user[更改成你的网名]
</code></pre><p>此时，在 git 的配置文件 <code class="language-plaintext highlighter-rouge">~/.gitconfig</code> 中就可以看到如下的配置段，表示已经配置成功：</p><div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[user]</span>
    <span class="py">name</span> <span class="p">=</span> <span class="s">github-user</span>
    <span class="py">email</span> <span class="p">=</span> <span class="s">github-user@github.com</span>
</code></pre></div></div><p>当我们提交代码的时候就会使用这个默认的用户名和邮箱来提交代码了。</p><p>除此之外，git 也支持通过在 git 项目内添加一个『本地配置』来单独配置每个项目的用户名和密码。利用这个能力，当我们将公司的代码 clone 到本地之后，进入到代码仓库，<strong>首先要做的第一件事情就是为这个公司的代码仓库设置独立的 git 用户名和密码</strong>。</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git config <span class="nt">--local</span> user.name zhangsan[改为你的真实姓名]
git config <span class="nt">--local</span> user.name zhangsan@company.com[改为你公司的邮箱]
</code></pre></div></div><p>总结，在使用 Github 提交提交代码的时候，无需在项目内单独设置 git 用户名和邮箱，因为会自动使用我们全局设置好的；当在编写公司项目的时候，当代码拉下来之后要单独为这个项目设置一个用户名和邮箱。</p><h2 id="同时配置多个-github-账号">同时配置多个 Github 账号</h2><p>还是使用上节的方法生成多个SSH密钥，然后追加到SSH config文件中。</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code># github 主账号的配置
Host github
    User git
    Hostname github.com
    PreferredAuthentications publickey
    IdentityFile ~/.ssh/id_rsa_github
    
# github 新账号的配置
Host github_x
    User git
    Hostname github.com
    PreferredAuthentications publickey
    IdentityFile ~/.ssh/id_rsa_github_x
</code></pre></div></div><p>这个时候，你从小号的 Github 中 clone 下来一个仓库，假设地址为 <code class="language-plaintext highlighter-rouge">git@github.com:user_x/blog.git</code>，那么就在终端中输入：</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone git@github.com:user_x/blog.git
</code></pre></div></div><p>然后 commit 一些代码后，执行 push 操作时，就会发现出错啦：</p><pre><code class="language-subunit">ERROR: Permission to user_x/blog.git denied to xxx.
fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.
</code></pre><p>SSH 授权出问题了。</p><p>实际上，在使用 <code class="language-plaintext highlighter-rouge">git push</code> 提交代码的时候，由于代码的仓库源在 Github 上，因此 SSH 连接的主机就是 <code class="language-plaintext highlighter-rouge">github.com</code>，当 SSH 发起连接的时候，它会发现你的 SSH config 文件中配置了<strong>两段 <code class="language-plaintext highlighter-rouge">Hostname</code> 都为 <code class="language-plaintext highlighter-rouge">github.com</code> 的配置</strong>， SSH 会<strong>优先使用第一段</strong>配置中的公钥向 Github 建立身份认证连接。那么当身份认证请求到达 Github 的时候，Github 拿出公钥进行身份认证签名对比后发现不是小号，那么自然就会拒绝你的提交代码的请求。</p><p>首先可以解析一下<code class="language-plaintext highlighter-rouge">git@github.com:user_x/blog.git</code> 这一串的组成，<code class="language-plaintext highlighter-rouge">git</code>是建立SSH连接时使用的用户名，<code class="language-plaintext highlighter-rouge">github.com</code>是目标服务器，而<code class="language-plaintext highlighter-rouge">user_x/blog.git</code>是具体代码仓库的路径。</p><p>清楚了以上各个部分代表的意思后，可以利用 SSH 建立连接的一个特性：目标服务器可以直接写成为服务器地址，同时也可以写为在 SSH config 文件中配置的 <code class="language-plaintext highlighter-rouge">Host</code>，也就是服务器的别名。</p><p>因此可以将仓库的源改为 <code class="language-plaintext highlighter-rouge">git@github_x:user_x/blog.git</code> ：</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git remote set-url origin git@github_x:user_x/blog.git
</code></pre></div></div><p>此外别忘了必须使用 <code class="language-plaintext highlighter-rouge">ssh-add</code> 指令将生成的 SSH key 添加到 ssh-agent 的身份验证代理中：<code class="language-plaintext highlighter-rouge">ssh-add ~/.ssh/id_rsa_github_x</code>。否则建立 SSH 连接时，会使用 <code class="language-plaintext highlighter-rouge">id_rsa_github</code> 的密钥对。</p><p>可以通过<code class="language-plaintext highlighter-rouge">ssh -T git@github_x</code>，进行测试连接。</p><p>其实在clone的时候就可以修改为别名了，这样就不需要再重新设置仓库源了：</p><pre><code class="language-cmd">git clone git@github_x:user_x/blog.git
</code></pre><div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"><h3>文档信息</h3><ul><li>本文作者：<a href="" target="_blank">acteds</a></li><li>本文链接：<a href="/2024/09/19/%E5%A4%9A%E4%B8%AAGit%E6%89%98%E7%AE%A1%E5%B9%B3%E5%8F%B0%E7%9A%84%E9%85%8D%E7%BD%AE/" target="_blank">https://acteds.github.io/2024/09/19/%E5%A4%9A%E4%B8%AAGit%E6%89%98%E7%AE%A1%E5%B9%B3%E5%8F%B0%E7%9A%84%E9%85%8D%E7%BD%AE/</a></li><li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li></ul></div></article><div class="share"></div><div class="comment"> <script src="https://beaudar.lipk.org/client.js" repo="mzlogin/blog-comments" issue-term="title" label="gitment" theme="github-light" comment-order="desc" input-position="top" crossorigin="anonymous" async> </script></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"></div><ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul><script src="/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: '/assets/search_data.json?v=1738243735', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 10, fuzzy: false, exclude: ['Welcome'] }) </script><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="/assets/js/jquery.toc.js"></script></div></div></section><footer class="container"><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2024 <span title="acteds">acteds</span> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo(0,0)" >TOP</a></li></ul><a href="https://github.com/acteds/acteds.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="/" title="首页" target="">首页</a></li><li> <a href="/categories/" title="分类" target="">分类</a></li><li> <a href="/wiki/" title="维基" target="">维基</a></li><li> <a href="/about/" title="关于" target="">关于</a></li><li><a href="/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a></div><script src="/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script></body></html>
