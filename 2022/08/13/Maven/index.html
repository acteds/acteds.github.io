<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>Maven &mdash; 个人博客</title><link rel="stylesheet" href="/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="/assets/css/components/collection.css"><link rel="stylesheet" href="/assets/css/components/repo-card.css"><link rel="stylesheet" href="/assets/css/sections/repo-list.css"><link rel="stylesheet" href="/assets/css/components/boxed-group.css"><link rel="stylesheet" href="/assets/css/globals/common.css"><link rel="stylesheet" href="/assets/css/globals/responsive.css"><link rel="stylesheet" href="/assets/css/posts/index.css"><link rel="stylesheet" href="/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="/assets/css/highlight/monokai.sublime.css"><link rel="canonical" href="/2022/08/13/Maven/"><link rel="alternate" type="application/atom+xml" title="个人博客" href="/feed.xml"><link rel="shortcut icon" href="/favicon.ico"><meta property="og:title" content="Maven"><meta name="keywords" content="Java"><meta name="og:keywords" content="Java"><meta name="description" content="引言Maven的笔记，包括依赖管理、构建流程、插件、模块管理、发布。"><meta name="og:description" content="引言Maven的笔记，包括依赖管理、构建流程、插件、模块管理、发布。"><meta property="og:url" content="/2022/08/13/Maven/"><meta property="og:site_name" content="个人博客"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2022-08-13"> <script src="/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="/assets/js/jquery-ui.js"></script> <script src="/assets/js/main.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-80669434-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-80669434-1'); </script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1><a href="/" title="个人博客"><span class="octicon octicon-mark-github"></span> 个人博客</a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="/" class=" site-header-nav-item" target="" title="首页">首页</a> <a href="/categories/" class=" site-header-nav-item" target="" title="分类">分类</a> <a href="/wiki/" class=" site-header-nav-item" target="" title="维基">维基</a> <a href="/about/" class=" site-header-nav-item" target="" title="关于">关于</a></nav></div></header><section class="collection-head small geopattern" data-pattern-id="Maven"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">Maven</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2022/08/13 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="/categories/#Java" title="Java">Java</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 36529 字，约 105 分钟 </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths" ><article class="article-content markdown-body"><h1 id="引言">引言</h1><p>Maven的笔记，包括依赖管理、构建流程、插件、模块管理、发布。</p><h1 id="maven">Maven</h1><p>Java项目需要确定引入哪些依赖包。例如，如果需要用到<a href="https://commons.apache.org/proper/commons-logging/">commons logging</a>，就必须把commons logging的jar包放入classpath。如果还需要<a href="https://logging.apache.org/log4j/">log4j</a>，就需要把log4j相关的jar包都放到classpath中。这些就是依赖包的管理。</p><p>要确定项目的目录结构。例如，<code class="language-plaintext highlighter-rouge">src</code>目录存放Java源码，<code class="language-plaintext highlighter-rouge">resources</code>目录存放配置文件，<code class="language-plaintext highlighter-rouge">bin</code>目录存放编译生成的<code class="language-plaintext highlighter-rouge">.class</code>文件。</p><p>还需要配置环境，例如JDK的版本，编译打包的流程，当前代码的版本号。</p><p>最后，除了使用Eclipse这样的IDE进行编译外，还必须能通过命令行工具进行编译，才能够让项目在一个独立的服务器上编译、测试、部署。</p><p>这些工作难度不大，但是非常琐碎且耗时。如果每一个项目都自己搞一套配置，肯定会一团糟。我们需要的是一个标准化的Java项目管理和构建工具。</p><p>Maven就是是专门为Java项目打造的管理和构建工具，它的主要功能有：</p><ul><li>提供了一套标准化的项目结构；</li><li>提供了一套标准化的构建流程（编译，测试，打包，发布……）；</li><li>提供了一套依赖管理机制。</li></ul><p>要安装Maven，可以从<a href="https://maven.apache.org/">Maven官网</a>下载最新的Maven 3.9.6，然后在本地解压。还可以把Maven根目录添加到环境变量PATH。</p><h2 id="maven项目结构">Maven项目结构</h2><p>一个使用Maven管理的普通的Java项目，它的目录结构默认如下：</p><pre><code class="language-ascii">a-maven-project
├── pom.xml
├── src
│   ├── main
│   │   ├── java
│   │   └── resources
│   └── test
│       ├── java
│       └── resources
└── target
</code></pre><p>项目的根目录<code class="language-plaintext highlighter-rouge">a-maven-project</code>是项目名，它有一个项目描述文件<code class="language-plaintext highlighter-rouge">pom.xml</code>，存放Java源码的目录是<code class="language-plaintext highlighter-rouge">src/main/java</code>，存放资源文件的目录是<code class="language-plaintext highlighter-rouge">src/main/resources</code>，存放测试源码的目录是<code class="language-plaintext highlighter-rouge">src/test/java</code>，存放测试资源的目录是<code class="language-plaintext highlighter-rouge">src/test/resources</code>，最后，所有编译、打包生成的文件都放在<code class="language-plaintext highlighter-rouge">target</code>目录里。这些就是一个Maven项目的标准目录结构。</p><p>所有的目录结构都是约定好的标准结构<strong>，千万不要随意修改目录结构</strong>。使用标准结构不需要做任何配置，Maven就可以正常使用。</p><p>项目描述文件<code class="language-plaintext highlighter-rouge">pom.xml</code>，它的内容长得像下面：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
     <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
<span class="c">&lt;!-- 当前Maven工程的坐标 --&gt;</span>
<span class="nt">&lt;groupId&gt;</span>com.example<span class="nt">&lt;/groupId&gt;</span>
<span class="nt">&lt;artifactId&gt;</span>demo<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>

<span class="c">&lt;!-- 当前Maven工程的打包方式，可选值有下面三种： --&gt;</span>
<span class="c">&lt;!-- jar：表示这个工程是一个Java工程  --&gt;</span>
<span class="c">&lt;!-- war：表示这个工程是一个Web工程 --&gt;</span>
<span class="c">&lt;!-- pom：表示这个工程是“管理其他工程”的工程 --&gt;</span>
<span class="nt">&lt;packaging&gt;</span>jar<span class="nt">&lt;/packaging&gt;</span>

<span class="nt">&lt;name&gt;</span>demo<span class="nt">&lt;/name&gt;</span>
<span class="nt">&lt;url&gt;</span>https://maven.apache.org<span class="nt">&lt;/url&gt;</span>
<span class="c">&lt;!--packaging:pom时使用modules定义模块 --&gt;</span>
<span class="nt">&lt;modules&gt;</span>
        <span class="nt">&lt;module&gt;</span>demo-start<span class="nt">&lt;/module&gt;</span>
        <span class="nt">&lt;module&gt;</span>demo-web<span class="nt">&lt;/module&gt;</span>
        <span class="nt">&lt;module&gt;</span>demo-service<span class="nt">&lt;/module&gt;</span>
<span class="nt">&lt;/modules&gt;</span>

<span class="nt">&lt;properties&gt;</span>
    <span class="c">&lt;!-- 工程构建过程中读取源码时使用的字符集 --&gt;</span>
    <span class="nt">&lt;java.version&gt;</span>11<span class="nt">&lt;/java.version&gt;</span>
    <span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
    <span class="nt">&lt;project.reporting.outputEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.reporting.outputEncoding&gt;</span>
    <span class="nt">&lt;maven.compiler.source&gt;</span>11<span class="nt">&lt;/maven.compiler.source&gt;</span>
    <span class="nt">&lt;maven.compiler.target&gt;</span>11<span class="nt">&lt;/maven.compiler.target&gt;</span>
<span class="nt">&lt;/properties&gt;</span>

<span class="c">&lt;!-- 当前工程所依赖的jar包 --&gt;</span>
<span class="nt">&lt;dependencies&gt;</span>
    <span class="c">&lt;!-- 使用dependency配置一个具体的依赖 --&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="c">&lt;!-- 在dependency标签内使用具体的坐标依赖我们需要的一个jar包 --&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>4.12<span class="nt">&lt;/version&gt;</span>
        <span class="c">&lt;!-- scope标签配置依赖的范围 --&gt;</span>
        <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div><p>其中，<code class="language-plaintext highlighter-rouge">groupId</code>类似于Java的包名，通常是公司或组织名称，<code class="language-plaintext highlighter-rouge">artifactId</code>类似于Java的类名，通常是项目名称，再加上<code class="language-plaintext highlighter-rouge">version</code>，一个Maven工程就是由<code class="language-plaintext highlighter-rouge">groupId</code>，<code class="language-plaintext highlighter-rouge">artifactId</code>和<code class="language-plaintext highlighter-rouge">version</code>作为唯一标识。我们在引用其他第三方库的时候，也是通过这3个变量确定。例如，依赖<code class="language-plaintext highlighter-rouge">junit5</code>：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.junit.jupiter<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>junit-jupiter<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>5.10.2<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;scope&gt;</span>compile<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div><p>使用<code class="language-plaintext highlighter-rouge">&lt;dependency&gt;</code>声明一个依赖后，Maven就会自动下载这个依赖包并把它放到classpath中。</p><p><strong>唯一ID</strong></p><p>对于某个依赖，Maven只需要3个变量即可唯一确定某个jar包：</p><ul><li>groupId：属于组织的名称，类似Java的包名；</li><li>artifactId：该jar包自身的名称，类似Java的类名；</li><li>version：该jar包的版本。</li></ul><p>通过上述3个变量，即可唯一确定某个jar包。Maven通过对jar包进行PGP签名确保任何一个jar包一经发布就无法修改。修改已发布jar包的唯一方法是发布一个新版本。</p><p>因此，某个jar包一旦被Maven下载过，即可永久地安全缓存在本地。</p><p>注：只有以<code class="language-plaintext highlighter-rouge">-SNAPSHOT</code>结尾的版本号会被Maven视为开发版本，开发版本每次都会重复下载，这种SNAPSHOT版本只能用于内部私有的Maven repo，公开发布的版本不允许出现SNAPSHOT。</p><p>后续在表示Maven依赖时，使用简写形式groupId:artifactId:version，例如：org.slf4j:slf4j-api:2.0.4。</p><p><strong>搜索</strong></p><p>如果我们要引用一个第三方组件，比如<code class="language-plaintext highlighter-rouge">okhttp</code>，如何确切地获得它的<code class="language-plaintext highlighter-rouge">groupId</code>、<code class="language-plaintext highlighter-rouge">artifactId</code>和<code class="language-plaintext highlighter-rouge">version</code>？方法是通过<a href="https://search.maven.org/">search.maven.org</a>或<a href="https://mvnrepository.com/">mvnrepository.com</a>搜索关键字，找到对应的组件后，直接复制。</p><h2 id="依赖管理">依赖管理</h2><p>如果项目依赖第三方的jar包，例如commons logging的jar包在哪下载？如果还希望依赖log4j，那么使用log4j需要哪些jar包？</p><p>类似的依赖还包括：JUnit，JavaMail，MySQL驱动等等，一个可行的方法是通过搜索引擎搜索到项目的官网，然后手动下载zip包，解压，放入classpath。但是，这个过程非常繁琐。</p><p>Maven解决了依赖管理问题。例如，我们的项目依赖<code class="language-plaintext highlighter-rouge">abc</code>这个jar包，而<code class="language-plaintext highlighter-rouge">abc</code>又依赖<code class="language-plaintext highlighter-rouge">xyz</code>这个jar包：</p><pre><code class="language-ascii">┌──────────────┐
│Sample Project│
└──────────────┘
        │
        ▼
┌──────────────┐
│     abc      │
└──────────────┘
        │
        ▼
┌──────────────┐
│     xyz      │
└──────────────┘
</code></pre><p>当声明了<code class="language-plaintext highlighter-rouge">abc</code>的依赖时，Maven自动把<code class="language-plaintext highlighter-rouge">abc</code>和<code class="language-plaintext highlighter-rouge">xyz</code>都加入了我们的项目依赖，不需要自己去研究<code class="language-plaintext highlighter-rouge">abc</code>是否需要依赖<code class="language-plaintext highlighter-rouge">xyz</code>。</p><p>因此，Maven的第一个作用就是解决依赖管理。我们声明了自己的项目需要<code class="language-plaintext highlighter-rouge">abc</code>，Maven会自动导入<code class="language-plaintext highlighter-rouge">abc</code>的jar包，再判断出<code class="language-plaintext highlighter-rouge">abc</code>需要<code class="language-plaintext highlighter-rouge">xyz</code>，又会自动导入<code class="language-plaintext highlighter-rouge">xyz</code>的jar包，这样，最终我们的项目会依赖<code class="language-plaintext highlighter-rouge">abc</code>和<code class="language-plaintext highlighter-rouge">xyz</code>两个jar包。</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.4.2.RELEASE<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div><p>当声明一个<code class="language-plaintext highlighter-rouge">spring-boot-starter-web</code>依赖时，Maven会自动解析并判断最终需要大概二三十个其他依赖：</p><pre><code class="language-ascii">spring-boot-starter-web
  spring-boot-starter
    spring-boot
    sprint-boot-autoconfigure
    spring-boot-starter-logging
      logback-classic
        logback-core
        slf4j-api
      jcl-over-slf4j
        slf4j-api
      jul-to-slf4j
        slf4j-api
      log4j-over-slf4j
        slf4j-api
    spring-core
    snakeyaml
  spring-boot-starter-tomcat
    tomcat-embed-core
    tomcat-embed-el
    tomcat-embed-websocket
      tomcat-embed-core
  jackson-databind
  ...
</code></pre><p>如果自己去手动管理这些依赖是非常费时费力的，而且出错的概率很大。</p><h3 id="依赖关系">依赖关系</h3><p>Maven定义了几种依赖关系，分别是<code class="language-plaintext highlighter-rouge">compile</code>、<code class="language-plaintext highlighter-rouge">test</code>、<code class="language-plaintext highlighter-rouge">runtime</code>和<code class="language-plaintext highlighter-rouge">provided</code>：</p><table><thead><tr><th style="text-align: left">scope</th><th style="text-align: left">说明</th><th style="text-align: left">示例</th></tr></thead><tbody><tr><td style="text-align: left">compile</td><td style="text-align: left">编译与运行时都依赖，需要用到该jar包（默认）</td><td style="text-align: left">commons-logging</td></tr><tr><td style="text-align: left">test</td><td style="text-align: left">编译Test时需要用到该jar包</td><td style="text-align: left">junit</td></tr><tr><td style="text-align: left">runtime</td><td style="text-align: left">编译时不需要，但运行时需要用到</td><td style="text-align: left">mysql</td></tr><tr><td style="text-align: left">provided</td><td style="text-align: left">编译时需要用到，但运行时由JDK或某个服务器提供</td><td style="text-align: left">servlet-api</td></tr><tr><td style="text-align: left">system</td><td style="text-align: left">与provided类似，但jar由你自己定义（已弃用）</td><td style="text-align: left"> </td></tr><tr><td style="text-align: left">Import</td><td style="text-align: left">适用于pom文件中的<code class="language-plaintext highlighter-rouge">&lt;dependencyManagement&gt;</code>部分。表明指定的POM必须使用<code class="language-plaintext highlighter-rouge">&lt;dependencyManagement&gt;</code>部分的依赖。</td><td style="text-align: left"> </td></tr></tbody></table><p>其中，默认的<code class="language-plaintext highlighter-rouge">compile</code>是最常用的，Maven会把这种类型的依赖直接放入classpath。</p><p><code class="language-plaintext highlighter-rouge">test</code>依赖表示编译只在编译测试代码和运行测试的时候需要，应用的正常运行不需要此类依赖。典型的例子就是<code class="language-plaintext highlighter-rouge">JUnit</code>,它只有在编译测试代码及运行测试的时候才需要：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.junit.jupiter<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>junit-jupiter-api<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>5.3.2<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">runtime</code>依赖表示编译时不需要，但运行时需要。最典型的<code class="language-plaintext highlighter-rouge">runtime</code>依赖是JDBC驱动，项目主代码的编译只需要JDK提供的JDBC接口，只有在执行测试或者运行项目的时候才需要实现上述接口的具体JDBC驱动，例如MySQL驱动：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>5.1.48<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">provided</code>依赖表示编译时需要，但运行时不需要。最典型的<code class="language-plaintext highlighter-rouge">provided</code>依赖是Servlet API，编译的时候需要，但是运行时，Servlet服务器内置了相关的jar，所以运行期不需要：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>javax.servlet<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>javax.servlet-api<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>4.0.0<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div><p>system系统范围与provided类似，不过你必须显式指定一个本地系统路径的JAR,此类依赖应该一直有效，Maven也不会去仓库中寻找它。使用system范围依赖时必须通过systemPath元素显式地指定依赖文件的路径。</p><p>通常用于告诉Maven有关由JDK或VM提供的依赖关系。因此，系统依赖关系对于解决对构件的依赖关系特别有用，这些构件现在由JDK提供，但以前作为单独的下载可用。典型的例子是JDBC标准扩展或Java身份验证和授权服务(JAAS)。</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>javax.sql<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>jdbc-stdext<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.0<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;scope&gt;</span>system<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;systemPath&gt;</span>${java.home}/lib/rt.jar<span class="nt">&lt;/systemPath&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div><p>Import范围只适用于pom文件中的<code class="language-plaintext highlighter-rouge">&lt;dependencyManagement&gt;</code>部分。表明指定的POM必须使用<code class="language-plaintext highlighter-rouge">&lt;dependencyManagement&gt;</code>部分的依赖。</p><p>例:父:pom文件继承</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;properties&gt;</span>
    <span class="nt">&lt;banben&gt;</span>3.5.4<span class="nt">&lt;/banben&gt;</span>
<span class="nt">&lt;/properties&gt;</span>
<span class="nt">&lt;dependencyManagement&gt;</span>
    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.mybatis<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>mybatis<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${banben}<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/dependencyManagement&gt;</span>
</code></pre></div></div><p>子:</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;parent&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.msb<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>MavenDemo<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;relativePath&gt;</span>../MavenDemo/pom.xml<span class="nt">&lt;/relativePath&gt;</span>
<span class="nt">&lt;/parent&gt;</span>
<span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.mybatis<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>mybatis<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div><h3 id="依赖排除">依赖排除</h3><p>导入junit并排除junit依赖的junit(实际上不存在)</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>4.13.2<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;scope&gt;</span>compile<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;exclusions&gt;</span>
            <span class="nt">&lt;exclusion&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;/exclusion&gt;</span>
        <span class="nt">&lt;/exclusions&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div><h3 id="设置常量">设置常量</h3><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;properties&gt;</span>
    <span class="nt">&lt;banben&gt;</span>3.5.4<span class="nt">&lt;/banben&gt;</span>
<span class="nt">&lt;/properties&gt;</span>
<span class="nt">&lt;dependencyManagement&gt;</span>
    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.mybatis<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>mybatis<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${banben}<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/dependencyManagement&gt;</span>
</code></pre></div></div><p>其中：<code class="language-plaintext highlighter-rouge">&lt;properties&gt;&lt;banben&gt;3.5.4&lt;/banben&gt;&lt;/properties&gt;</code>，设置了常量<code class="language-plaintext highlighter-rouge">banben=3.5.4</code>，通过<code class="language-plaintext highlighter-rouge">${banben}</code>可以引用。</p><h2 id="镜像仓库">镜像仓库</h2><p>Maven如何知道从何处下载所需的依赖？也就是相关的jar包？答案是Maven维护了一个中央仓库（<a href="https://repo1.maven.org/">repo1.maven.org</a>），所有第三方库将自身的jar以及相关信息上传至中央仓库，Maven就可以从中央仓库把所需依赖下载到本地。</p><p>Maven并不会每次都从中央仓库下载jar包。一个jar包一旦被下载过，就会被Maven自动缓存在本地目录（用户主目录的<code class="language-plaintext highlighter-rouge">.m2</code>目录），所以，除了第一次编译时因为下载需要时间会比较慢，后续过程因为有本地缓存，并不会重复下载相同的jar包。</p><p><strong>中央仓库</strong></p><p>其实我们使用的大多数第三方模块都是这个用法，例如，我们使用commons logging、log4j这些第三方模块，就是第三方模块的开发者自己把编译好的jar包发布到Maven的中央仓库中。</p><p><strong>私有仓库</strong></p><p>私有仓库是指公司内部如果不希望把源码和jar包放到公网上，那么可以搭建私有仓库。私有仓库总是在公司内部使用，它只需要在本地的<code class="language-plaintext highlighter-rouge">~/.m2/settings.xml</code>中配置好，使用方式和中央仓位没有任何区别。</p><p><strong>本地仓库</strong></p><p>本地仓库是指把本地开发的项目“发布”在本地，这样其他项目可以通过本地仓库引用它。但是我们不推荐把自己的模块安装到Maven的本地仓库，因为每次修改某个模块的源码，都需要重新安装，非常容易出现版本不一致的情况。更好的方法是使用模块化编译，在编译的时候，告诉Maven几个模块之间存在依赖关系，需要一块编译，Maven就会自动按依赖顺序编译这些模块。</p><p><strong>镜像仓库</strong></p><p>除了可以从Maven的中央仓库下载外，还可以从Maven的镜像仓库下载。如果访问Maven的中央仓库非常慢，可以选择一个速度较快的Maven的镜像仓库。Maven镜像仓库定期从中央仓库同步：</p><pre><code class="language-ascii">           slow    ┌───────────────────┐
    ┌─────────────▶│Maven Central Repo.│
    │              └───────────────────┘
    │                        │
    │                        │sync
    │                        ▼
┌───────┐  fast    ┌───────────────────┐
│ User  │─────────▶│Maven Mirror Repo. │
└───────┘          └───────────────────┘
</code></pre><p>全局修改远程仓库地址：修改<code class="language-plaintext highlighter-rouge">settings.xml</code>文件，指定远程仓库，如阿里的：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;mirrors&gt;</span>
    <span class="c">&lt;!-- mirror
     | Specifies a repository mirror site to use instead of a given repository. The repository that
     | this mirror serves has an ID that matches the mirrorOf element of this mirror. IDs are used
     | for inheritance and direct lookup purposes, and must be unique across the set of mirrors.
     |
    &lt;mirror&gt;
      &lt;id&gt;mirrorId&lt;/id&gt;
      &lt;mirrorOf&gt;repositoryId&lt;/mirrorOf&gt;
      &lt;name&gt;Human Readable Name for this Mirror.&lt;/name&gt;
      &lt;url&gt;http://my.repository.com/repo/path&lt;/url&gt;
    &lt;/mirror&gt;
     --&gt;</span>
    <span class="nt">&lt;mirror&gt;</span>
        <span class="nt">&lt;id&gt;</span>alimaven<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;mirrorOf&gt;</span>central<span class="nt">&lt;/mirrorOf&gt;</span>
        <span class="nt">&lt;name&gt;</span>aliyun maven<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;url&gt;</span>http://maven.aliyun.com/nexus/content/repositories/central/<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/mirror&gt;</span>
    <span class="c">&lt;!--     &lt;mirror&gt;
      &lt;id&gt;maven-default-http-blocker&lt;/id&gt;
      &lt;mirrorOf&gt;external:http:*&lt;/mirrorOf&gt;
      &lt;name&gt;Pseudo repository to mirror external repositories initially using HTTP.&lt;/name&gt;
      &lt;url&gt;http://0.0.0.0/&lt;/url&gt;
      &lt;blocked&gt;true&lt;/blocked&gt;
    &lt;/mirror&gt; --&gt;</span>
<span class="nt">&lt;/mirrors&gt;</span>
</code></pre></div></div><p>配置镜像仓库后，Maven的下载速度就会非常快。</p><p>IDEA自带的maven路径为：<code class="language-plaintext highlighter-rouge">~\plugins\maven\lib\maven3\conf\settings.xml</code>。</p><p>在单个pom.xml文件配置：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;project&gt;</span>
    <span class="c">&lt;!-- 阿里云maven仓库 --&gt;</span>
    <span class="nt">&lt;repositories&gt;</span>
        <span class="nt">&lt;repository&gt;</span>
            <span class="nt">&lt;id&gt;</span>public<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;name&gt;</span>aliyun nexus<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>https://maven.aliyun.com/repository/public<span class="nt">&lt;/url&gt;</span>
            <span class="nt">&lt;releases&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/releases&gt;</span>
        <span class="nt">&lt;/repository&gt;</span>
    <span class="nt">&lt;/repositories&gt;</span>
    <span class="nt">&lt;pluginRepositories&gt;</span>
        <span class="nt">&lt;pluginRepository&gt;</span>
            <span class="nt">&lt;id&gt;</span>public<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;name&gt;</span>aliyun nexus<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>https://maven.aliyun.com/repository/public<span class="nt">&lt;/url&gt;</span>
            <span class="nt">&lt;releases&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/releases&gt;</span>
            <span class="nt">&lt;snapshots&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/snapshots&gt;</span>
        <span class="nt">&lt;/pluginRepository&gt;</span>
    <span class="nt">&lt;/pluginRepositories&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div><h2 id="构建流程">构建流程</h2><p>Maven不但有标准化的项目结构，而且还有一套标准化的构建流程，可以自动化实现编译，打包，发布，等等。</p><p>Maven强大的一个重要的原因是它有一个十分完善的生命周期模型(lifecycle)，这个生命周期可以从两方面来理解，第一，顾名思义，运行Maven的每个步骤都由它来定义的，这种预定义的默认行为使得使用Maven变得简单，相比而言，Ant的每个步骤都要你手工去定义。第二，这个模型是一种标准，在不同的项目中，使用Maven的接口是一样的，这样就不用去仔细理解每个项目的构建了，一般情况下，<code class="language-plaintext highlighter-rouge">mvn clean install</code>这样的命令是通用的。</p><p>Maven有三套<strong>相互独立</strong>的生命周期，初学者容易将Maven的生命周期看成一个整体，其实不然。这三套生命周期分别是：</p><ul><li>Clean Lifecycle 在进行真正的构建之前进行一些清理工作。</li><li>Default Lifecycle 构建的核心部分，编译，测试，打包，部署等等。</li><li>Site Lifecycle 生成项目报告，站点，发布站点。</li></ul><p>可以仅仅调用clean来清理工作目录，仅仅调用site来生成站点。当然你也可以直接运行 <code class="language-plaintext highlighter-rouge">mvn clean install site</code> 运行所有这三套生命周期。</p><p>每套生命周期都由一组阶段(Phase)组成，平时在命令行输入的命令总会<strong>对应</strong>于一个<strong>特定的阶段</strong>。比如，运行<code class="language-plaintext highlighter-rouge">mvn clean</code> ，这个的clean是Clean生命周期的一个阶段。</p><hr /><p>Clean生命周期一共包含了三个阶段：</p><ul><li>pre-clean 执行一些需要在clean之前完成的工作</li><li>clean 移除所有上一次构建生成的文件</li><li>post-clean 执行一些需要在clean之后立刻完成的工作</li></ul><p><code class="language-plaintext highlighter-rouge">mvn clean</code> 中的clean就是上面的<code class="language-plaintext highlighter-rouge">clean</code>，<strong>在一个生命周期中，运行某个阶段的时候，它之前的所有阶段都会被运行</strong>。也就是说，<code class="language-plaintext highlighter-rouge">mvn clean</code> 等同于运行 <code class="language-plaintext highlighter-rouge">mvn pre-clean</code> 、<code class="language-plaintext highlighter-rouge">mvn clean</code> ，如果运行 <code class="language-plaintext highlighter-rouge">mvn post-clean</code> ，那么 pre-clean，clean 也都会被运行。这是Maven很重要的一个规则，可以大大简化命令行的输入。</p><p>Site生命周期的各个阶段：</p><ul><li>pre-site 执行一些需要在生成站点文档之前完成的工作</li><li>site 生成项目的站点文档</li><li>post-site 执行一些需要在生成站点文档之后完成的工作，并且为部署做准备</li><li>site-deploy 将生成的站点文档部署到特定的服务器上</li></ul><p>这里经常用到的是site阶段和site-deploy阶段，用以生成和发布Maven站点，这可是Maven相当强大的功能，Manager比较喜欢，文档及统计数据自动生成，很好看。</p><p>Maven的最重要的Default生命周期，绝大部分工作都发生在这个生命周期中：</p><ul><li>validate 校验</li><li>initialize 初始化</li><li>generate-sources 生成源码</li><li>process-sources 处理源码</li><li>generate-resources 生成资源</li><li>process-resources 复制并处理资源文件，至目标目录，准备打包。</li><li>compile 编译项目的源代码。</li><li>process-classes 处理-classes</li><li>generate-test-sources 生成测试源码</li><li>process-test-sources 处理测试源码</li><li>generate-test-resources 生成测试资源</li><li>process-test-resources 复制并处理资源文件，至目标测试目录。</li><li>test-compile 编译测试源代码。</li><li>process-test-classes 处理测试-classes</li><li>test 使用合适的单元测试框架运行测试。这些测试代码不会被打包或部署。</li><li>prepare-package 准备打包</li><li>package 接受编译好的代码，打包成可发布的格式，如 JAR 。</li><li>pre-integration-test 预综合测试</li><li>integration-test 综合测试</li><li>post-integration-test 综合测试之后</li><li>verify 核实</li><li>install 将包安装至本地仓库，以让其它项目依赖。</li><li>deploy 将最终的包复制到远程的仓库，以让其它开发人员与项目共享。</li></ul><p>使用<code class="language-plaintext highlighter-rouge">mvn</code>命令时，后面的参数是阶段，Maven自动根据生命周期运行到指定的阶段。更复杂的例子是指定多个阶段，例如运行<code class="language-plaintext highlighter-rouge">mvn clean package</code>，Maven先执行<code class="language-plaintext highlighter-rouge">clean</code>生命周期并运行到<code class="language-plaintext highlighter-rouge">clean</code>这个阶段，然后执行<code class="language-plaintext highlighter-rouge">default</code>生命周期并运行到<code class="language-plaintext highlighter-rouge">package</code>这个阶段。</p><hr /><p>在实际开发过程中，经常使用的命令有：</p><p><code class="language-plaintext highlighter-rouge">mvn clean</code>：清理所有生成的class和jar；</p><p><code class="language-plaintext highlighter-rouge">mvn clean compile</code>：先清理，再执行到<code class="language-plaintext highlighter-rouge">compile</code>；</p><p><code class="language-plaintext highlighter-rouge">mvn clean test</code>：先清理，再执行到<code class="language-plaintext highlighter-rouge">test</code>，因为执行<code class="language-plaintext highlighter-rouge">test</code>前必须执行<code class="language-plaintext highlighter-rouge">compile</code>，所以这里不必指定<code class="language-plaintext highlighter-rouge">compile</code>；</p><p><code class="language-plaintext highlighter-rouge">mvn clean package</code>：先清理，再执行到<code class="language-plaintext highlighter-rouge">package</code>。</p><p>大多数阶段在执行过程中，因为我们通常没有在<code class="language-plaintext highlighter-rouge">pom.xml</code>中配置相关的设置，所以这些阶段什么事情都不做。</p><p><strong>命令行编译</strong></p><p>在命令中，进入到<code class="language-plaintext highlighter-rouge">pom.xml</code>所在目录，输入以下命令：</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn clean package
</code></pre></div></div><p>如果一切顺利，即可在<code class="language-plaintext highlighter-rouge">target</code>目录下获得编译后自动打包的jar或war。</p><p>mvn dependency:tree 以树形列出依赖</p><p>mvn dependency:list 列出依赖</p><hr /><p>执行一个阶段又会触发一个或多个goal：</p><table><thead><tr><th style="text-align: left">执行的阶段</th><th style="text-align: left">对应执行的Goal</th></tr></thead><tbody><tr><td style="text-align: left">compile</td><td style="text-align: left">compiler:compile</td></tr><tr><td style="text-align: left">test</td><td style="text-align: left">compiler:testCompile surefire:test</td></tr></tbody></table><p>goal的命名总是<code class="language-plaintext highlighter-rouge">abc:xyz</code>这种形式。</p><ul><li>生命周期相当于Java的包，它包含一个或多个阶段；</li><li>阶段相当于Java的类，它包含一个或多个goal；</li><li>goal相当于class的方法，它其实才是真正干活的。</li></ul><p>大多数情况，只要指定阶段，就默认执行这些阶段默认绑定的goal，只有少数情况，可以直接指定运行一个goal，例如，启动Tomcat服务器：</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn tomcat:run
</code></pre></div></div><h2 id="插件">插件</h2><p>以<code class="language-plaintext highlighter-rouge">compile</code>这个阶段为例，如果执行：</p><pre><code class="language-cmd">mvn compile
</code></pre><p>Maven将执行<code class="language-plaintext highlighter-rouge">compile</code>这个阶段，这个phase会调用<code class="language-plaintext highlighter-rouge">compiler</code>插件执行关联的<code class="language-plaintext highlighter-rouge">compiler:compile</code>这个goal。</p><p>实际上，执行每个阶段，都是通过某个插件（plugin）来执行的，Maven本身其实并不知道如何执行<code class="language-plaintext highlighter-rouge">compile</code>，它只是负责找到对应的<code class="language-plaintext highlighter-rouge">compiler</code>插件，然后执行默认的<code class="language-plaintext highlighter-rouge">compiler:compile</code>这个goal来完成编译。</p><p>所以，使用Maven，实际上就是配置好需要使用的插件，然后通过阶段调用它们。</p><p>Maven已经内置了一些常用的标准插件：</p><table><thead><tr><th style="text-align: left">插件名称</th><th style="text-align: left">对应执行的phase</th></tr></thead><tbody><tr><td style="text-align: left">clean</td><td style="text-align: left">clean</td></tr><tr><td style="text-align: left">compiler</td><td style="text-align: left">compile</td></tr><tr><td style="text-align: left">surefire</td><td style="text-align: left">test</td></tr><tr><td style="text-align: left">jar</td><td style="text-align: left">package</td></tr></tbody></table><p>如果标准插件无法满足需求，我们还可以使用自定义插件。使用自定义插件的时候，需要声明。例如，使用<code class="language-plaintext highlighter-rouge">maven-shade-plugin</code>可以创建一个可执行的jar，要使用这个插件，需要在<code class="language-plaintext highlighter-rouge">pom.xml</code>中声明它：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;project&gt;</span>
    ...
	<span class="nt">&lt;build&gt;</span>
		<span class="nt">&lt;plugins&gt;</span>
            <span class="c">&lt;!-- 添加插件 maven-antrun-plugin --&gt;</span>
			<span class="nt">&lt;plugin&gt;</span>
				<span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
				<span class="nt">&lt;artifactId&gt;</span>maven-shade-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>3.2.1<span class="nt">&lt;/version&gt;</span>
				<span class="nt">&lt;executions&gt;</span>
					<span class="nt">&lt;execution&gt;</span>
                        <span class="c">&lt;!--插件目标绑定的构建阶段 --&gt;</span>
						<span class="nt">&lt;phase&gt;</span>package<span class="nt">&lt;/phase&gt;</span>
                        <span class="c">&lt;!--插件目标 --&gt;</span>
						<span class="nt">&lt;goals&gt;</span>
							<span class="nt">&lt;goal&gt;</span>shade<span class="nt">&lt;/goal&gt;</span>
						<span class="nt">&lt;/goals&gt;</span>
                        <span class="c">&lt;!--配置 --&gt;</span>
						<span class="nt">&lt;configuration&gt;</span>
                            ...
						<span class="nt">&lt;/configuration&gt;</span>
					<span class="nt">&lt;/execution&gt;</span>
				<span class="nt">&lt;/executions&gt;</span>
			<span class="nt">&lt;/plugin&gt;</span>
		<span class="nt">&lt;/plugins&gt;</span>
	<span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div><p>Maven 提供了如下 2 种类型的插件。</p><table><thead><tr><th>插件类型</th><th>描述</th></tr></thead><tbody><tr><td>Build plugins</td><td>在项目构建过程中执行，在 pom.xml 中的 build 元素中配置</td></tr><tr><td>Reporting plugins</td><td>在网站生成过程中执行，在 pom.xml 中的 reporting 元素中配置</td></tr></tbody></table><p>以上配置中除了插件的坐标信息之外，还通过 executions 元素定义了一些执行配置。executions 下的每一个 executin 子元素都可以用来配置执行一个任务。</p><p>execution 下各个元素含义如下：</p><ul><li>id：任务的唯一标识。</li><li>phase：插件目标需要绑定的生命周期阶段。</li><li>goals：用于指定一组插件目标，其子元素 goal 用于指定一个插件目标。</li><li>configuration：该任务的配置，其子元素 tasks 用于指定该插件目标执行的任务。</li></ul><p>自定义插件往往需要一些配置，例如，<code class="language-plaintext highlighter-rouge">maven-shade-plugin</code>需要指定Java程序的入口，它的配置是：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;transformers&gt;</span>
        <span class="nt">&lt;transformer</span> <span class="na">implementation=</span><span class="s">"org.apache.maven.plugins.shade.resource.ManifestResourceTransformer"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;mainClass&gt;</span>com.test.Main<span class="nt">&lt;/mainClass&gt;</span>
        <span class="nt">&lt;/transformer&gt;</span>
    <span class="nt">&lt;/transformers&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</code></pre></div></div><p>注意，Maven自带的标准插件例如<code class="language-plaintext highlighter-rouge">compiler</code>是无需声明的，只有引入其它的插件才需要声明。</p><p>下面列举了一些常用的插件：</p><ul><li>maven-shade-plugin：打包所有依赖包并生成可执行jar；</li><li>cobertura-maven-plugin：生成单元测试覆盖率报告；</li><li>findbugs-maven-plugin：对Java源码进行静态分析以找出潜在问题。</li></ul><p>当使用 <code class="language-plaintext highlighter-rouge">maven-shade-plugin</code> 插件时，它的定义会产生两个效果：</p><ol><li>打包可执行的JAR文件：<code class="language-plaintext highlighter-rouge">maven-shade-plugin</code>插件可以将项目的所有依赖项（包括项目本身的代码）打包成一个可执行的JAR文件。这个JAR文件中包含了所有依赖项，因此可以直接通过<code class="language-plaintext highlighter-rouge">java -jar</code>命令来运行。</li><li>重定制MANIFEST.MF文件：<code class="language-plaintext highlighter-rouge">maven-shade-plugin</code>还可以重定制JAR文件的MANIFEST.MF文件，其中包括了关于JAR文件的元数据信息，比如主类（Main-Class）、依赖项等。这使得打包后的JAR文件可以直接通过<code class="language-plaintext highlighter-rouge">java -jar</code>命令来执行，而不需要手动设置类路径。</li></ol><p>因此，<code class="language-plaintext highlighter-rouge">maven-shade-plugin</code>插件的主要作用是将项目及其依赖项打包成一个可执行的JAR文件，并且自动配置JAR文件的MANIFEST.MF文件，使得项目可以方便地作为独立的可执行文件来运行。</p><p>另外，<code class="language-plaintext highlighter-rouge">maven-jar-plugin</code> 也可以用来定义 <code class="language-plaintext highlighter-rouge">mainClass</code>，可以这样配置：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;plugin&gt;</span> 
    <span class="nt">&lt;artifactId&gt;</span>maven-jar-plugin<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>3.3.0<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;archive&gt;</span>
            <span class="nt">&lt;manifest&gt;</span>
                <span class="nt">&lt;mainClass&gt;</span>com.test.Main<span class="nt">&lt;/mainClass&gt;</span>
            <span class="nt">&lt;/manifest&gt;</span>
        <span class="nt">&lt;/archive&gt;</span>
    <span class="nt">&lt;/configuration&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</code></pre></div></div><p>如果同时使用了这两个插件，并且在 <code class="language-plaintext highlighter-rouge">maven-surefire-plugin</code> 的配置中定义了 <code class="language-plaintext highlighter-rouge">mainClass</code>，那么删除 <code class="language-plaintext highlighter-rouge">shade plugin</code> 中的 <code class="language-plaintext highlighter-rouge">configuration</code> 定义也是可以的，效果是一样的。</p><p>另外，在删除了 <code class="language-plaintext highlighter-rouge">shade plugin</code> 的定义后，保留 <code class="language-plaintext highlighter-rouge">jar-plugin</code>，完全删除 <code class="language-plaintext highlighter-rouge">shade</code> 插件的定义也是可以的。这样做后，执行 <code class="language-plaintext highlighter-rouge">mvn package</code> 会将项目打包成一个普通的 JAR 文件，不会进行 shade 操作；而执行 <code class="language-plaintext highlighter-rouge">mvn shade:shade</code> 会将项目打包成一个包含所有依赖并且经过 shade 处理的 JAR 文件。因此，如果希望在打包时进行 shade 操作，应该执行 <code class="language-plaintext highlighter-rouge">mvn package shade:shade</code> 命令。</p><p>需要注意的是，分别执行 <code class="language-plaintext highlighter-rouge">mvn package</code> 和 <code class="language-plaintext highlighter-rouge">mvn shade:shade</code> 是不会起作用的，因为 <code class="language-plaintext highlighter-rouge">shade</code> 不是一个 lifecycle 阶段。在执行 <code class="language-plaintext highlighter-rouge">mvn package</code> 时不会执行 shade 操作，即使有 <code class="language-plaintext highlighter-rouge">shade plugin</code> 的定义也不会进行 shade 处理。要执行 shade 操作，需要显式地使用 <code class="language-plaintext highlighter-rouge">mvn package shade:shade</code> 命令。</p><p><code class="language-plaintext highlighter-rouge">shade plugin</code> 是 Maven 的标准插件，可以直接使用。</p><p><strong>JavaWebMaven项目</strong></p><p>不推荐：</p><p>创建时选择<code class="language-plaintext highlighter-rouge">org.apache.maven.archetypes:maven-archetype-webapp</code> 修改jdk版本,修改junit版本为4.12,清空<code class="language-plaintext highlighter-rouge">&lt;plugins&gt;</code>标签内默认插件,添加jetty或tomcat插件:</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- jetty插件 --&gt;</span>
<span class="nt">&lt;plugin&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.eclipse.jetty<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>jetty-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>9.4.11.v20180605<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;configuration&gt;</span>
        <span class="c">&lt;!-- 热部署，每10s扫描一次 --&gt;</span>
        <span class="nt">&lt;scanIntervalSeconds&gt;</span>10<span class="nt">&lt;/scanIntervalSeconds&gt;</span>
        <span class="c">&lt;!-- 可指定当前项目的站点名 --&gt;</span>
        <span class="nt">&lt;webApp&gt;</span>
            <span class="nt">&lt;contextPath&gt;</span>/test<span class="nt">&lt;/contextPath&gt;</span>
        <span class="nt">&lt;/webApp&gt;</span>
        <span class="nt">&lt;httpConnector&gt;</span>
            <span class="nt">&lt;port&gt;</span>8090<span class="nt">&lt;/port&gt;</span> <span class="c">&lt;!-- 端口号 --&gt;</span>
        <span class="nt">&lt;/httpConnector&gt;</span>
    <span class="nt">&lt;/configuration&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
<span class="c">&lt;!-- Tomcat插件 --&gt;</span>
<span class="nt">&lt;plugin&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apache.tomcat.maven<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>tomcat7-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.1<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;configuration&gt;</span>
        <span class="c">&lt;!-- 此处为项目的上下文路径 --&gt;</span>
        <span class="nt">&lt;path&gt;</span>/test<span class="nt">&lt;/path&gt;</span>
        <span class="c">&lt;!--此处配置了访问的端口号 --&gt;</span>
        <span class="nt">&lt;port&gt;</span>8081<span class="nt">&lt;/port&gt;</span>
        <span class="c">&lt;!--字符集编码 --&gt;</span>
        <span class="nt">&lt;uriEncoding&gt;</span>UTF-8<span class="nt">&lt;/uriEncoding&gt;</span>
        <span class="c">&lt;!--服务器名称 --&gt;</span>
        <span class="nt">&lt;server&gt;</span>tomcat7<span class="nt">&lt;/server&gt;</span>
    <span class="nt">&lt;/configuration&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</code></pre></div></div><p>添加启动方式为Maven,启动命令为:jetty:run或tomcat7:run</p><p>推荐：直接新建Maven项目,不选择模板,通过项目结构添加web</p><h2 id="模块管理">模块管理</h2><p>在软件开发中，把一个大项目分拆为多个模块是降低软件复杂度的有效方法：</p><pre><code class="language-ascii">                        ┌ ─ ─ ─ ─ ─ ─ ┐
                          ┌─────────┐
                        │ │Module A │ │
                          └─────────┘
┌──────────────┐ split  │ ┌─────────┐ │
│Single Project│───────▶  │Module B │
└──────────────┘        │ └─────────┘ │
                          ┌─────────┐
                        │ │Module C │ │
                          └─────────┘
                        └ ─ ─ ─ ─ ─ ─ ┘
</code></pre><p>对于Maven工程来说，原来是一个大项目：</p><pre><code class="language-ascii">single-project
├── pom.xml
└── src
</code></pre><p>现在可以分拆成3个模块：</p><pre><code class="language-ascii">mutiple-project
├── module-a
│   ├── pom.xml
│   └── src
├── module-b
│   ├── pom.xml
│   └── src
└── module-c
    ├── pom.xml
    └── src
</code></pre><p>Maven可以有效地管理多个模块，只需要把每个模块当作一个独立的Maven项目，它们有各自独立的<code class="language-plaintext highlighter-rouge">pom.xml</code>。例如，模块A的<code class="language-plaintext highlighter-rouge">pom.xml</code>：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;groupId&gt;</span>com.XXX<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>module-a<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;packaging&gt;</span>jar<span class="nt">&lt;/packaging&gt;</span>

    <span class="nt">&lt;name&gt;</span>module-a<span class="nt">&lt;/name&gt;</span>

    <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
        <span class="nt">&lt;project.reporting.outputEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.reporting.outputEncoding&gt;</span>
        <span class="nt">&lt;maven.compiler.source&gt;</span>11<span class="nt">&lt;/maven.compiler.source&gt;</span>
        <span class="nt">&lt;maven.compiler.target&gt;</span>11<span class="nt">&lt;/maven.compiler.target&gt;</span>
        <span class="nt">&lt;java.version&gt;</span>11<span class="nt">&lt;/java.version&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>slf4j-api<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.7.28<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>ch.qos.logback<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>logback-classic<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.2.3<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.junit.jupiter<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>junit-jupiter-engine<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>5.5.2<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div><p>模块B的<code class="language-plaintext highlighter-rouge">pom.xml</code>：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;groupId&gt;</span>com.XXX<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>module-b<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;packaging&gt;</span>jar<span class="nt">&lt;/packaging&gt;</span>

    <span class="nt">&lt;name&gt;</span>module-b<span class="nt">&lt;/name&gt;</span>

    <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
        <span class="nt">&lt;project.reporting.outputEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.reporting.outputEncoding&gt;</span>
        <span class="nt">&lt;maven.compiler.source&gt;</span>11<span class="nt">&lt;/maven.compiler.source&gt;</span>
        <span class="nt">&lt;maven.compiler.target&gt;</span>11<span class="nt">&lt;/maven.compiler.target&gt;</span>
        <span class="nt">&lt;java.version&gt;</span>11<span class="nt">&lt;/java.version&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>slf4j-api<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.7.28<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>ch.qos.logback<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>logback-classic<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.2.3<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.junit.jupiter<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>junit-jupiter-engine<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>5.5.2<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div><p>可以看出来，模块A和模块B的<code class="language-plaintext highlighter-rouge">pom.xml</code>高度相似，因此，可以提取出共同部分作为<code class="language-plaintext highlighter-rouge">parent</code>：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;groupId&gt;</span>com.XXX<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>parent<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;packaging&gt;</span>pom<span class="nt">&lt;/packaging&gt;</span>

    <span class="nt">&lt;name&gt;</span>parent<span class="nt">&lt;/name&gt;</span>

    <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
        <span class="nt">&lt;project.reporting.outputEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.reporting.outputEncoding&gt;</span>
        <span class="nt">&lt;maven.compiler.source&gt;</span>11<span class="nt">&lt;/maven.compiler.source&gt;</span>
        <span class="nt">&lt;maven.compiler.target&gt;</span>11<span class="nt">&lt;/maven.compiler.target&gt;</span>
        <span class="nt">&lt;java.version&gt;</span>11<span class="nt">&lt;/java.version&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>slf4j-api<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.7.28<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>ch.qos.logback<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>logback-classic<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.2.3<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.junit.jupiter<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>junit-jupiter-engine<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>5.5.2<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div><p>注意到parent的<code class="language-plaintext highlighter-rouge">&lt;packaging&gt;</code>是<code class="language-plaintext highlighter-rouge">pom</code>而不是<code class="language-plaintext highlighter-rouge">jar</code>，因为<code class="language-plaintext highlighter-rouge">parent</code>本身不含任何Java代码。编写<code class="language-plaintext highlighter-rouge">parent</code>的<code class="language-plaintext highlighter-rouge">pom.xml</code>只是为了在各个模块中减少重复的配置。现在我们的整个工程结构如下：</p><pre><code class="language-ascii">multiple-project
├── pom.xml
├── parent
│   └── pom.xml
├── module-a
│   ├── pom.xml
│   └── src
├── module-b
│   ├── pom.xml
│   └── src
└── module-c
    ├── pom.xml
    └── src
</code></pre><p>这样模块A就可以简化为：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.XXX<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>parent<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;relativePath&gt;</span>../parent/pom.xml<span class="nt">&lt;/relativePath&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>

    <span class="nt">&lt;artifactId&gt;</span>module-a<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;packaging&gt;</span>jar<span class="nt">&lt;/packaging&gt;</span>
    <span class="nt">&lt;name&gt;</span>module-a<span class="nt">&lt;/name&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div><p>模块B、模块C都可以直接从<code class="language-plaintext highlighter-rouge">parent</code>继承，大幅简化了<code class="language-plaintext highlighter-rouge">pom.xml</code>的编写。</p><p>如果模块A依赖模块B，则模块A需要模块B的jar包才能正常编译，我们需要在模块A中引入模块B：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    ...
    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.XXX<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>module-b<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div><p>最后，在编译的时候，需要在根目录创建一个<code class="language-plaintext highlighter-rouge">pom.xml</code>统一编译：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.XXX<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>build<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;packaging&gt;</span>pom<span class="nt">&lt;/packaging&gt;</span>
    <span class="nt">&lt;name&gt;</span>build<span class="nt">&lt;/name&gt;</span>

    <span class="nt">&lt;modules&gt;</span>
        <span class="nt">&lt;module&gt;</span>parent<span class="nt">&lt;/module&gt;</span>
        <span class="nt">&lt;module&gt;</span>module-a<span class="nt">&lt;/module&gt;</span>
        <span class="nt">&lt;module&gt;</span>module-b<span class="nt">&lt;/module&gt;</span>
        <span class="nt">&lt;module&gt;</span>module-c<span class="nt">&lt;/module&gt;</span>
    <span class="nt">&lt;/modules&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div><p>这样，在根目录执行<code class="language-plaintext highlighter-rouge">mvn clean package</code>时，Maven根据根目录的<code class="language-plaintext highlighter-rouge">pom.xml</code>找到包括<code class="language-plaintext highlighter-rouge">parent</code>在内的共4个<code class="language-plaintext highlighter-rouge">&lt;module&gt;</code>，一次性全部编译。</p><p>也可以直接把parent的内容写到根目录pom.xml中：</p><p>并添加：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;modules&gt;</span>
    <span class="nt">&lt;module&gt;</span>module-a<span class="nt">&lt;/module&gt;</span>
    <span class="nt">&lt;module&gt;</span>module-b<span class="nt">&lt;/module&gt;</span>
    <span class="nt">&lt;module&gt;</span>module-c<span class="nt">&lt;/module&gt;</span>
<span class="nt">&lt;/modules&gt;</span>
</code></pre></div></div><p>即可，子模块重新指定一下父pom.xml位置。</p><p>maven的多模块只是批量管理或操作用的，聚合工程或传递依赖用的，不是用来为一个项目打一个jar包的，一个工程下包括多个模块，实际上一个模块才对应一个jar包</p><h2 id="mvnw">mvnw</h2><p><code class="language-plaintext highlighter-rouge">mvnw</code>是Maven Wrapper的缩写。因为安装Maven时，默认情况下，系统所有项目都会使用全局安装的这个Maven版本。但是，对于某些项目来说，它可能必须使用某个特定的Maven版本，这个时候，就可以使用Maven Wrapper，它可以负责给这个特定的项目安装指定版本的Maven，而其他项目不受影响。</p><p>简单地说，Maven Wrapper就是给一个项目提供一个独立的，指定版本的Maven给它使用。</p><p><strong>安装Maven Wrapper</strong></p><p>安装Maven Wrapper最简单的方式是在项目的根目录（即<code class="language-plaintext highlighter-rouge">pom.xml</code>所在的目录）下运行安装命令：</p><pre><code class="language-cmd">mvn -N io.takari:maven:0.7.6:wrapper
</code></pre><p>它会自动使用最新版本的Maven。注意<code class="language-plaintext highlighter-rouge">0.7.6</code>是Maven Wrapper的版本。最新的Maven Wrapper版本可以去<a href="https://github.com/takari/maven-wrapper">官方网站</a>查看。</p><p>如果要指定使用的Maven版本，使用下面的安装命令指定版本，例如<code class="language-plaintext highlighter-rouge">3.3.3</code>：</p><pre><code class="language-cmd">mvn -N io.takari:maven:0.7.6:wrapper -Dmaven=3.3.3
</code></pre><p>安装后，查看项目结构：</p><pre><code class="language-ascii">my-project
├── .mvn
│   └── wrapper
│       ├── MavenWrapperDownloader.java
│       ├── maven-wrapper.jar
│       └── maven-wrapper.properties
├── mvnw
├── mvnw.cmd
├── pom.xml
└── src
    ├── main
    │   ├── java
    │   └── resources
    └── test
        ├── java
        └── resources
</code></pre><p>发现多了<code class="language-plaintext highlighter-rouge">mvnw</code>、<code class="language-plaintext highlighter-rouge">mvnw.cmd</code>和<code class="language-plaintext highlighter-rouge">.mvn</code>目录，只需要把<code class="language-plaintext highlighter-rouge">mvn</code>命令改成<code class="language-plaintext highlighter-rouge">mvnw</code>就可以使用跟项目关联的Maven。例如：</p><pre><code class="language-cmd">mvnw clean package
</code></pre><p>在Linux或macOS下运行时需要加上<code class="language-plaintext highlighter-rouge">./</code>：</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./mvnw clean package
</code></pre></div></div><p>Maven Wrapper的另一个作用是把项目的<code class="language-plaintext highlighter-rouge">mvnw</code>、<code class="language-plaintext highlighter-rouge">mvnw.cmd</code>和<code class="language-plaintext highlighter-rouge">.mvn</code>提交到版本库中，可以使所有开发人员使用统一的Maven版本。</p><h2 id="发布artifact">发布Artifact</h2><p>当使用<code class="language-plaintext highlighter-rouge">commons-logging</code>这些第三方开源库的时候，实际上是通过Maven自动下载它的jar包，并根据其<code class="language-plaintext highlighter-rouge">pom.xml</code>解析依赖，自动把相关依赖包都下载后加入到classpath。</p><p>那么问题来了：当我们自己写了一个牛逼的开源库时，非常希望别人也能使用，总不能直接放个jar包的链接让别人下载吧？</p><p>如果把自己的开源库放到Maven的repo中，那么，别人只需按标准引用<code class="language-plaintext highlighter-rouge">groupId:artifactId:version</code>，即可自动下载jar包以及相关依赖。</p><p>把自己的库发布到Maven的repo中有好几种方法，介绍3种最常用的方法。</p><h3 id="以静态文件发布">以静态文件发布</h3><p>如果我们观察一个中央仓库的Artifact结构，例如<a href="https://commons.apache.org/proper/commons-math/">Commons Math</a>，它的groupId是<code class="language-plaintext highlighter-rouge">org.apache.commons</code>，artifactId是<code class="language-plaintext highlighter-rouge">commons-math3</code>，以版本<code class="language-plaintext highlighter-rouge">3.6.1</code>为例，发布在中央仓库的文件夹路径就是https://repo1.maven.org/maven2/org/apache/commons/commons-math3/3.6.1/，在此文件夹下，<code class="language-plaintext highlighter-rouge">commons-math3-3.6.1.jar</code>就是发布的jar包，<code class="language-plaintext highlighter-rouge">commons-math3-3.6.1.pom</code>就是它的<code class="language-plaintext highlighter-rouge">pom.xml</code>描述文件，<code class="language-plaintext highlighter-rouge">commons-math3-3.6.1-sources.jar</code>是源代码，<code class="language-plaintext highlighter-rouge">commons-math3-3.6.1-javadoc.jar</code>是文档。其它以<code class="language-plaintext highlighter-rouge">.asc</code>、<code class="language-plaintext highlighter-rouge">.md5</code>、<code class="language-plaintext highlighter-rouge">.sha1</code>结尾的文件分别是GPG签名、MD5摘要和SHA-1摘要。</p><p>只要按照这种目录结构组织文件，它就是一个有效的Maven仓库。</p><p>以广受好评的开源项目<a href="https://github.com/michaelliao/how-to-become-rich">how-to-become-rich</a>为例，先创建Maven工程目录结构如下：</p><pre><code class="language-ascii">how-to-become-rich
├── maven-repo        &lt;-- Maven本地文件仓库
├── pom.xml           &lt;-- 项目文件
├── src
│   ├── main
│   │   ├── java      &lt;-- 源码目录
│   │   └── resources &lt;-- 资源目录
│   └── test
│       ├── java      &lt;-- 测试源码目录
│       └── resources &lt;-- 测试资源目录
└── target            &lt;-- 编译输出目录
</code></pre><p>在<code class="language-plaintext highlighter-rouge">pom.xml</code>中添加如下内容：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;project</span> <span class="err">...</span><span class="nt">&gt;</span>
    ...
    <span class="nt">&lt;distributionManagement&gt;</span>
        <span class="nt">&lt;repository&gt;</span>
            <span class="nt">&lt;id&gt;</span>local-repo-release<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;name&gt;</span>GitHub Release<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>file://${project.basedir}/maven-repo<span class="nt">&lt;/url&gt;</span>
        <span class="nt">&lt;/repository&gt;</span>
    <span class="nt">&lt;/distributionManagement&gt;</span>

    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-source-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;executions&gt;</span>
                    <span class="nt">&lt;execution&gt;</span>
                        <span class="nt">&lt;id&gt;</span>attach-sources<span class="nt">&lt;/id&gt;</span>
                        <span class="nt">&lt;phase&gt;</span>package<span class="nt">&lt;/phase&gt;</span>
                        <span class="nt">&lt;goals&gt;</span>
                            <span class="nt">&lt;goal&gt;</span>jar-no-fork<span class="nt">&lt;/goal&gt;</span>
                        <span class="nt">&lt;/goals&gt;</span>
                    <span class="nt">&lt;/execution&gt;</span>
                <span class="nt">&lt;/executions&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-javadoc-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;executions&gt;</span>
                    <span class="nt">&lt;execution&gt;</span>
                        <span class="nt">&lt;id&gt;</span>attach-javadocs<span class="nt">&lt;/id&gt;</span>
                        <span class="nt">&lt;phase&gt;</span>package<span class="nt">&lt;/phase&gt;</span>
                        <span class="nt">&lt;goals&gt;</span>
                            <span class="nt">&lt;goal&gt;</span>jar<span class="nt">&lt;/goal&gt;</span>
                        <span class="nt">&lt;/goals&gt;</span>
                    <span class="nt">&lt;/execution&gt;</span>
                <span class="nt">&lt;/executions&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div><p>注意到<code class="language-plaintext highlighter-rouge">&lt;distributionManagement&gt;</code>，它指示了发布的软件包的位置，这里的<code class="language-plaintext highlighter-rouge">&lt;url&gt;</code>是项目根目录下的<code class="language-plaintext highlighter-rouge">maven-repo</code>目录，在<code class="language-plaintext highlighter-rouge">&lt;build&gt;</code>中定义的两个插件<code class="language-plaintext highlighter-rouge">maven-source-plugin</code>和<code class="language-plaintext highlighter-rouge">maven-javadoc-plugin</code>分别用来创建源码和javadoc，如果不想发布源码，可以把对应的插件去掉。</p><p>直接在项目根目录下运行Maven命令<code class="language-plaintext highlighter-rouge">mvn clean package deploy</code>，如果一切顺利，就可以在<code class="language-plaintext highlighter-rouge">maven-repo</code>目录下找到部署后的所有文件。</p><p>最后一步，是把这个工程推到GitHub上，并选择<code class="language-plaintext highlighter-rouge">Settings</code>-<code class="language-plaintext highlighter-rouge">GitHub Pages</code>，选择<code class="language-plaintext highlighter-rouge">master branch</code>启用Pages服务。这样，把全部内容推送至GitHub后，即可作为静态网站访问Maven的repo。</p><p>现在，如果其他人希望引用这个Maven包，告知如下依赖即可：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.XXX<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>how-to-become-rich<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div><p>但是，除了正常导入依赖外，对方还需要再添加一个<code class="language-plaintext highlighter-rouge">&lt;repository&gt;</code>的声明，即使用方完整的<code class="language-plaintext highlighter-rouge">pom.xml</code>如下：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;groupId&gt;</span>example<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>how-to-become-rich-usage<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;packaging&gt;</span>jar<span class="nt">&lt;/packaging&gt;</span>

    <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;maven.compiler.source&gt;</span>11<span class="nt">&lt;/maven.compiler.source&gt;</span>
        <span class="nt">&lt;maven.compiler.target&gt;</span>11<span class="nt">&lt;/maven.compiler.target&gt;</span>
        <span class="nt">&lt;java.version&gt;</span>11<span class="nt">&lt;/java.version&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>

    <span class="nt">&lt;repositories&gt;</span>
        <span class="nt">&lt;repository&gt;</span>
            <span class="nt">&lt;id&gt;</span>github-rich-repo<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;name&gt;</span>The Maven Repository on Github<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>https://XX.github.io/how-to-become-rich/maven-repo/<span class="nt">&lt;/url&gt;</span>
        <span class="nt">&lt;/repository&gt;</span>
    <span class="nt">&lt;/repositories&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.XX<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>how-to-become-rich<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.0.0<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div><p>在<code class="language-plaintext highlighter-rouge">&lt;repository&gt;</code>中，必须声明发布的Maven的repo地址，其中<code class="language-plaintext highlighter-rouge">&lt;id&gt;</code>和<code class="language-plaintext highlighter-rouge">&lt;name&gt;</code>可以任意填写，<code class="language-plaintext highlighter-rouge">&lt;url&gt;</code>填入GitHub Pages提供的地址+<code class="language-plaintext highlighter-rouge">/maven-repo/</code>后缀。现在，即可正常引用这个库并编写代码如下：</p><p>为什么使用<code class="language-plaintext highlighter-rouge">commons-logging</code>等第三方库时，并不需要声明repo地址？这是因为这些库都是发布到Maven中央仓库的，发布到中央仓库后，不需要告诉Maven仓库地址，因为它知道中央仓库的地址默认是https://repo1.maven.org/maven2/，也可以通过<code class="language-plaintext highlighter-rouge">~/.m2/settings.xml</code>指定一个代理仓库地址以替代中央仓库来提高速度。</p><p>因为GitHub Pages并不会把我们发布的Maven包同步到中央仓库，所以自然使用方必须手动添加一个我们提供的仓库地址。</p><p>此外，通过GitHub Pages发布Maven repo时需要注意一点，即不要改动已发布的版本。因为Maven的仓库是不允许修改任何版本的，对一个库进行修改的唯一方法是发布一个新版本。但是通过静态文件的方式发布repo，实际上是可以修改jar文件的，但最好遵守规范，不要修改已发布版本。</p><h3 id="通过nexus发布到中央仓库">通过Nexus发布到中央仓库</h3><p>能不能把自己的开源库发布到Maven的中央仓库，这样用户就不需要声明repo地址，可以直接引用，显得更专业。</p><p>当然可以，但不能直接发布到Maven中央仓库，而是通过曲线救国的方式，发布到<a href="https://central.sonatype.org/">central.sonatype.org</a>，它会定期自动同步到Maven的中央仓库。<a href="https://www.sonatype.com/nexus-repository-oss">Nexus</a>是一个支持Maven仓库的软件，由Sonatype开发，有免费版和专业版两个版本，很多大公司内部都使用Nexus作为自己的私有Maven仓库，而这个<a href="https://central.sonatype.org/">central.sonatype.org</a>相当于面向开源的一个Nexus公共服务。</p><p>所以，第一步是在<a href="https://central.sonatype.org/">central.sonatype.org</a>上<a href="https://central.sonatype.org/register/legacy/">注册</a>一个账号。</p><p>如果注册顺利并审核通过，会得到一个登录账号，然后，通过<a href="https://central.sonatype.org/pages/apache-maven.html">这个页面</a>一步一步操作就可以成功地将自己的Artifact发布到Nexus上，再耐心等待几个小时后，你的Artifact就会出现在Maven的中央仓库中。</p><p>提一下发布重点与难点：</p><ul><li>必须正确创建GPG签名，Linux和Mac下推荐使用gnupg2；</li><li>必须在<code class="language-plaintext highlighter-rouge">~/.m2/settings.xml</code>中配置好登录用户名和口令，以及GPG口令：</li></ul><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;settings</span> <span class="err">...</span><span class="nt">&gt;</span>
    ...
    <span class="nt">&lt;servers&gt;</span>
        <span class="nt">&lt;server&gt;</span>
            <span class="nt">&lt;id&gt;</span>ossrh<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;username&gt;</span>OSSRH-USERNAME<span class="nt">&lt;/username&gt;</span>
            <span class="nt">&lt;password&gt;</span>OSSRH-PASSWORD<span class="nt">&lt;/password&gt;</span>
        <span class="nt">&lt;/server&gt;</span>
    <span class="nt">&lt;/servers&gt;</span>
    <span class="nt">&lt;profiles&gt;</span>
        <span class="nt">&lt;profile&gt;</span>
            <span class="nt">&lt;id&gt;</span>ossrh<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;activation&gt;</span>
                <span class="nt">&lt;activeByDefault&gt;</span>true<span class="nt">&lt;/activeByDefault&gt;</span>
            <span class="nt">&lt;/activation&gt;</span>
            <span class="nt">&lt;properties&gt;</span>
                <span class="nt">&lt;gpg.executable&gt;</span>gpg2<span class="nt">&lt;/gpg.executable&gt;</span>
                <span class="nt">&lt;gpg.passphrase&gt;</span>GPG-PASSWORD<span class="nt">&lt;/gpg.passphrase&gt;</span>
            <span class="nt">&lt;/properties&gt;</span>
        <span class="nt">&lt;/profile&gt;</span>
    <span class="nt">&lt;/profiles&gt;</span>
<span class="nt">&lt;/settings&gt;</span>
</code></pre></div></div><p>在待发布的Artifact的<code class="language-plaintext highlighter-rouge">pom.xml</code>中添加OSS的Maven repo地址，以及<code class="language-plaintext highlighter-rouge">maven-jar-plugin</code>、<code class="language-plaintext highlighter-rouge">maven-source-plugin</code>、<code class="language-plaintext highlighter-rouge">maven-javadoc-plugin</code>、<code class="language-plaintext highlighter-rouge">maven-gpg-plugin</code>、<code class="language-plaintext highlighter-rouge">nexus-staging-maven-plugin</code>：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;project</span> <span class="err">...</span><span class="nt">&gt;</span>
    ...
    <span class="nt">&lt;distributionManagement&gt;</span>
        <span class="nt">&lt;snapshotRepository&gt;</span>
            <span class="nt">&lt;id&gt;</span>ossrh<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;url&gt;</span>https://oss.sonatype.org/content/repositories/snapshots<span class="nt">&lt;/url&gt;</span>
        <span class="nt">&lt;/snapshotRepository&gt;</span>

        <span class="nt">&lt;repository&gt;</span>
            <span class="nt">&lt;id&gt;</span>ossrh<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;name&gt;</span>Nexus Release Repository<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>http://oss.sonatype.org/service/local/staging/deploy/maven2/<span class="nt">&lt;/url&gt;</span>
        <span class="nt">&lt;/repository&gt;</span>
    <span class="nt">&lt;/distributionManagement&gt;</span>

    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-jar-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;executions&gt;</span>
                    <span class="nt">&lt;execution&gt;</span>
                        <span class="nt">&lt;goals&gt;</span>
                            <span class="nt">&lt;goal&gt;</span>jar<span class="nt">&lt;/goal&gt;</span>
                            <span class="nt">&lt;goal&gt;</span>test-jar<span class="nt">&lt;/goal&gt;</span>
                        <span class="nt">&lt;/goals&gt;</span>
                    <span class="nt">&lt;/execution&gt;</span>
                <span class="nt">&lt;/executions&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-source-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;executions&gt;</span>
                    <span class="nt">&lt;execution&gt;</span>
                        <span class="nt">&lt;id&gt;</span>attach-sources<span class="nt">&lt;/id&gt;</span>
                        <span class="nt">&lt;goals&gt;</span>
                            <span class="nt">&lt;goal&gt;</span>jar-no-fork<span class="nt">&lt;/goal&gt;</span>
                        <span class="nt">&lt;/goals&gt;</span>
                    <span class="nt">&lt;/execution&gt;</span>
                <span class="nt">&lt;/executions&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-javadoc-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;executions&gt;</span>
                    <span class="nt">&lt;execution&gt;</span>
                        <span class="nt">&lt;id&gt;</span>attach-javadocs<span class="nt">&lt;/id&gt;</span>
                        <span class="nt">&lt;goals&gt;</span>
                            <span class="nt">&lt;goal&gt;</span>jar<span class="nt">&lt;/goal&gt;</span>
                        <span class="nt">&lt;/goals&gt;</span>
                        <span class="nt">&lt;configuration&gt;</span>
                            <span class="nt">&lt;additionalOption&gt;</span>
                                <span class="nt">&lt;additionalOption&gt;</span>-Xdoclint:none<span class="nt">&lt;/additionalOption&gt;</span>
                            <span class="nt">&lt;/additionalOption&gt;</span>
                        <span class="nt">&lt;/configuration&gt;</span>
                    <span class="nt">&lt;/execution&gt;</span>
                <span class="nt">&lt;/executions&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-gpg-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;executions&gt;</span>
                    <span class="nt">&lt;execution&gt;</span>
                        <span class="nt">&lt;id&gt;</span>sign-artifacts<span class="nt">&lt;/id&gt;</span>
                        <span class="nt">&lt;phase&gt;</span>verify<span class="nt">&lt;/phase&gt;</span>
                        <span class="nt">&lt;goals&gt;</span>
                            <span class="nt">&lt;goal&gt;</span>sign<span class="nt">&lt;/goal&gt;</span>
                        <span class="nt">&lt;/goals&gt;</span>
                    <span class="nt">&lt;/execution&gt;</span>
                <span class="nt">&lt;/executions&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.sonatype.plugins<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>nexus-staging-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>1.6.3<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;extensions&gt;</span>true<span class="nt">&lt;/extensions&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;serverId&gt;</span>ossrh<span class="nt">&lt;/serverId&gt;</span>
                    <span class="nt">&lt;nexusUrl&gt;</span>https://oss.sonatype.org/<span class="nt">&lt;/nexusUrl&gt;</span>
                    <span class="nt">&lt;autoReleaseAfterClose&gt;</span>true<span class="nt">&lt;/autoReleaseAfterClose&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div><p>最后执行命令<code class="language-plaintext highlighter-rouge">mvn clean package deploy</code>即可发布至<a href="https://central.sonatype.org/">central.sonatype.org</a>。</p><p>此方法前期需要复杂的申请账号和项目的流程，后期需要安装调试GPG，但只要跑通流程，后续发布都只需要一行命令。</p><h3 id="发布到私有仓库">发布到私有仓库</h3><p>通过<code class="language-plaintext highlighter-rouge">nexus-staging-maven-plugin</code>除了可以发布到<a href="https://central.sonatype.org/">central.sonatype.org</a>外，也可以发布到私有仓库，例如，公司内部自己搭建的Nexus服务器。</p><p>如果没有私有Nexus服务器，还可以发布到<a href="https://github.com/features/packages">GitHub Packages</a>。GitHub Packages是GitHub提供的仓库服务，支持Maven、NPM、Docker等。使用GitHub Packages时，无论是发布Artifact，还是引用已发布的Artifact，都需要明确的授权Token，因此，GitHub Packages只能作为私有仓库使用。</p><p>在发布前，我们必须首先登录后在用户的<code class="language-plaintext highlighter-rouge">Settings</code>-<code class="language-plaintext highlighter-rouge">Developer settings</code>-<code class="language-plaintext highlighter-rouge">Personal access tokens</code>中创建两个Token，一个用于发布，一个用于使用。发布Artifact的Token必须有<code class="language-plaintext highlighter-rouge">repo</code>、<code class="language-plaintext highlighter-rouge">write:packages</code>和<code class="language-plaintext highlighter-rouge">read:packages</code>权限。</p><p>使用Artifact的Token只需要<code class="language-plaintext highlighter-rouge">read:packages</code>权限。</p><p>在发布端，把GitHub的用户名和发布Token写入<code class="language-plaintext highlighter-rouge">~/.m2/settings.xml</code>配置中：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;settings</span> <span class="err">...</span><span class="nt">&gt;</span>
    ...
    <span class="nt">&lt;servers&gt;</span>
        <span class="nt">&lt;server&gt;</span>
            <span class="nt">&lt;id&gt;</span>github-release<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;username&gt;</span>GITHUB-USERNAME<span class="nt">&lt;/username&gt;</span>
            <span class="nt">&lt;password&gt;</span>f052...c21f<span class="nt">&lt;/password&gt;</span>
        <span class="nt">&lt;/server&gt;</span>
    <span class="nt">&lt;/servers&gt;</span>
<span class="nt">&lt;/settings&gt;</span>
</code></pre></div></div><p>然后，在需要发布的Artifact的<code class="language-plaintext highlighter-rouge">pom.xml</code>中，添加一个<code class="language-plaintext highlighter-rouge">&lt;repository&gt;</code>声明：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;project</span> <span class="err">...</span><span class="nt">&gt;</span>
    ...
    <span class="nt">&lt;distributionManagement&gt;</span>
        <span class="nt">&lt;repository&gt;</span>
            <span class="nt">&lt;id&gt;</span>github-release<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;name&gt;</span>GitHub Release<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>https://maven.pkg.github.com/GITHUB-USERNAME/complex<span class="nt">&lt;/url&gt;</span>
        <span class="nt">&lt;/repository&gt;</span>
    <span class="nt">&lt;/distributionManagement&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div><p>注意到<code class="language-plaintext highlighter-rouge">&lt;id&gt;</code>和<code class="language-plaintext highlighter-rouge">~/.m2/settings.xml</code>配置中的<code class="language-plaintext highlighter-rouge">&lt;id&gt;</code>要保持一致，因为发布时Maven根据id找到用于登录的用户名和Token，才能成功上传文件到GitHub。直接通过命令<code class="language-plaintext highlighter-rouge">mvn clean package deploy</code>部署，成功后，在GitHub用户页面可以看到该Artifact。</p><p>使用该Artifact时，因为GitHub的Package只能作为私有仓库使用，所以除了在使用方的<code class="language-plaintext highlighter-rouge">pom.xml</code>中声明<code class="language-plaintext highlighter-rouge">&lt;repository&gt;</code>外：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;project</span> <span class="err">...</span><span class="nt">&gt;</span>
    ...
    <span class="nt">&lt;repositories&gt;</span>
        <span class="nt">&lt;repository&gt;</span>
            <span class="nt">&lt;id&gt;</span>github-release<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;name&gt;</span>GitHub Release<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>https://maven.pkg.github.com/GITHUB-USERNAME/complex<span class="nt">&lt;/url&gt;</span>
        <span class="nt">&lt;/repository&gt;</span>
    <span class="nt">&lt;/repositories&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.XXX<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>complex<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.0.0<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
    ...
<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div><p>还需要把有读权限的Token配置到<code class="language-plaintext highlighter-rouge">~/.m2/settings.xml</code>文件中。</p><h2 id="疑难杂症">疑难杂症</h2><h3 id="编译失败">编译失败</h3><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>【ERROR】 不再支持源选项 1.5。请使用 1.6 或更高版本。
【ERROR】 不再支持目标选项 1.5。请使用 1.6 或更高版本。
</code></pre></div></div><p>这是因为没有配置jdk版本号，解决方法1:在pom文件中指定jdk版本</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;properties&gt;</span> 
    <span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
    <span class="nt">&lt;maven.compiler.source&gt;</span>1.8<span class="nt">&lt;/maven.compiler.source&gt;</span>
    <span class="nt">&lt;maven.compiler.target&gt;</span>1.8<span class="nt">&lt;/maven.compiler.target&gt;</span>
<span class="nt">&lt;/properties&gt;</span>
</code></pre></div></div><p>解决方法2:直接在setting中指定</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;profiles&gt;</span>
    <span class="nt">&lt;profile&gt;</span>
        <span class="nt">&lt;id&gt;</span>JDK-1.8<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;activation&gt;</span>
            <span class="nt">&lt;activeByDefault&gt;</span>true<span class="nt">&lt;/activeByDefault&gt;</span>
            <span class="nt">&lt;jdk&gt;</span>1.8<span class="nt">&lt;/jdk&gt;</span>
        <span class="nt">&lt;/activation&gt;</span>
        <span class="nt">&lt;properties&gt;</span>
            <span class="nt">&lt;maven.compiler.source&gt;</span>1.8<span class="nt">&lt;/maven.compiler.source&gt;</span>
            <span class="nt">&lt;maven.compiler.target&gt;</span>1.8<span class="nt">&lt;/maven.compiler.target&gt;</span>
            <span class="nt">&lt;maven.compiler.compilerVersion&gt;</span>1.8<span class="nt">&lt;/maven.compiler.compilerVersion&gt;</span>
        <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;/profile&gt;</span>
<span class="nt">&lt;/profiles&gt;</span>
</code></pre></div></div><h3 id="编码错误">编码错误</h3><p>没有使用UTF-8的格式，在pom.xml中添加：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;properties&gt;</span>
    <span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
<span class="nt">&lt;/properties&gt;</span>
</code></pre></div></div><h3 id="修改本地仓库位置">修改本地仓库位置</h3><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c">&lt;!-- localRepository
   | The path to the local repository maven will use to store artifacts.
   |
   | Default: ${user.home}/.m2/repository
  &lt;localRepository&gt;/path/to/local/repo&lt;/localRepository&gt;
  --&gt;</span>
</code></pre></div></div><h3 id="资源拷贝">资源拷贝</h3><p>将非resources的xml也打包到class</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;build&gt;</span>
    <span class="nt">&lt;resources&gt;</span>
        <span class="nt">&lt;resource&gt;</span>
            <span class="nt">&lt;directory&gt;</span>src/main/java<span class="nt">&lt;/directory&gt;</span>
            <span class="nt">&lt;includes&gt;</span>
                <span class="nt">&lt;include&gt;</span>**/*.xml<span class="nt">&lt;/include&gt;</span>
            <span class="nt">&lt;/includes&gt;</span>
        <span class="nt">&lt;/resource&gt;</span>
        <span class="nt">&lt;resource&gt;</span>
            <span class="nt">&lt;directory&gt;</span>src/main/resources<span class="nt">&lt;/directory&gt;</span>
            <span class="nt">&lt;includes&gt;</span>
                <span class="nt">&lt;include&gt;</span>**/*.xml<span class="nt">&lt;/include&gt;</span>
                <span class="nt">&lt;include&gt;</span>**/*.properties<span class="nt">&lt;/include&gt;</span>
            <span class="nt">&lt;/includes&gt;</span>
        <span class="nt">&lt;/resource&gt;</span>
    <span class="nt">&lt;/resources&gt;</span>
<span class="nt">&lt;/build&gt;</span>
</code></pre></div></div><div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"><h3>文档信息</h3><ul><li>本文作者：<a href="" target="_blank">acteds</a></li><li>本文链接：<a href="/2022/08/13/Maven/" target="_blank">https://acteds.github.io/2022/08/13/Maven/</a></li><li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li></ul></div></article><div class="share"></div><div class="comment"> <script src="https://beaudar.lipk.org/client.js" repo="mzlogin/blog-comments" issue-term="title" label="gitment" theme="github-light" comment-order="desc" input-position="top" crossorigin="anonymous" async> </script></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"></div><ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul><script src="/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: '/assets/search_data.json?v=1716989529', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 10, fuzzy: false, exclude: ['Welcome'] }) </script><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="/assets/js/jquery.toc.js"></script></div></div></section><footer class="container"><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2024 <span title="acteds">acteds</span> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo(0,0)" >TOP</a></li></ul><a href="https://github.com/acteds/acteds.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="/" title="首页" target="">首页</a></li><li> <a href="/categories/" title="分类" target="">分类</a></li><li> <a href="/wiki/" title="维基" target="">维基</a></li><li> <a href="/about/" title="关于" target="">关于</a></li><li><a href="/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a></div><script src="/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script></body></html>
